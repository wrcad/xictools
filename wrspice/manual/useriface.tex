\chapter{The {\WRspice} User Interface}

%S-----------------------------------------------------------------------------
\section{Starting {\WRspice}}
\index{command line options|(}

% spCmdLine.hlp:arguments 052222

The {\WRspice} simulator is invoked by typing
\begin{quote}
{\vt wrspice} {\it options} ... {\it input\_files} ...
\end{quote}
All arguments are optional.  There are several options which are
recognized specifically by {\WRspice}.  These options are case
insensitive --- the option letters can be given in upper or lower
case.  In addition, there are a few additional options recognized by
the graphics system.

\index{option character}
\index{SPICE\_OPTCHAR environment variable}
The command line options are flagged with the `{\vt -}' character, but
this can be changed by setting the {\et SPICE\_OPTCHAR} environment variable. 
Below, the use of the `{\vt -}' character is assumed for simplicity. 

\index{DISPLAY environment variable}
Graphical {\WRspice} requires an X server under UNIX.  When using X,
the {\et DISPLAY} environment variable should already be set, but if
one wants to display graphics on a different machine than the one
running {\WRspice}, {\et DISPLAY} should be of the form {\it
machine\/}:0.  For example, if one wants the display to go to the
workstation named ``{\vt crab}'', for the C-shell one would enter
``{\vt setenv DISPLAY crab:0}'' at the shell prompt, or equivalently
for the Bourne shell one would enter ``{\vt DISPLAY=crab; export
DISPLAY}'' or the more compact form ``{\vt export DISPLAY=crab}'' if
supported.  Note that this can also be supplied using the {\vt -d}
option.

Further arguments are taken to be {\WRspice} input files, which are
read and saved in memory.  If batch mode is requested ({\vt -b}
option) then they are run immediately.  {\WRspice} will accept SPICE2
input files, and output ASCII plots, Fourier analyses, and node
printouts as specified in {\vt .plot}, {\vt .four}, and {\vt .print}
lines.  If an {\vt out} parameter is given on a {\vt .width} line, the
effect is the same as ``{\vt set width = ...}''.  Since {\WRspice}
ASCII plots do not use multiple ranges, however, if vectors together
on a {\vt .plot} card have different ranges they will not provide as
much information as they would in SPICE2.  The output of {\WRspice} is
also much less verbose than SPICE2, in that the only data printed is
that requested by the above lines.

The following option forms are accepted by {\WRspice}.  The option
letter can be lower or upper case.

\begin{description}
\index{command line options!-b}
\index{batch mode}
\item{\vt -b}\\
Run in batch mode.  {\WRspice} will read the standard input or the
specified input files and do the simulation.  Note that if the
standard input is not a terminal, {\WRspice} will default to batch
mode, unless the {\vt -i} option is given.  In batch mode, {\WRspice}
generates output files for operating range and Monte Carlo analysis,
otherwise if the {\vt -r} option is used ({\vt -r} {\it filename})
{\WRspice} generates a plot data file, or generates an ASCII plot or
print on standard output, as per {\vt .plot/.print} lines, if no {\it
filename} was specified.  See the description of the {\cb write}
command (\ref{writecmd}) for information about the file formats
available and how they can be specified.

\index{command line options!-c}
\index{case sensitivity}
\item{\vt -c} {\it flags}\\
This option sets the case sensitivity of various name classes
in {\WRspice}.  These classes are:

\begin{quote}
Function names.\\
User-defined function names.\\
Vector names.\\
.PARAM names.\\
Codeblock names.\\
Node and device names.\\
\end{quote}

The {\it flags} is a word consisting of letters, each letter
corresponds to a class from the list above.  If lower-case, the class
will be case-sensitive.  If upper-case, the class will be
case-insensitive.

The letters are {\vt f}, {\vt u}, {\vt v}, {\vt p}, {\vt c}, and {\vt
n} corresponding to the classes listed above.  By default, all
identifiers are case-insensitive, which corresponds to the string
``{\vt FUVPCN}''.  Letters can appear in any order, and unrecognized
characters are ignored.  Not all letters need be included, only those
seen will be used.

This word should follow {\vt -c} or {\vt -C} in the command line
options, separated by space.

Case sensitivity can also be set from a startup file using the {\cb
setcase} command.  This command takes as an argument a string as
described above.  The command line setting occurs after setting from a
startup file.

\index{command line options!-d}
\item{\vt -d} [{\it host}]:{\it server}[.{\it screen}]\\
This option is applicable when running under X windows, and specifies
the name of the display to use.  The {\it host} is the hostname of the
physical display, {\it server} specifies the display server number,
and {\it screen} specifies the screen number.  Either or both of the
{\it host} and {\it screen} elements to the display specification can
be omitted.  If {\it host} is omitted, the local display is assumed. 
If {\it screen} is omitted, screen 0 is assumed (and the period is
unnecessary).  The colon and (display) {\it server} are necessary in
all cases.  This option can also be given as {\vt -display} and {\vt
-\/-display}.

\index{command line options!-dnone}
\item{\vt -dnone}\\
This is a special form of the {\vt -d} option that when given will
suppress all use of graphics.  This can be desirable when running
{\WRspice} remotely over a slow terminal connection.  This option will
also work under Windows, if for some reason it is necessary to run
{\WRspice} in text-only mode.

\index{command line options!-i}
\item{\vt -i}\\
Run in interactive (as opposed to batch) mode.  This is useful if the
standard input is not a terminal but interactive mode is desired. 
Command completion is not available unless the standard input is a
terminal, however.  Interactive mode is the default when the standard
input is a terminal.

\index{command line options!-j}
\item{\vt -j}\\
Run in JSPICE3 compatibility mode.  This applies when running
interactively, and causes the following behavior.
\begin{enumerate}
\item{The {\cb Tool Control} window is not shown.}
\item{The {\et noerrwin} variable is set, which causes error messages
to be printed in the console rather than to a separate error window.}
\item{The {\et subc\_catmode} variable is set to ``{\vt spice3}'' and
the {\et subc\_catchar} variable is set to ``{\vt :}'' (colon).  This
sets the subcircuit expansion method to match JSPICE3 and SPICE3.}
\end{enumerate}

%\ifxtlserv
%\index{command line options!-l}
%\item{\vt -l} {\it license\_server\/}[{\vt :}{\it port\/}]\\
%This option provides the host name of a machine running the license
%server, and optionally the port number in use by the server.  The port
%number is required if for some reason the license server is using a
%non-default port.
%
%Below is the logic hierarchy for setting the license server host, each
%method will override those listed lower.  See the documentation for
%the {\vt xtlserv} (license server) program for more information.
%\begin{quote}
%{\vt -l} {\it serverhost}[:{\it port\/}]\\
%{\et XTLSERVER} in environment\\
%{\vt license.host} file\\
%{\vt xtlserver} in {\vt /etc/hosts}\\
%name of local machine
%\end{quote}
%\fi

\index{command line options!-m}
\item{\vt -m} {\it path}\\
The {\it path} is to a loadable device module (see \ref{loadable})
file, or to a directory containing module files.  Giving this option
causes the indicated module, or modules found in the directory, to be
loaded into {\WRspice} on program startup, after the
<tt>.wrspiceinit</tt> file has been read.  The option can be given
more than once.  If given, auto-loading of modules from the {\et
modpath} or the {\vt devices} sub-directory in the {\vt startup}
directory will not be done.  Modules can be loaded from within
{\WRspice} with the {\cb devload} command.

\index{command line options!-mnone}
\item{\vt -mnone}\\
This option will suppress auto-loading of modules from the {\et
modpath} or the {\vt devices} sub-directory in the {\vt startup}
directory.

\index{command line options!-n}
\item{\vt -n}\\
Don't try to execute the user's startup files ({\vt .wrspiceinit}
files) upon startup.  Normally {\WRspice} tries to find these files in
the user's home directory and the current directory, and will execute
them in that order.  In Windows, the ``home directory'' can be
specified by setting the {\et HOME} environment variable.  The global
file {\vt wrspiceinit} in the system startup directory is sourced in
any case.

\index{command line options!-o}
\item{\vt -o} {\it outfile}\\
The argument {\it outfile\/} specifies a file to be used for output,
rather than the standard output (terminal).

\index{command line options!-p}
\item{\vt -p}\\
Open {\WRspice} in a mode which takes input from a UNIX port, used to
establish interprocess communications as a slave process.

\index{command line options!-q}
\item{\vt -q}\\
Disable command completion, which saves memory and may run slightly
faster.  This prevents initial loading of the command completion data
structures.  If the variable {\et nocc} is set and unset, command
completion will be turned on, however most internal keywords will not
be present in the database.

\index{command line options!-r}
\item{\vt -r} {\it filename}\\
Use {\it filename\/} as the default file into which the results of the
simulation are saved with the {\cb write} command, and for data output
in batch mode.  This can be overridden with the {\et rawfile}
variable.  See the description of the {\cb write} command
(\ref{writecmd}) for information about the file formats available, and
how they can be specified.

\index{command line options!-s}
\item{\vt -s}\\
Run in server mode.  This is like batch mode, except that a temporary
rawfile is used and then written to the standard output, preceded by a
line with a single `{\vt @}', after the simulation is done.  This mode
is used by the {/WRspice} daemon {\vt wrspiced}.  In server mode,
{\WRspice} reads input from the standard input, and generates output,
in rawfile or margin analysis file format, on the standard output. 
The {\vt -r} and {\vt -b} options are ignored.

\index{command line options!-t}
\item{{\vt -t} {\it termname}}\\
This specifies the name of the terminal, as known in a termcap or
terminfo database.  The terminal name is only needed in interactive
mode when line editing is enabled, and is generally obtained from the
{\et TERM} environment variable.  Occasionally, this option is useful
in overriding bad terminal info specifications allowing line editing
to work, such as by giving a value of ``{\vt vt220}'' when running in
an {\vt xterm}.

\index{command line options!-x}
\item{\vt -x}\\
This option, if given, will cause {\WRspice} to provide its own window
for text input, if {\WRspice} is in interactive mode and graphics is
available.  Under the X window system, the ``{\vt xterm}'' command
is used to obtain the text window.
\end{description}

The UNIX/Linux graphical subsystem will accept the following options. 
It is unlikely that the user will ever need these.

\begin{description}
\index{command line options!--class}
\item{\vt -\/-class} {\it classname}\\
This option specifies the application class name under which resources
for the application should be found.

\index{command line options!--name}
\item{\vt -\/-name} {\it appname}\\
This option specifies the name under which resources for the
application should be found.  This option is useful in shell aliases
to distinguish between invocations of an application, without
resorting to creating links to alter the executable file name.
This option can also be given as ``{\vt -name}''.

\index{command line options!--sync}
\item{\vt -\/-sync}\\
This option indicates that requests to the X server should be sent
synchronously, instead of asynchronously.  Since Xlib normally buffers
requests to the server, errors do not necessarily get reported
immediately after they occur.  This option turns off the buffering so
that the application can be debugged.  It should never be used with a
working program.  This option can also be given as ``{\vt
-synchronous}''.

\index{command line options!--no-xshm}
\item{\vt -\/-no-xshm}\\
If set, the X server will not use shared memory.

\index{command line options!--v}
\item{\vt -\/-v}\\
If this argument is given, {\WRspice} will print a version string
consisting of three tokens to the standard output, and exit.  The
format is
\begin{quote}
{\it version osname arch}
\end{quote}
for example ``{\vt 4.3.11 LinuxCentos7 x86\_64}''.

\index{command line options!--vv}
\item{\vt -\/-vv}\\
If this argument is given, {\WRspice} will print a CVS-style release
tag string in the form
\begin{quote}
{\vt wrs-4-3-1}
\end{quote}
to the standard output, and exit.

\index{command line options!--vb}
\item{\vt -\/-vb}\\
If this argument is given, {\WRspice} will print the build date to the
standard output, and exit.
\end{description}
\index{command line options|)}


%S-----------------------------------------------------------------------------
\section{Environment Variables}
\index{environment variables|(}

% spSetup.hlp:environment 051522

Environment variables are keyword/value pairs that are made available
to an application by the command shell or operating system.  The value
of an environment variable is a text string, which may be empty. 
Environment variables can be set by the user to control various
defaults in {\WRspice}.

%SU-------------------------------------
\subsection{Unix/Linux}
\index{environment variables!setting}

Environment variables are maintained by the user's command shell.  It
is often convenient to set environment variables in a shell startup
file such as {\vt .cshrc} or {\vt .login} for the C-shell or {\vt
.profile} for the Bourne shell.  These files reside in the user's home
directory.  See the manual page for your shell for more information.

For the C-shell, the command that sets an environment variable is
\begin{quote}
{\vt setenv} {\it variable\_name} [{\it value\/}]
\end{quote}
For example,
\begin{quote}
{\vt setenv XT\_DUMMY "hello world!"}
\end{quote}
Note that if the value contains white space, it should be quoted. 
Note also that it is not necessary to have a value, in which case the
variable acts as a boolean (set or not set).

In the C-shell, one can use {\vt setenv} without arguments, or {\vt
printenv}, to list all of the environment variables currently set.

For a modern Bourne-type shell, such as {\vt bash}, the
corresponding command is
\begin{quote}
{\vt export} {\it variable\_name\/}[={\it value\/}]
\end{quote}
In this type of shell one can list the variables currently set by
giving the shell {\vt set} command with no arguments.

%SU-------------------------------------
\subsection{Microsoft Windows}

Under Windows, environment variables can be set in a DOS box with the
``{\vt set}'' command before starting the program from the command
line, or in the {\vt AUTOEXEC.BAT} file, or from the {\cb System}
entry in the {\cb Control Panel}.  Only the latter two methods work if
the programs are started from an icon.  If using a Cygwin bash-box,
environment variables can be set in the startup file as under Unix.

{\WRspice} is {\bf not} compatible with the {\vt mintty} terminal
emulator which is the current default in Cygwin.  Only Cygwin-built
programs work properly from this terminal if they use a command line
interface.

%SU-------------------------------------
\subsection{{\WRspice} Environment Variables}

The following environment variables are used by all {\XicTools}
programs.

\begin{description}
\index{environment variables!WRSPICE\_HOME}
\item{\et WRSPICE\_HOME}\\
If found in the environment when {\WRspice} starts, it is expected to
contain a path to the {\WRspice} installation area or equivalent,
which defaults to ``{\vt /usr/local/xictools/wrspice}''.  This
overrides {\et XT\_PREFIX} if that environment variable is also found.

There is an important subtlety when using this variable.  Although it
allows {\WRspice} to find its startup files anywhere, only the
directory structure implied by {\et XT\_PREFIX}, that is, for
<i>WRspice</i>,
\begin{quote} \vt
\$XT\_PREFIX/xictools/wrspice
\end{quote}
is compatible with the program installation script.  The variable is
perhaps useful for pointing {\WRspice} toward a secondary set of
startup files, perhaps heavily customized by the user, which may
reside in an arbitrary location.

\index{environment variables!WRSPICE\_FIFO}
\item{\et WRSPICE\_FIFO}\\
When {\WRspice} starts, it creates a ``named pipe'', otherwise known
as a fifo (see \ref{fifo}).  Text written to the fifo is piped into
{\WRspice}, as if input with the {\cb source} command.  If this
variable is found in the environment, the text of this variable is
taken as the base name for the fifo, instead of ``{\vt wrsfifo}''.  In
Unix/Linux, this name can have a full path.  All components of the
path except for the file name must exist.  If there is a conflict with
an existing entity, an integer suffix will be added to make the name
unique.  In Windows, any path given is stripped and ignored.

%\ifxtlserv
%\index{environment variables!XT\_AUTH\_MODE}
%\item{\et XT\_AUTH\_MODE}\\
%By default, Unix/Linux versions of {\Xic} and {\WRspice} use
%authorization provided by an external license server, possibly hosted
%on a different machine.  On the other hand, the Windows versions and
%{\XicII}/{\Xiv} use built-in authorization.  Both the external
%license server and the programs not using the license server make use
%of a file named ``{\vt LICENSE}'' provided by Whiteley Research, Inc.,
%which provides authorization to run on the host computer.
%
%It is possible to run {\Xic} and {\WRspice} without a license server,
%and to run {\XicII}/{\Xiv} from a license server.  The status is set
%with the environment variable {\et XT\_AUTH\_MODE}.  This variable has
%meaning if set to one of the keywords ``{\vt Server}'' or ``{\vt
%Local}''
%
%If set to ``{\vt Server}'', {\XicII} and {\Xiv} will validate through
%a license server the same way as {\Xic} and {\WRspice} normally do. 
%If set to ``{\vt Local}'', {\Xic} and {\WRspice} will be
%self-validating the way {\XicII} normally is.
%
%{\Xic} and/or {\WRspice} users on a single licensed workstation may
%prefer to set the environment variable in their shell startup file and
%not use the external license server.
%
%When the programs look for the LICENSE file in ``{\vt Local}'' mode,
%if the file is not found in the startup or license directories, the
%programs will look in the home and current directories, in that order,
%unless {\et XT\_LICENSE\_PATH} is also set.
%
%\index{environment variables!XT\_LICENSE\_PATH}
%\index{XT\_LICENSE\_PATH environment variable}
%\item{\et XT\_LICENSE\_PATH}\\
%When using local validation (i.e., not using the license server) {\et
%XT\_LICENSE\_PATH} can be set to the full path to the license file. 
%Only this file will be used -- the regular search is suppressed.
%
%\index{environment variables!XTLSERVER}
%\index{XTLSERVER environment variable}
%\item{\et XTLSERVER}\\
%This provides the host name of the host running the license server
%needed to validate the application.  It is in a format understandable
%to the local name server.  The host name can optionally be suffixed by
%``{\vt :}{\it port\/}'', where {\it port} is the port number in use by
%the server.  There should be no space around the colon when using this
%form.
%\fi

\index{environment variables!XT\_PREFIX}
\index{XT\_PREFIX environment variable}
\item{\et XT\_PREFIX}\\
All of the {\XicTools} programs respond to the {\et XT\_PREFIX}
environment variable.  When the tools are installed in a non-standard
location, i.e., other than {\vt /usr/local}, this can be set to the
directory prefix which effectively replaces ``{\vt /usr/local}'', and
the programs will be able to access the installation library files
without further directives.  This should not be needed under Windows,
as the Registry provides the default paths.

\index{environment variables!XT\_HOMEDIR}
\index{XT\_HOMEDIR environment variable}
\item{\et XT\_HOMEDIR}\\
Under Windows, the user's ``home'' directory is determined by looking
at environment variables.

In Linux, the {\et HOME} environment variable is set the the user's home
directory, and this is also true under Windows if using a Linux emulation
package such as Cygwin or MSYS.  However, in this case {\et HOME} will be
relative to the file system as seen within the emulator, and not the
actual Windows file system as seen in {\Xic} or {\WRspice} which are
Windows-native programs.  Therefor, the {\et HOME} environment variable
is ignored under Windows.

Instead, the programs will first look for {\et XT\_HOMEDIR}.  This
should be set to the Windows path to the user's MSYS2 or Cygwin home  
directory.  For example, this can be done from the {\vt bash\_profile}
file by adding a line
\begin{quote}
{\vt export XT\_HOMEDIR=c:/msys64/home/}{\it yourlogin}
\end{quote}
Setting this will allow {\Xic} and {\WRspice} to find files in the
user's MSYS2 home directory, even though the programs are Windows
native and don't know the MSYS2 paths.

The deprecated {\et XIC\_START\_DIR} variable is checked next, and if
found its value is taken as the user's home directory in the same
manner.

If not found, the {\et HOMEDIR} and {\et HOMEPATH}
variables, if both are found, are concatenated to yield the home
directory path.  In the unlikely event that these are not set, the
{\et USERPROFILE} variable is checked, and if all else fails, ``{\vt
C:$\backslash$}'' is assumed.  The {\et HOMEDIR}/{\et HOMEPATH} and
{\et USERPROFILE} variables are set by Windows, at least in some
Windows versions.

Under other operating systems, the home directory is well-defined
and is obtained from operating system calls.

\index{environment!XTNETDEBUG}
\index{XTNETDEBUG environment variable}
\item{\et XTNETDEBUG}\\
If the variable {\et XTNETDEBUG} is defined, {\Xic} and {\WRspice}
will echo interprocess messages sent and received to the console.  In
server mode, {\Xic} will not go into the background, but will remain
in the foreground, printing status messages while servicing requests.

\index{environment!XT\_KLU\_PATH}
\index{XT\_KLU\_PATH environment variable}
\item{\et XT\_KLU\_PATH}\\
This can be set to the full path to the KLU (sparse matrix solver)
plug-in.  For example, this path by default in a Linux installation is
\begin{quote}\vt
/usr/local/xictools/wrspice/startup/klu\_wr.so
\end{quote}
The plug-in is found automatically so this variable is needed only for
special cases. 

The KLU version changed in wrspice-4.2.7, and the plug-ins are not
compatible.  Current {\WRspice} releases will not load the old
plug-in, however older releases will load a new plug-in if found in
the default location, which will likely cause a program crash.  This
variable can be set in this case to avoid the problem.

\index{memory management}
\index{environment variables!XT\_LOCAL\_MALLOC}
\index{XT\_LOCAL\_MALLOC environment variable}
\item{\et XT\_LOCAL\_MALLOC}\\
Linux and FreeBSD releases can use an included local memory allocation
package.  In earlier {\WRspice} releases, this allocator, rather than
the allocator provided by the operating system, was used by default. 
In 32--bit releases, the local allocator was often able to allocate
more memory than the allocators provided by the operating system.  It
also provided custom error reporting and statistics.

This feature is now disabled, as in modern operating systems there is
dubious benefit, and it can produce stability problems in some cases. 
However, if this variable is set in the environment when {\WRspice} is
started, the local allocator will be used.  The interested user is
encouraged to experiment.

\index{environment variables!XT\_SYSTEM\_MALLOC}
\index{XT\_SYSTEM\_MALLOC environment variable}
\item{\et XT\_SYSTEM\_MALLOC}\\
This variable was once used to disable the internal local memory
allocator, which in earlier releases was enabled by default. 
Currently, this variable is ignored.

\index{environment!XT\_GUI\_COMPACT}
\index{XT\_GUI\_COMPACT environment variable}
\item{\et XT\_GUI\_COMPACT}\\
When set, no extra space is allowed around pushbutton contents in the
graphical interface.  Such space can cause menu button images to
be truncated on low-resolution displays if the theme in use imposes
too much space.  Setting this variable is a quick fix for this
problem, though one could also change the theme.
\end{description}

There are several environment variables which can be used to alter
some of the {\WRspice} defaults.  On startup, {\WRspice} checks for the
following variables in the environment, and alters internal defaults
accordingly.  The defaults can be modified when the program is built,
the defaults listed below are those assigned in the distribution.

\begin{description}
\raggedright
\index{environment variables!HOME}
\index{HOME environment variable}
\item{\et HOME}\\
This is used only in the Microsoft Windows version, and can be set to
a full directory path which will be taken as the user's home
directory.

\index{environment variables!DISPLAY}
\index{DISPLAY environment variable}
\item{\et DISPLAY}\\
This variable defines the X window system display that {\WRspice} will
use, but is ignored if the {\vt -d} option is used on the {\WRspice}
command line.  The display must be specified for graphics to be
enabled in {\WRspice}.

\index{environment variables!EDITOR}
\index{EDITOR environment variable}
\item{\et EDITOR}\\
If defined to the invoking string for a text editor, that editor will
be used in the {\cb edit} command.  This is superseded by the {\et
SPICE\_EDITOR} variable, if set.

\index{SPICE\_EDITOR environment variable}
\index{environment variables!SPICE\_EDITOR}
\item{\et SPICE\_EDITOR}\\
The text editor called by the {\cb edit} command can be set with this
variable.  The variable is defined to the command string one would
type to invoke the editor.  This will supersede the {\et EDITOR}
variable, if set, but which would otherwise have the same effect.  If
no editor is specified in the environment, or with the {\et editor}
shell variable, which supersedes the environment variables, a default
internal editor is used.  The default internal editor can also be
specified by setting {\et SPICE\_EDITOR} to nothing, ``{\vt default}'',
or ``{\vt xeditor}''.

\index{environment variables!TMPDIR}
\index{TMPDIR environment variable}
\item{\et TMPDIR}\\
This specifies a directory to use for temporary files, and is
superseded by {\et SPICE\_TMP\_DIR}, if defined.  The default location
if not specified is {\vt /tmp}.

\index{environment variables!SPICE\_TMP\_DIR}
\index{SPICE\_TMP\_DIR environment variable}
\item{\et SPICE\_TMP\_DIR}\\
When {\WRspice} creates a temporary file, it will look for a directory named
by the {\et SPICE\_TMP\_DIR} environment variable, and if not found the
directory named in the {\et TMPDIR} variable, and if still not found
the file will be created in {\vt /tmp}.

\index{environment variables!SPICE\_EXEC\_DIR}
\index{SPICE\_EXEC\_DIR environment variable}
\item{\et SPICE\_EXEC\_DIR}\\
This variable can be used to define the directory containing the
{\XicTools} binaries, used by the {\cb aspice} command and the {\vt
wrspiced} daemon.  If not set, the default is ``{\vt
/usr/local/xictools/bin}'', or, if {\vt XT\_PREFIX} is set, its
value replaces ``{\vt /usr/local}''.

\index{environment variables!SPICE\_PATH}
\index{SPICE\_PATH environment variable}
\item{\et SPICE\_PATH}\\
This can be used to set the full path to the {\WRspice} executable,
for the {\cb aspice} command and the {\vt wrspiced} daemon.  If not
set, the default is ``{\vt /usr/local/xictools/bin/wrspice}'',
or, if {\et XT\_PREFIX} is set, its value replaces ``{\vt
/usr/local}''.  The {\et SPICE\_EXEC\_DIR} variable can also be used
for this purpose, unless the {\vt wrspice} executable has been
renamed.  The {\et spicepath} shell variable, if set, will override
the path set in the environment.

\index{environment variables!SPICE\_LIB\_DIR}
\index{SPICE\_LIB\_DIR environment variable}
\item{\et SPICE\_LIB\_DIR}\\
This variable can be used to change the default location where
{\WRspice} looks for system startup files.  If not set, the internal
default is ``{\vt /usr/local/xictools/wrspice/startup}'', or, if
{\vt XT\_PREFIX} is set, its value replaces ``{\vt /usr/local}''.

\index{environment variables!SPICE\_INP\_PATH}
\index{SPICE\_INP\_PATH environment variable}
\item{\et SPICE\_INP\_PATH}\\
This can be set to a list of directories to search for input files and
scripts.  If not set, the internal default is ``{\vt ( . 
/usr/local/xictools/wrspice/scripts )}'', or, if {\et XT\_PREFIX}
is set, its value replaces ``{\vt /usr/local}''.

\index{environment variables!SPICE\_HLP\_PATH}
\index{SPICE\_HLP\_PATH environment variable}
\item{\et SPICE\_HLP\_PATH}\\
This can be set to a list of directories to search for help database
files.  If not set, the internal default is ``{\vt (
/usr/local/xictools/wrspice/help )}'', or, if {\et XT\_PREFIX} is
set, its value replaces ``{\vt /usr/local}''.  This is superseded by
the {\et helppath} shell variable, if set.

\index{environment variables!SPICE\_NEWS\_FILE}
\index{SPICE\_NEWS\_FILE environment variable}
\item{\et SPICE\_NEWS\_FILE}\\
This variable can be set to the full path to a text file which is
printed when {\WRspice} starts.  If not set, the file {\vt
/usr/local/xictools/wrspice/startup/news} will be printed, if it
exists (if {\et XT\_PREFIX} is set, its value replaces ``{\vt
/usr/local}'').

\index{environment variables!SPICE\_BUGADDR}
\index{SPICE\_BUGADDR environment variable}
\item{\et SPICE\_BUGADDR}\\
This variable can be set to an internet mail address to use in the bug
reporting command.  If not set, the built in default is the Whiteley
Research technical support address.

\index{environment variables!SPICE\_OPTCHAR}
\index{SPICE\_OPTCHAR environment variable}
\item{\et SPICE\_OPTCHAR}\\
This variable can be defined to a character that will be used to flag
options on the {\WRspice} command line.  If not defined, the option
character is ``$-$''.

\index{environment variables!SPICE\_ASCIIRAWFILE}
\index{SPICE\_ASCIIRAWFILE environment variable}
\item{\et SPICE\_ASCIIRAWFILE}\\
If this variable is defined to ``0'' (zero), or to a word starting
with `{\vt f}' or `{\vt F}' such as ``{\vt False}'', or `{\vt n}' or
`{\vt N}' such as ``{\vt No}'', {\WRspice} will create binary
plot-data files (rawfiles).  If not set or set to something else,
{\WRspice} will create the default ASCII-format rawfiles.  The {\et
filetype} shell variable can also be used to set the mode, which will
supersede the environment variable.  The rawfiles are normally created
with the {\cb write} command.

\index{environment variables!SPICE\_HOST}
\index{SPICE\_HOST environment variable}
\item{\et SPICE\_HOST}\\
This variable can be used to set the host name to use for remote SPICE
runs.  The host name can optionally be suffixed by a colon followed by
the port number to use for communication with the {\vt wrspiced}
daemon.  If not given, the port is obtained from the operating system
for ``{\vt wrspice/tcp}'', or 6114 (the IANA registered port number
for this service) if this is not defined.  There is no default for
this variable.  Hosts can also be specified with the {\cb rhost}
command, and given with the {\et rhost} shell variable.

\index{environment variables!SPICE\_DAEMONLOG}
\index{SPICE\_DAEMONLOG environment variable}
\item{\et SPICE\_DAEMONLOG}\\
This variable is used by the {\vt wrspiced} daemon program to set an
alternate path for the log file.  The default path is {\vt
/tmp/wrspiced.log}.

\index{environment variables!SPICENOMAIL}
\index{SPICENOMAIL environment variable}
\item{\et SPICENOMAIL}\\
If the variable {\et SPICENOMAIL} is set, no mail will be sent during
a program crash.  If a fatal error is encountered, a file named ``{\vt
gdbout}'' is created in the current directory, which contains a stack
backtrace from the stack frame of the error.  Despite the name, the
file is generated internally on all platforms, and no longer makes use
of the {\vt gdb} program.

By default, this file will be emailed to Whiteley Research for
analysis.  However, the emailing can be suppressed by setting this
variable in the environment.  The {\vt gdbout} file is produced in any
case, and would be very useful to Whiteley Research for fixing program
bugs.

\index{environment variables!XTNOMAIL}
\index{XTNOMAIL environment variable}
\item{\et XTNOMAIL}\\
This has the same effect as {\et SPICENOMAIL} but also prevents email
from the {\Xic} program.
\end{description}
\index{environment variables|)}


%S-----------------------------------------------------------------------------
\section{Sparse Matrix Package}
\index{sparse matrix package}
\index{KLU plug-in}

% spMain.hlp:sparse 062515

The core of a SPICE simulator is the set of functions that set up,
factor, and solve the circuit equations.  The circuit equations form a
matrix, whose elements, for most circuits, are mostly zero.  This type
of matrix is deemed ``sparse''.  The speed with which the matrix can
be filled, factored, and solved has a major impact on simulation
speed.

Historically, {\WRspice} has used a derivative of the venerable Sparse
package written by Ken Kundert at Berkeley for sparse matrix
processing.  The package has been modified for improved performance,
specifically by sorting the matrix elements into an order which
maximizes memory locality and minimizes page-swapping and cache
misses.  The original C-language package was also translated into a
set of C++ classes, improving maintainability and easing the
integration of enhancements.

Although the Sparse package provides solid performance, newer
algorithms have become available in recent years which, in some or
most cases, provide better performance.  The KLU package, written by
Tim Davis at the University of Florida, is one such example.  This
package is distributed under a GNU license, which prevents direct
incorporation into a proprietary commercial application such as
{\WRspice}, however commercial applications may use the package as a
shared library.

{\WRspice} distributions provide KLU in the form of a ``plug-in''.  A
plug-in is a shared library that is loaded directly by the application
at run-time, rather than relying on the system loader.  By using the
plug-in, the application can still run properly whether or not the
plug-in is available.  If loading was performed by the system as for a
normal shared library, {\WRspice} would not run unless the plug-in is
accessible.

The KLU plug-in is installed in the {\vt startup} directory in the
{\WRspice} installation area.  Thus, for normal installations, it
should always be accessible.  By default, {\WRspice} will load and use
KLU for spares matrix processing, overriding the Sparse package. 
However, it is possible to direct {\WRspice} to use Sparse rather than
KLU if desired. 

For large post-extraction mixed-mode CMOS circuits used for
benchmarking, the KLU package provides a 2-3 times improvement in
simulation speed over Sparse.  These circuits contain hundreds of
transistors, and thousands of resistors and capacitors.  For less
complex circuits, the speed advantage may be smaller, and in some
cases KLU may actually be slower.  KLU was observed to be slower in
rather simple circuits containing Josephson junctions.  Users are
encouraged to use the {\cb rusage} command and determine which package
provides the best performance on their circuits.

The following option variables control the sparse matrix handling. 
The first two can be set from the {\cb General} page of the {\cb
Simulation Options} tool.  The {\vt useadjoint} variable can be set
from the {\cb Devices} page of the {\cb Simulation Options} tool.  The
{\cb Simulation Options} tool is obtained from the {\cb Sim Opts}
button in the {\cb Tools} menu of the {\WRspice} {\cb Tool Control
Window}.  The variables can also be set with the {\cb set} command, or
in a {\vt .options} line in SPICE input.

\begin{description}
\item{\vt noklu}\\
When this boolean variable is set, KLU will not be used for sparse
matrix calculations.  Otherwise, if the KLU plug-in is available, KLU
will be used by default.  The KLU plug-in is provided with all
{\WRspice} distributions, and is installed in the startup directory.

\item{\vt nomatsort}\\
When using Sparse (i.e., KLU is unavailable or disabled), this
boolean variable when set will prevent using element sorting to
improve speed.  This corresponds to the legacy {\WRspice}
sparse code.  It may be interesting for comparison purposes, but
setting this variable will slow simulation of most circuits.
This variable has no effect if KLU is being used.

\item{\vt useadjoint}\\
Most of the BSIM device models in {\WRspice} have added code that
builds an adjoint matrix which is used to accurately compute device
currents.  The computed currents are not used in the device models,
but are available as simulation outputs.  This has a small performance
overhead so is not enabled by default, but will be enabled by setting
this variable.  Without this it may not be possible to obtain device
currents during the simulation, using the {\vt \@}{\it device\/}{\vt
[}{\it param\/}{\vt ]} ``pseudo-vector''.  This applies whether KLU or
Sparse is used for matrix operations.
\end{description}


%S-----------------------------------------------------------------------------
\section{Initialization Files}
\index{initialization files}
\index{startup file}
\label{startup}

% spSetup.hlp:startup_files 102817

Prior releases of {\WRspice} could be configured to check for the
availability of program updates on startup.  There was also provision
for display of a message if one was ``broadcast'' from the Whiteley
Research web site.  This latter feature was never used, and neither
feature is currently supported in {\WRspice}.  Thus, there is no
longer a network access attempt on program startup, which may save
time.

Program updates are handled in the help system (see \ref{update}),
for all of the {\XicTools} packages.  Either the help system built
into {\Xic} and {\WRspice}, or the stand-alone {\it mozy} program can
be used to check for, download, and install updates.  Giving the
keyword ``{\vt :xt\_pkgs}'' will display a page that provides update
information and download/install buttons.

If a new {\WRspice} release is run for the first time, the
release notes will appear in a pop-up window, as if the {\cb Notes}
button in the {\cb Help} menu was pressed.  There is a file in the
user's {\vt .wr\_cache} directory named ``{\vt
wrspice\_current\_release}'' that contains a release number.  If, when
{\WRspice} starts, this file is missing or the release number is not
current, {\WRspice} will show the release notes and update the file. 
If the release numbers match, there is no action.

\index{wrspiceinit file}
{\WRspice} will attempt to source startup files used for
initialization when the program is started.  First, a file named
``{\vt wrspiceinit}'' is searched for in the system startup directory,
and if found is sourced into {\WRspice}.  The system startup directory
has a default location built into the program\\
({\vt /usr/local/xictools/wrspice/startup}, or if {\et XT\_PREFIX}
is set in the environment, its value replaces ``{\vt /usr/local}''),
but this can be changed by setting the {\et SPICE\_LIB\_DIR}
environment variable to another location.

\begin{description}
%\ifxtlserv
%\index{license.host file}
%\item{{\vt license.host} file}\\
%When using a license server on a remote machine, it is necessary to
%provide the name of this machine or {\WRspice} can not run.  One way
%to do this is to create a {\vt license.host} file in the startup
%directory, e.g. {\vt /usr/local/xictools/wrspice/startup}.  The
%{\vt license.host} file consists of a single line of text, giving the
%host name of the license server machine.  The host name can optionally
%be suffixed with ``{\vt :}{\it port\/}'', where {\it port} is the port
%number in use by the license server.  This is required if for some
%reason the license server is not running on the default port.
%\fi

\index{.wrspiceinit file}
\item{{\vt .wrspiceinit} file}\\
Files named ``{\vt .wrspiceinit}'' are searched for in the user's home
directory, and the current directory, and are sourced, if found, in
that order.  If running on Microsoft Windows which does not support
the notion of a home directory, {\WRspice} will look in the
environment for a variable named ``{\et HOME}'', and its value will be
taken as the path to the "home directory".  If not set, the search is
skipped.

These files have identical format, and contain ordinary script
commands, which can be used to set the default behavior of {\WRspice}. 
The first line is ignored, but all remaining lines are taken as script
commands.  The special directive {\vt tbsetup}, which can only appear
in these files, provides the setup information for the graphical
interface.  Unlike ordinary input files, it is not necessary to
enclose the commands in {\vt .control} or {\vt .exec} blocks in the
startup files.

\index{X resources}
\index{colors, setting}
\item{X Resources}\\
When using the X-window system, the X resource-passing mechanism can
be used to set the default colors used in plots.  The resource
mechanism is otherwise ignored in the current version of {\WRspice}. 
The base names for the color resources are ``{\vt color0}'' through
``{\vt color19}'', with the corresponding class names capitalized. 
Thus, one way to define alternative plotting colors is to create a
file named ``{\vt Wrspice}'' in the user's home directory, which
contains lines like
\begin{quote}\vt
*color2: red
\end{quote}
for each new color definition.  The color name should be known to the
X window system, i.e., be listed in the {\vt rgb.txt} file in the
X-windows system library.

The same definitions could be placed in a {\vt .wrspiceinit} file with
lines like ``{\vt set color2 = red}''.
\end{description}

%SU-------------------------------------
\subsection{The {\vt tbsetup} Command}

\index{startup file}
\index{tbupdate command}
\index{Update Tools button}
\index{tbsetup command}

% spSetup:tbsetup 012709

This command can appear in the startup files only.  It is inserted
into or updated in the {\vt .wrspiceinit} file in the user's home
directory in response to the {\cb tbupdate} command, or from pressing
the {\cb Update Tools} button in the {\cb File} menu of the {\cb Tool
Control window}.  It is not likely that the user will need to work
with {\cb tbsetup} directly, though it can be used to customize the
{\cb Tools} menu in the {\cb Tool Control} window.

The command string takes the following form:
\begin{lquote}{\vt
tbsetup [old] [vert] [toolbar on|off {\it x y}] [{\it name1} on|off {\it x y}]
 [{\it name2} ...}
\end{lquote}
The {\vt old} and {\vt vert} keywords are ignored.  They exist for
backward compatibility.

By invoking the {\cb tbupdate} command from the prompt line or
pressing the {\cb Update Tools} button in the {\cb File} menu of the
{\cb Tool Control} window, a {\vt .wrspiceinit} file is created in the
user's home directory if necessary, and the {\cb tbsetup} command will
be added or updated.  This will save the current state of the windows
from the {\cb Tools} menu, which will be recreated when the program is
started the next time.

If no {\cb tbsetup} command is found on program startup, a
default configuration is used (all tools initially invisible).

For each argument block in the {\cb tbsetup} call, the first token
gives the tool name, with the ``{\vt toolbar}'' entry indicating the
{\cb Tool Control} window itself.  For other than the {\cb Tool
Control} window, which is always shown, the {\vt on} and {\vt off}
keywords specify whether the tools are shown at startup.  The two
numbers that follow give the position of the upper left corner of the
tool on the screen (the screen origin is the upper left corner,
coordinates are in pixels).  For other than the first ({\cb Tool
Control} window) entry, the blocks can be rearranged or deleted.  The
{\cb Tools} menu will show only the tools listed, in the order given. 
Thus, the {\cb Tools} menu can be customized.

To generate an initial custom configuration, simply start {\WRspice}
on a system that supports graphics, and the {\cb Tool Control} window
will appear somewhere on-screen.  After opening some of the tools from
the {\cb Tools} menu and arranging them as necessary and/or moving the
{\cb Tool Control} window, the {\cb Update Tools} button in the {\cb
File} menu can be pressed.  A {\vt .wrspiceinit} file will be created,
or an existing file updated, in the user's home directory. 
Alternatively, the {\cb tbupdate} command can be given from the
command line.  Hand editing of the {\vt .wrspiceinit} file may be used
to remove buttons or change the button order in the {\cb Tools} menu. 
Once edited, only the tools present will be updated.


%S-----------------------------------------------------------------------------
\section{The Tool Control Window}
\index{DISPLAY environment variable}
\label{tcwin}

% spToolbar.hlp:graphics 012615

When the {\et DISPLAY} variable is found in the environment upon
program startup, {\WRspice} assumes that a graphical (X-window) server
is available, and will enable its graphical components.  If this
initialization fails, {\WRspice} will terminate.  If the {\et DISPLAY}
variable is not set, and the {\vt -d} option is not used on the
command line to specify the display, or the {\vt -dnone} command line
option is given, then {\WRspice} will run in text-only mode.  In this
mode, the core functionality is available, but not the graphical
niceties such as plotting (other than the infamous crude line-printer
plots of yore).  Under Microsoft Windows, graphics is (of course)
always available.

% spToolbar.hlp:toolbar 022519

\index{tool control window}
When a graphical interface is available, {\WRspice} by default
provides a small {\cb Tool Control} window which provides menus for
controlling {\WRspice}, and a display containing a tabulation of
memory statistics.  The menus contain buttons which bring up graphical
screens, from which much most of {\WRspice} can be controlled in a
(perhaps) more user-friendly fashion.  The locations of the pop-ups
and their active/inactive status at program startup can be preset by
the user.

When running {\WRspice} through the {\Xic} program, by default the
{\cb Tool Control} window will appear when connection to {\WRspice}
has been established.  The {\Xic} variable {\et NoSpiceTools} can be
set, before the connection is established, to prevent the {\cb Tool
Control} window from appearing.

\index{memory statistics}
The text area lists the following quantities, though some may not be
listed if the operating system does not provide this information. 
The listing is updated every few seconds.  The first line of text
shows the current running status of {\WRspice}:  idle, running, or
stopped.  Also shown on this line is the elapsed wall-clock time
from the last status change.  The time format is
hours:minutes:seconds.  The seconds entry has two decimal places
(resolution is .01 second).  The hours field is not included if
zero.  The {\cb user} and {\cb system} lines are similar, but display
the total user cpu time used by the process, and the total system cpu
time, respectively.  The user time generally includes input/output
processing time, where the system time is pure cpu usage.  The {\cb
data size} entry displays the total allocated memory in Kb used by the
program.  This is only the memory allocated by the program for data,
and does not include additional memory overhead reported by programs
such as {\vt top} and {\vt ps}.  This size is limited to the {\cb
program limit}, which is given in the following line.  This limit can
be changed with the {\et maxdata} variable.  The final {\cb system
limit} line displays the maximum memory available from the system for
the process.

\index{drag and drop}
{\WRspice} supports the {\et xdnd} and {\et Motif} drag and drop
protocols.  One is able to drag files from many file manager programs
into the {\cb Tool Control} window of {\WRspice} or the main window of
{\Xic}, and that file will be loaded into the program.  The File
Selection and Files Listing pop-ups participate in the protocols as
sources and receivers.  The text editor and mail pop-ups are drag
receivers.

The file must be a standard file on the same machine.  If it is from a
tar file, or on a different machine, first drag it to the desktop or
to a directory, then into {\WRspice}.  (Note:  The GNOME {\vt gmc}
file manager allows one to view the contents of tar files, etc.  as a
``virtual file system''.  Window Maker and Enlightenment window
managers, at least, are drag/drop aware.)

\index{WR button}
In the upper left of the {\cb Tool Control} window is the {\cb WR}
button, which contains the Whiteley Research corporate logo.  Pressing
this button brings up a mail client (see \ref{mailclient}), pre-loaded
with the address of the Whiteley Research support staff.  The text
field containing the address, as well as the subject, can be changed. 
This can be used to send questions and bug reports to Whiteley
Research, or to send messages or data files to colleagues.

To the right of the {\cb WR} button are the {\cb Run} (green arrow)
and {\cb Stop} (red X) buttons.  Pressing the {\cb Run} button is
equivalent to giving the {\cb run} command on the command line,
without arguments.  Pressing the {\cb Stop} button issues an interrupt
signal that will pause a simulation in progress, the same as if the
user typed {\kb Ctrl-C} in the console window.

To the right of the buttons is a menu bar with four entries:  {\cb
File}, {\cb Edit}, {\cb Tools}, and {\cb Help}.  Pressing the mouse
button 1 on these entries brings up a drop-down menu containing
various commands.

The {\cb File} menu contains commands for manipulating disk files.

\begin{description}
\item{\cb File Select}\\
Bring up a file manager panel.  This panel allows files and
directories to be created, deleted, and renamed, or read into
{\WRspice}.  The file manager is described in \ref{filemgr}.

\item{\cb Source}\\
This button creates a dialog, soliciting a file to input into
{\WRspice}, as with the {\cb source} command.  When the dialog is
active, the {\cb Tool Control} text window is active as a drag
receiver, so that file names can be dragged and dropped from
compatible windows (such as the file manager), and the file name will
be loaded into the dialog.

\item{\cb Load}\\
This button is similar in operation to the {\cb Source} button,
however the file is expected to be a rawfile, which is the native
plot-file format, or a Common Simulation Data Format (CSDF) file. 
Like the {\cb Source} dialog, the {\cb Load} dialog supports drag and
drop protocols through the text area of the {\cb Tool Control} window. 
The file is read and data are made available for analysis, similar to
the {\cb load} command.

\item{\cb Update Tools}\\
The {\cb Update Tools} button will save the current tool
configuration, and the next time {\WRspice} is started, the same tools
will be available, in the same locations on-screen.  The tools are
available in the {\cb Tools} menu to be described.

Initialization of the graphical interface is directed from the system
init file {\vt wrspiceinit} found in the startup directory, or more
appropriately from the user's startup files ({\vt .wrspiceinit} files)
as found in the current or user's home directory.  Only the file in
the home directory can be automatically updated from within
{\WRspice}.  A special command {\vt tbsetup}, which is only recognized
in these files, performs the initialization.  The {\vt tbsetup}
function takes a long, messy command line, however fortunately the
user has an easy way to automatically add this line, using the
{\cb Update Tools} command.  This action is also available from the
command line {\cb tbupdate} command.

The {\cb Update Tools} and {\cb tbupdate} commands will create or
update a {\vt .wrspiceinit} file in the user's home directory.  If the
home directory can't be determined, the current directory will be
used.

\item{\cb Update WRspice}\\
Pressing this button is equivalent to giving the {\cb wrupdate}
command, and is equivalent to giving the special keyword ``{\vt
:xt\_pkgs}'' to the help system, which brings up the {\XicTools}
package management page (see \ref{update}).  The page lists
installed and available packages for each of the {\XicTools} programs
for the current operating system, and provides buttons to download and
install the packages.

Unlike in earlier {\WRspice} releases, there is no provision for
automatic checking for updates, so this command or equivalent should
be run periodically to check for updated packages.  The computer must
have http access to the internet for successful use of this
functionality.

\item{\cb Quit}\\
The {\cb Quit} button will terminate the {\WRspice} session, after
confirmation if there is unsaved work.  This can also be accomplished
with the {\cb quit} or {\cb exit} command line functions.
\end{description}

The {\cb Edit} menu contains commands used to modify input files.

\begin{description}
\item{\cb Text Editor}\\
This button brings up a text editor, similar to the {\cb edit}
command.  The default text editor is described in \ref{textedit},
but the user can specify a different editor with the {\et EDITOR} or
{\et SPICE\_EDITOR} environment variables, or with the {\et editor}
variable.

\item{\cb Xic}\\
This button launches the {\Xic} program, if it is available.
\end{description}

For schematic capture, the {\Xic} program must be installed.  When
either editor is started, the currently loaded circuit, if any, and if
it has graphical information in the case of {\Xic}, is loaded into the
editor.  The simulation process can be initiated and controlled
through {\Xic}.  The internal text editor has a {\cb Source} button,
which allows the modified circuit to be passed directly back to
{\WRspice} for simulation.  If another editor is used, changes will
have to be saved to disk and sourced from {\WRspice}.

\index{Tools menu}
The {\cb Tools} menu contains a configurable collection of command
buttons which initiate pop-ups which control or display various
aspects or {\WRspice}.  Each of these pop-ups is a graphical short cut
to a collection of command line commands.  Many users prefer the
point-and-click interface to the command line, though some do not. 
With {\WRspice}, the user has a choice.  The command functions
available in the {\cb Tools} menu are listed below, in the order found
in the menu.

\begin{description}
\item{\cb Fonts}\\
\index{Fonts tool}
This brings up the {\cb Font Selection} panel (see \ref{fontspanel})
that allows selection of the font used in the text areas of the
various tools, and in plot windows used for displaying simulation
results.

\item{\cb Files}\\
\index{Files tool}
Pop up the {\cb Path Files Listing} panel (see \ref{filespanel}) which
displays a list of the files found along the {\et sourcepath}.  Files
can be sourced or edited through this panel.

\item{\cb Circuits}\\
\index{Circuits tool}
Bring up the {\cb Circuits} panel (see \ref{circuitspanel}) listing
the circuits that are currently in memory.  The panel provides
capabilities for choosing the current circuit and deleting circuits
from memory.

\item{\cb Plots}\\
\index{Plots tool}
Bring up the {\cb Plots} panel (see \ref{plotspanel}) which displays a
list of the plots in memory.  The panel provides capabilities for
selecting the current plot, and for deleting plots.

\item{\cb Plot Opts}\\
\index{Plot Options tool}
Bring up the {\cb Plot Options} panel (see \ref{plotopts}) to
control the myriad of variables associated with plotting.

\item{\cb Colors}\\
\index{Colors tool}
Bring up the{\cb Plot Colors} panel (see \ref{colors}) to set the
colors used in the plots.

\item{\cb Vectors}\\
\index{Vectors tool}
Pop up the {\cb Vectors} panel (see \ref{vectorspanel}) listing the
vectors in the current plot.  The panel provides an interface for
plotting or printing these vectors.

\item{\cb Variables}\\
\index{Variables tool}
Pop up the {\cb Variables} panel (see \ref{variablespanel}) displaying
the shell variables currently set.

\item{\cb Shell}\\
\index{Shell tool}
Bring up the {\cb Shell Options} panel (see \ref{shellopts}) used to
control the default settings associated with the {\WRspice} shell.

\item{\cb Sim Opts}\\
\index{Simulation Options tool}
Pop up the {\cb Simulation Options} panel (see \ref{simopts}) used
to modify the variables which affect circuit simulation.

\item{\cb Commands}\\
\index{Commands tool}
Bring up the {\cb Command Options} panel (see \ref{cmdopts}) to
customize the variables associated with the various commands.

\item{\cb Runops}\\
\index{Runops tool}
Pop up the {\cb Runops} panel (see \ref{runoppanel}) which lists the
``runops'' currently in effect.  The runops are directives to
interactively plot, or trace variables during simulation, or to pause
the simulation when a condition is met.  The panel provides capability
for deactivating or deleting runops.

\item{\cb Debug}\\
\index{Debug tool}
Bring up the {\cb Debug Options} panel (see \ref{dbgopts}) used to
control the debugging modes of {\WRspice}.
\end{description}

\index{Help menu}
The {\cb Help} menu provides entry into the help system, and provides
access to other information.  The buttons found in this menu are listed
below.

\begin{description}
\item{\cb Help}\\
Bring up the help viewer loaded with the top-level page.  The help
system provides an extensive cross-referenced HTML database, and
contains the latest information on {\WRspice} features.  The help
system is described in \ref{helpsys}.

\item{\cb About}\\
Bring up a text window with the current {\WRspice} version number,
copyright, and legal disclaimer.

\item{\cb Notes}\\
Bring up a text browser loaded with the release notes for the current
release of {\WRspice}.  The release notes provide detailed information
about changes in the present release, and serve as a supplement to the
manual.  Changes and new features should also have been incorporated
into the help database.
\end{description}

%SU-------------------------------------
% textentry 040913
\section{Text Entry Windows}
\index{text entry windows}

The GTK interface provides single and multi-line text entry windows
for use in the graphical interface.  These entry areas use a common
set of key bindings (see \ref{textkeybind}) and respond to and use the
system clipboard (see \ref{clipboard}) and other selection mechanisms
in the same way.


% onelineentry 040913
\subsection{Single-Line Text Entry}

In many operations, text is entered by the user into single-line
text-entry areas that appear in pop-up windows.  These entry areas
provide a number of editing and interprocess communication features
which will be described in subsequent sections.

In both Unix/Linux and Windows, the single-line entry is typically
also a receiver of drop events, meaning that text can be dragged form
a drag source, such as the {\cb File Manager}, and dropped in the
entry area by releasing button 1.  The dragged text will be inserted
into the text in the entry area, either at the cursor or at the drop
location, depending on the implementation.


% clipboard 040913
\subsection{Selections and Clipboards}
\label{clipboard}
 
Under Unix/Linux, there are two similar data transfer registers:  the
``primary selection'', and the ``clipboard''.  both correspond to
system-wide registers, which can accommodate one data item (usually a
text string) each.  When text is selected in any window, usually by
dragging over the text with button 1 held down, that text is
automatically copied into the primary selection register.  The primary
selection can be ``pasted'' into other windows that are accepting text
entry.

The clipboard, on the other hand, is generally set and used only by
the GTK text-entry widgets.  This includes the single-line entry used
in many places, and the multi-line text window used in the text editor
(see \ref{textedit}), file browser, and some other places including
error reporting and info windows.  From these windows, there are key
bindings that cut (erase) or copy selected text to the clipboard, or
paste clipboard text into the window.  The cut/paste functions are
only available if text in the window is editable, copy is always
available.

Under Windows there is a single ``Windows clipboard'' which is a
system-wide data-transfer register that can accommodate a single data
item (usually a string).  This can be used to pass data between
windows.  In use, the Windows clipboard is somewhat like the
Unix/Linux clipboard.
 
Text in most text display windows can be selected by dragging with
button 1 held down, however the selected text is not automatically
added to the Windows clipboard.  On must initiate a {\cb cut} or {\cb
copy} operation in the window to actually save the selected text to
the Windows clipboard.  The ``copy to clipboard'' accelerator
{\kb Ctrl-c} is available from most windows that present highlighted
or selected text.  Note that there is no indication when text is
copied to the clipboard, the selected text in all windows is
unaffected, i.e., it won't change color or disappear.  The user must
remember which text was most recently copied to the Windows clipboard.

Clicking with button 2 will paste the primary selection into the line
at the click location, if the window text is editable.

Clicking with button 3 will will bring up a context menu.  From the
menu, the user can select editing operations.

The GTK interface hides the details of the underlying selection
mechanisms, creating a consistent interface under Windows or
Uniix/Linux.  There is one important difference, however:  in Windows,
the primary selection applies only to the program containing the
selection.  In Unix/Linux, the primary selection applies to the entire
desktop,


% textkeybind 040913
\subsection{GTK Text Input Key Bindings}
\label{textkeybind}

The following table provides the key bindings for editable text entry
areas in GTK-2.  However, be advised that these bindings are
programmable, and may be augmented or changed by installation of a
local theme.

\begin{longtable}{lp{4in}}\\
\multicolumn{2}{l}{\bf GTK Single-Line Bindings}\vspace{1.5ex}\\
\kb Ctrl-a & Select all text\\
\kb Ctrl-c & Copy selected text to clipboard\\
\kb Ctrl-v & Paste clipboard at cursor\\
\kb Ctrl-x & Cut selection to clipboard\\
\kb Home & Move cursor to beginning of line\\
\kb End & Move cursor to end of line\\
\kb Left & Move cursor left one character\\
\kb Ctrl-Left & Move cursor left one word\\
\kb Right & Move cursor right one character\\
\kb Ctrl-Right & Move cursor right one word\\
\kb Backspace & Delete previous character\\
\kb Ctrl-Backspace & Delete previous word\\
\kb Clear & Delete current line\\
\kb Shift-Insert & Paste clipboard at cursor\\
\kb Ctrl-Insert & Copy selected text to clipboard\\
\kb Delete & Delete next character\\
\kb Shift-Delete & Cut selected text to clipboard\\
\kb Ctrl-Delete & Delete next word\\
\end{longtable}

Clicking with button 1 will move the cursor to that location.  Double
clicking will select the clicked-on word.  Triple clicking will select
the entire line.  Button 1 is also used to select text by dragging the
pointer over the text to select.

Clicking with button 2 will paste the primary selection into the line
at the click location, if the window text is editable.

Clicking with button 3 will will bring up a context menu.  From the
menu, the user can select editing operations.

These operations are basically the same in Windows and Unix/Linux,
with one important difference:  in Windows, the primary selection
applies only to the program containing the selection.  In Unix/Linux,
the primary selection applies to the entire desktop, like the
clipboard.


%S-----------------------------------------------------------------------------
\section{The File Manager}
\label{filemgr}
\index{file manager}

% FileSel.hlp:filemgr 032513

\index{File Selection window}
The File Selection pop-up allows the user the navigate the host's
file systems, and select a file for input to the program.

The panel provides two windows; the left window displays the
subdirectories in a tree format, and the right window displays a
listing of files in a columnar form.  The panel is similar in
operation to the Windows Explorer tool provided by Microsoft.

When the panel first appears, the directories listing contains a
single entry, which is shown selected, and the files window contains a
list of files found in that directory.  The tree ``root'' is selected
by the application, and may or may not be the current directory.  If
the directory contains subdirectories, a small box containing a `{\vt
+}' symbol will appear next to the directory entry.  Clicking on the
`{\vt +}' will cause the subdirectories to be displayed in the
directory listing, and the `{\vt +}' will change to a `{\vt -}'. 
Clicking again on the `{\vt -}' will hide the subdirectory entries. 
Clicking on a subdirectory name will select that subdirectory, and
list its files in the files listing window.  The `{\vt +}' box will
appear with subdirectories only after the subdirectory is selected.

Clicking on the blue triangle in the menu bar will push the current
tree root to its parent directory.  If the tree root is pushed to the
top level directory, the blue triangle is grayed.  The label at the
bottom of the panel displays the current root of the tree.  There is
also a {\cb New Root} item in the {\cb File} menu, which allows the
user to enter a new root directory for the tree listing.  In Windows,
this must be used to list files on a drive other than the current
drive.

The {\cb Up} menu is similar, but it produces a drop-down list of
parent directories.  Selecting one of the parents will set the root to
that parent, the same as pressing the blue triangle button multiple
times to climb the directory tree.

The {\cb New CWD} button in the {\cb File} menu allows the user to
enter a new current working directory for the program.  This will also
reset the root to the new current working directory.  The small dialog
window which receives the input, and also a similar dialog window
associated with the {\cb New Root} button, are sensitive as drop
receivers for files.  In particular, one can drag a directory from the
tree listing and drop it on the dialog, and the text of the dialog
will be set to the full path to the directory.

The files listed in the files listing always correspond to the
currently selected directory.  File names can be selected in the files
listing window, and once selected, the files can be transferred to the
calling application.  The {\cb Go} button, which has a green octagon
icon, accomplishes this, as does the {\cb Open} entry in the {\cb
File} menu.  These buttons are only active when a file is selected. 
One can also double-click the file name which will send the file to
the application, whether or not the name was selected.

\index{drag and drop}
Files can be dragged and dropped into the application, as an
alternative to the {\cb Go} button.  Files and directories can also be
dragged/dropped between multiple instances of the File Selection
pop-up, or to other file manager programs, or to other directories
within the same file manager pop-up.  The currently selected directory
is the target for files dropped in the files listing window.  When
dragging in the directory listing, the underlying directory is
highlighted.  The highlighted directory will be the drop target.

A confirmation pop-up will always appear after a drag/drop.  This
specifies the source and destination files or directories, and gives
the user the choice of moving, copying or (if not in Windows)
symbolically linking, or aborting the operation.

The {\cb File} menu contains a number of commands which provide
additional manipulations.  The {\cb New Folder} button will create a
subdirectory in the currently selected directory (after prompting for
a name).  The {\cb Delete} button will delete the currently selected
file.  If no file is selected, and the currently selected directory
has no files or subdirectories, it will be deleted.  The {\cb Rename}
command allows the name of the currently selected file to be changed. 
If no file is selected, the name change applies to the currently
selected directory.

The {\cb Listing} menu contains entries which affect the file name
list.  By default, all files are listed, however the user can restrict
the listing to certain files with the filtering option.  The {\cb Show
Filter} button displays an option menu at the bottom of the files
listing.  The first two choices are ``all files'' and the set of
extensions known to correspond to supported layout file formats.  The
remaining choices are editable and can be set by the user.  The format
is the same as one uses on a Unix command line for, e.g., the {\vt ls}
command, except that the characters up to the first colon (`:') are
ignored.  It is intended that the first token be a name for the
pattern set, followed by a colon.  The remaining tokens are
space-separated patterns, any one of which if matching a file will
cause the file to be listed.

In matching filenames, the character `{\vt .}' at the beginning of a
filename must be matched explicitly.  The character `{\vt
*}' matches any string of characters, including the null string.  The
character `{\vt ?}' matches any single character.  The sequence
`$[...]$' matches any one of the characters enclosed.  Within
`$[...]$', a pair of characters separated by `{\vt -}' matches any
character lexically between the two.  Some patterns can be negated:
The sequence `$[\symbol{94}...]$' matches any single character not
specified by the characters and/or ranges of characters in the braces.
An entire pattern can also be negated with `{\vt \symbol{94}}'.  The
notation `{\vt a\{b,c,d\}e}' is a shorthand for `{\vt abe ace ade}'.

The {\cb Relist} button will update the files list.  The file listing
is automatically updated when a new filter is selected, or when {\kb
Enter} is pressed when editing a filter string.

The files are normally listed alphabetically, however if {\cb List by
Date} is selected, files will be listed in reverse chronological order
of their creation or last modification time.  Thus, the most-recently
modified file will be listed first.

The {\cb Show Label} toggle button controls whether or not the label
area is shown.  The label area contains the root directory and current
directory, or a file info string.  By default, the label area is shown
when the pop-up is created as a stand-alone file selector, but is not
shown when the pop-up appears as an adjunct when soliciting a file
name.

When the pointer is over a file name in the file listing, info about
the file is printed in the label area (if the label area is visible).
This is a string very similar to the ``{\vt ls -l}'' file listing in
Unix/Linux.  It provides:

\begin{enumerate}
\item{The permission bit settings and file type codes as in
  ``{\vt ls -l}'' (Unix/Linux only).}
\item{The owner and group (Unix/Linux only).}
\item{The file size in bytes.}
\item{The last modification date and time.}
\end{enumerate}

While the panel is active, a monitor is applied to the listed files
and directories which will automatically update the display if the
directories change.  The listings should respond to external file or
directory additions or deletions within half a second.


%S-----------------------------------------------------------------------------
% TextEditor.hlp:xeditor 040913
\section{The Text Editor}
\label{textedit}
\index{text editor}

The graphical interface provides a general-purpose text editor window. 
It is used for editing text files or blocks, and may be invoked in
read-only mode for use as a file viewer.  In that mode, commands which
modify the text are not available.

This is not the world's greatest text editor, but it
works fine for quick changes and as a file viewer.  For
industrial-strength editing, a favorite stand-alone text editor is
probably a better choice. 

The following commands are found in the {\cb File} menu of the
editor.  Not all of these commands may be available, for example the
{\cb Open} button is absent when editing text blocks.

\begin{description}
\item{\cb Open}\\
Bring up the {\cb File Selection} panel.  This may be used to select a
file to load into the editor.  This is the same file manager available
from the {\cb Open} button in the {\cb File} menu of the {\cb Tool
Control Window}.

\item{\cb Load}\\
Bring up a dialog which solicits the name of a file to edit.  If the
current document is modified and not saved, a warning will be issued,
and the file will not be loaded.  Pressing {\cb Load} a second time
will load the new file, discarding the current document.

\item{\cb Read}\\
Bring up a dialog which solicits the name of a file whose text is to
be inserted into the document at the cursor position.

\item{\cb Save}\\
Save the document to disk, or back to the application if editing a
text block under the control of some command.

\item{\cb Save As}\\
Pop up a dialog which solicits a new file name to save the current
document under.  If there is selected text, the selected text will be
saved, not the entire document.

\item{\cb Print}\\
Bring up a pop-up which enables the document to be printed to a
printer, or saved to a file.

\item{\cb Write CRLF}\\
This menu item appears only in the Windows version.  It controls the
line termination format used in files written by the text editor.  The
default is to use the archaic Windows two-byte (DOS) termination.  If
this button is unset, the more modern and efficient Unix-style
termination is used.  Older Windows programs such as Notepad require
two-byte termination.  Most newer objects and programs can use either
format, as can the {\XicTools} programs.

\item{\cb Quit}\\
Exit the editor.  If the document is modified and not saved, a warning
is issued, and the editor is not exited.  Pressing {\cb Quit} again
will exit the editor without saving.

The editor can also be dismissed with the window manager ``dismiss
window'' function, which may be an `{\cb X}' button in the title bar. 
This has the same effect as the {\cb Quit} button.
\end{description}

The editor is sensitive as a drop receiver.  If a file is dragged into
the editor and dropped, and neither of the {\cb Load} or {\cb Read}
dialogs is visible, the {\cb Load} dialog will appear with the name of
the dropped file preloaded into the dialog text area.  If the drop
occurs with the {\cb Load} dialog visible, the dropped file name will
be entered into the {\cb Load} dialog.  Otherwise, if the {\cb Read}
dialog is visible, the text will be inserted into that dialog.

If the {\kb Ctrl} key is held during the drop, and the text is not
read-only, the text will instead be inserted into the document at the
insertion point.

The following commands are found in the {\cb Edit} menu of the
text editor.

\begin{description}
\item{\cb Undo}
This will undo the last modification, progressively.  The number of
operations that can be undone is unlimited.

\item{\cb Redo}
This will redo previously undone operations, progressively.
\end{description}

The remaining entries allow copying of selected text to and from other
windows.  These work with the clipboard provided by the operating
system, which is a means of transferring a data item between windows
on the desktop (see \ref{clipboard}).

\begin{description}
\item{\cb Cut to Clipboard}\\
Delete selected text to the clipboard.  The accelerator {\kb Ctrl-x}
also performs this operation.  This function is not available if the
text is read-only.

\item{\cb Copy to Clipboard}\\
Copy selected text to the clipboard.  The accelerator {\kb Ctrl-c}
also performs this operation.  This function is available whether or
not the text is read-only.

\item{\cb Paste from Clipboard}\\
Paste the contents of the clipboard into the document at the cursor
location.  The accelerator {\kb Ctrl-v} also performs this operation. 
This function is not available if the text is read-only.

\item{\cb Paste Primary} (Unix/Linux only)\\
Paste the contents of the primary selection register into the document
at the cursor location.  The accelerator {\kb Alt-p} also performs
this operation.  This function is not available if the text is
read-only.
\end{description}

The following commands are found in the {\cb Options} menu of the
editor.

\begin{description}
\item{\cb Search}\\
Pop up a dialog which solicits a regular expression to search for in
the document.  The up and down arrow buttons will perform the search,
in the direction of the arrows.  If the {\cb No Case} button is
active, case will be ignored in the search.  The next matching text in
the document will be highlighted.  If there is no match, ``not found''
will be displayed in the message area of the pop-up.

The search starts at the current text insertion point (the location of
the I-beam cursor).  This may not be visible if the text is read-only,
but the location can be set by clicking with button 1.  The search
does not wrap.

\item{\cb Source}\\
Read the content of the editor into {\WRspice} as through the {\cb
source} command.  One can also save the file to disk, and use the {\cb
source} command directly.

\item{\cb Font}\\
This brings up a tool for selecting the font to use in the text
window.  Selecting a font will change the present font, and will set
the default font for new text editor class windows.  This includes the
file browser and mail client pop-ups.
\end{description}

The GTK interface provides a number of default key bindings (see
\ref{textkeybind}) which also apply to single-line text entry windows. 
These are actually programmable, and the advanced user may wish to
augment the default set locally.


%S-----------------------------------------------------------------------------
\section{The Mail Client}
\label{mailclient}
\index{mail window}

% TextEditor.hlp:mailclient 072808

The mail client can be used to send mail to arbitrary mail addresses,
though when the panel appears, it is pre-loaded with the address of
Whiteley Research technical support.  The text field containing the
address, as well as the subject, can be changed.
    
The main text window is a text editor with operations similar to the
text editor used elsewhere in {\Xic} and {\WRspice}.  The {\cb File}
menu contains commands to read another text file into the editor at
the location of the cursor ({\cb Read}), save the text to a file ({\cb
Save As}) and send the text to a printer ({\cb Print}).  When done,
the {\cb Send Mail} command in the {\cb File} menu is invoked to
actually send the message.  Alternatively, one can quit the mail
client without sending mail by pressing {\cb Quit}.

The {\cb Edit} menu contains commands to cut, copy, and paste text.

The {\cb Options} menu contains a {\cb Search} command to find a text
string in the text.  The {\cb Attach} command is used to add a mime
attachment to the message.  Pressing this button will cause prompting
for the name of a file to attach.  While the prompt pop-up is visible,
dragging a file into the mail client will load that file name into the
pop-up.  This is also true of the {\cb Read} command.  Attachments are
shown as icons arrayed along the tool bar of the mail client. 
Pressing the mouse button over an attachment icon will allow the
attachment to be removed.

\index{MAPI}
In the Windows version, since Windows does not provide a reliable
interface for internet mail, the mail client and crash-dump report may
not work.  Mail is sent by passing the message to a Windows interface
called ``MAPI'', which in turn relies on another installed program to
actually send the mail.  In the past, the mail system was known to
work if Outlook Express was installed and configured as the "Simple
MAPI mail client".  It is unknown whether this is still an option with
recent Windows releases.

To get mail working in Windows 8, it was necessary to download and
install something called ``{\vt live mail}'' from Microsoft, which
eventually worked.  This application supports MAPI, apparently the
default Windows 8 Mail application does not.  The default Windows 8
Mail application also does not work with POP3 servers.


% not in help
%S-----------------------------------------------------------------------------
\section{The Tools Menu Tools and Panels}

The sub-sections describe the tools and panels that are obtained from
buttons in the {\cb Tools} menu of the {\cb Tool Control} windows. 
These provide a graphical interface to list data and manipulate
{\WRspice}, supplementing the traditional command line interface.

% spToolbar.hlp:fontspanel 012709
%SU-------------------------------------
\subsection{The Fonts Tool}
\label{fontspanel}
\index{Fonts tool}

This panel, available from the {\cb Fonts} button in the {\cb Tools}
menu of the {\cb Tool Control} window, allows selection of the fonts
used in the graphical interface.  A drop-down menu provides selection
of the various font targets.  Pressing the {\cb Apply} button will
immediately apply the selected font to all visible windows which use
the font.

The drop-down font targets list contains the following entries:

\begin{description}
\item{\cb Fixed Pitch Text Window Font}\\
This sets the font used in pop-up multi-line text windows, such as the
Files Listing and others, where the names are formatted into columns.

\item{\cb Proportional Text Window Font}\\
This sets the font used in pop-up multi-line text windows where text
is not formatted, such as the error message pop-up.

\item{\cb Fixed Pitch Drawing Window Font}\\
This is the font used in the plot windows and in the {\cb Tool
Control} window.

\item{\cb Text Editor Font}\\
This is the font used in the Text Editor pop-up.

\item{{\cb HTML Viewer Proportional Font} (Unix/Linux only)}\\
This is the base font used for proportional text in the HTML viewer
(help windows).

\item{{\cb HTML Viewer Fixed Pitch Font} (Unix/Linux only)}\\
This is the base fixed-pitch font used by the HTML viewer.
\end{description}

The {\cb Font} button in the {\cb Options} menu of the Text Editor
brings up a similar panel, as does the {\cb Font} button in ther {\cb
Options} menu of the help viewer.

These fonts can be set in the {\vt .wrspiceinit} startup file by
giving {\cb setfont} commands.  These are inserted automatically when
the {\cb Update Tools} button in the {\cb File} menu is pressed, or a
{\cb tbupdate} command is given.

% spToolbar.hlp:filespanel 012709
%SU-------------------------------------
\subsection{The Files Tool}
\label{filespanel}
\index{Files tool}

\index{sourcepath variable}
This panel is available from the {\cb Files} button in the {\cb Tools}
menu of the {\cb Tool Control} window.  It provides a listing of files
found in each directory of the ``{\vt sourcepath}'' search path.  The
{\et sourcepath} is a list of directories that are searched for
circuit description files, if a file name is given to {\WRspice}
without a path prefix.

The panel contains a drop-down menu which has an entry for each
directory in the search path.  The main text area lists the files
found in the currently selected directory.

A file from the list can be selected by clicking with mouse button 1
on the text.  The text can be deselected by clicking in the text
window away from any text.  The file listing participates in the
drag/drop protocol as a drag source and drop receiver.

The following buttons are provided:

\begin{description}
\item{\cb Edit}\\
    If a file is selected, bring up a text editor with the
    file loaded as with the {\cb edit} command.  If
    no file is selected, the button becomes active, and the user
    can click on a file in the text window to edit it.
\item{\cb Source}\\
    If a file is selected, source it as with the {\cb source}
    command.  If no file is selected, the button becomes active,
    and the user can click on a file in the text window to source
    it.
\item{\cb Help}\\
    Bring up help on this panel.
\item{\cb Dismiss}\\
    Remove the files panel from the screen.
\end{description}

% spToolbar:circuitspanel 012709
%SU-------------------------------------
\subsection{The Circuits Tool}
\label{circuitspanel}
\index{Circuits tool}

This panel is available from the {\cb Circuits} button in the {\cb
Tools} menu of the {\cb Tool Control} window.  It provides a listing
of the circuits currently in memory.  A circuit description can be
read from a file with the {\cb source} command.  If the user clicks on
the text of one of the listed circuits, that circuit becomes the
current circuit, i.e., the circuit which will simulate with the {\cb
run} command.  The panel contains the following buttons:

\begin{description}
\item{\cb Delete Current}\\
    Delete the current circuit from memory.
\item{\cb Help}\\
    Bring up help on this panel.
\item{\cb Dismiss}\\
    Remove the circuits panel from the screen.
\end{description}

% spToolbar.hlp:plotspanel 012709
%SU-------------------------------------
\subsection{The Plots Tool}
\label{plotspanel}
\index{Plots tool}

This panel is available from the {\cb Plots} button in the {\cb Tools}
menu of the {\cb Tool Control} window.  It provides a listing of the
plots currently in memory.  A plot is a collection of output data
vectors generated during a simulation run.  In addition, there is
always the {\vt constants} plot, which contains some useful physical
constants.  A plot from the list can be selected as the current plot
by clicking on the text in the list.  The current plot is used to
resolve vector names in expressions given to commands and elsewhere. 
The panel contains the following buttons:

\begin{description}
\item{\cb New Plot}\\
    This creates an empty plot structure, and makes it the current
    plot.
\item{\cb Delete Current}\\
    Delete the current plot from memory.
\item{\cb Help}\\
    Bring up help on this panel.
\item{\cb Dismiss}\\
    Remove the plots panel from the screen.
\end{description}

% spToolbar.hlp:simopts 051114
%SU-------------------------------------
\subsection{Plot Options Panel}
\label{plotopts}
\index{Plot Options panel}

The {\cb Plot Options} panel is obtained from the {\cb Plot Opts}
button in the {\cb Tools} menu of the {\cb Tool Control} window.  The
panel can control the values of internal variables related to
plotting.  These variables can also be set with the {\cb set} command,
though the panel may provide a more convenient interface.

Pressing the {\cb Help} button pops up a window containing a listing
of the variables which can be set with the panel.  Clicking on a word
in the listing will bring up the help viewer with a description of
that variable.

The panel is organized into multiple pages, with each page containing
the variables in a particular category.  These will be listed below.

Each variable has its own ``box'' in the panel.  This box contains a
{\cb Set} button, and optionally a {\cb Def} button and a text input
area.  The text input area can take several forms, depending on the
type of variable:  string, integer, or real.  Boolean variables have
only the {\cb Set} button.  Text can be entered into the area, or in
some cases the up/down arrows to the right of the text area can be
clicked to adjust the text.

When the {\cb Set} button is active, the variable is set to the value
shown in the text area (if any), and the text area is frozen, i.e.,
can't be edited.  The text area can be changed only with the {\cb Set}
button inactive, in which case the value in the text area is
arbitrary.  The value is only known to {\WRspice} when the {\cb Set}
button is active, in which case the variable should appear in the
listing brought up by the {\cb Variables} button in the {\cb Tools}
menu in the {\cb Tool Control} window.

The {\cb Def} button will enter the default value for the variable
into the text area.  This button becomes active if the text area is
modified.

\begin{description}
\item{The {\cb plot1} Page}\\
This page contains entries which control the appearance of plots shown
on-screen.

\item{The {\cb plot2} Page}\\
This page contains additional entries which control the appearance of
plots shown on-screen.

\item{The {\cb asciiplot} Page}\\
This page sets variables associated with the {\cb asciiplot} command,
which generates a text-mode ``plot'' of output variables.  This is not
often used currently, but provides a nostalgic link to the days of
line printers and punched cards.

\item{The {\cb hardcopy} Page}\\
This provides a number of entries which relate to the {\cb hardcopy}
command and graphics printing in general.

\item{The {\cb xgraph} Page}\\
This provides settings for the interface to the {\et xgraph} program,
which was once used for simulation output plotting in Berkeley SPICE.
\end{description}

% spToolbar.hlp:simopts 051114
%SU-------------------------------------
\subsection{Plot Colors Panel}
\label{colors}
\index{Plot Colors panel}

The {\cb Plot Colors} panel is obtained from the {\cb Colors} button
in the {\cb Tools} menu of the {\cb Tool Control} window.  The panel
can control the values of internal variables used to define colors
used in plotting.  These variables can also be set with the {\cb set}
command, though the panel may provide a more convenient interface.

Pressing the {\cb Help} button pops up a window containing a listing
of the variables which can be set with the panel.  Clicking on a word
in the listing will bring up the help viewer with a description of
that variable.

Each variable has its own ``box'' in the panel.  This box contains a
{\cb Set} button, and optionally a {\cb Def} button and a text input
area.  The text input area can take several forms, depending on the
type of variable:  string, integer, or real.  Boolean variables have
only the {\cb Set} button.  Text can be entered into the area, or in
some cases the up/down arrows to the right of the text area can be
clicked to adjust the text.

When the {\cb Set} button is active, the variable is set to the value
shown in the text area (if any), and the text area is frozen, i.e.,
can't be edited.  The text area can be changed only with the {\cb Set}
button inactive, in which case the value in the text area is
arbitrary.  The value is only known to {\WRspice} when the {\cb Set}
button is active, in which case the variable should appear in the
listing brought up by the {\cb Variables} button in the {\cb Tools}
menu in the {\cb Tool Control} window.

The {\cb Def} button will enter the default value for the variable
into the text area.  This button becomes active if the text area is
modified.

% spToolbar.hlp:vectorspanel 030412
%SU-------------------------------------
\subsection{The Vectors Tool}
\label{vectorspanel}
\index{Vectors tool}

This panel is available from the {\cb Vectors} button in the {\cb
Tools} menu of the {\cb Tool Control} window.  It provides a listing
of the vectors in the current plot.  The current plot can be selected
with the {\cb Plots} button in the {\cb Tools} menu.

A vector can be selected by clicking on the text, and selection is
indicated by a `{\vt >}' symbol in the first column.  Any number of
vectors can be selected.  Click on the vector entry a second time to
deselect it.  The selected vectors are used by the buttons described
below.

\begin{description}
\item{\cb Help}\\
    Bring up help on this panel.
\item{\cb Desel All}\\
    Desselect all selected vectors.
\item{\cb Print}\\
    Print the values of the selected vectors in the console window,
    as with the {\cb print} command.
\item{\cb Plot}\\
    Plot the values of the selected vectors, as with the {\cb plot}
    command.
\item{\cb Delete}\\
    Delete the selected vectors from the plot.
\item{\cb Dismiss}\\
    Remove the vectors panel from the screen.
\end{description}

% spToolbar.hlp:variablespanel 012709
%SU-------------------------------------
\subsection{The Variables Tool}
\label{variablespanel}
\index{Variables tool}

This panel is available from the {\cb Variables} button in the {\cb
Tools} menu of the {\cb Tool Control} window.  It provides a listing
of the variables currently set in the shell, either with the {\cb set}
command or by other means.  The format of the listing is the same as
that used by the {\cb set} command without arguments.  The following
buttons are available:

\begin{description}
\item{\cb Help}\\
    Bring up help on this panel.
\item{\cb Dismiss}\\
    Remove the variables panel from the screen.
\end{description}

% spToolbar.hlp:shellopts 051114
%SU-------------------------------------
\subsection{Shell Options Panel}
\label{shellopts}
\index{Shell Options panel}

The {\cb Shell Options} panel is obtained from the {\cb Shell} button
in the {\cb Tools} menu of the {\cb Tool Control} window.  The panel
can control the values of internal variables used to define behavior
of the {\WRspice} shell.  The shell is similar to the UNIX C-shell,
and many of the variable names may be familiar from that context. 
These variables can also be set with the {\cb set} command, though the
panel may provide a more convenient interface.

Pressing the {\cb Help} button pops up a window containing a listing
of the variables which can be set with the panel.  Clicking on a word
in the listing will bring up the help viewer with a description of
that variable.

Each variable has its own ``box'' in the panel.  This box contains a
{\cb Set} button, and optionally a {\cb Def} button and a text input
area.  The text input area can take several forms, depending on the
type of variable:  string, integer, or real.  Boolean variables have
only the {\cb Set} button.  Text can be entered into the area, or in
some cases the up/down arrows to the right of the text area can be
clicked to adjust the text.

When the {\cb Set} button is active, the variable is set to the value
shown in the text area (if any), and the text area is frozen, i.e.,
can't be edited.  The text area can be changed only with the {\cb Set}
button inactive, in which case the value in the text area is
arbitrary.  The value is only known to {\WRspice} when the {\cb Set}
button is active, in which case the variable should appear in the
listing brought up by the {\cb Variables} button in the {\cb Tools}
menu in the {\cb Tool Control} window.

The {\cb Def} button will enter the default value for the variable
into the text area.  This button becomes active if the text area is
modified.

% spToolbar.hlp:simopts 051114
%SU-------------------------------------
\subsection{Simulation Options Panel}
\label{simopts}
\index{Simulation Options panel}

The {\cb Simulation Options} panel is obtained from the {\cb Sim Opts}
button in the {\cb Tools} menu of the {\cb Tool Control} window.  The
panel can control the values of internal variables used to define
parameters used while simulating.  These variables can also be set
with the {\cb set} command, though the panel may provide a more
convenient interface.  They are also commonly set in {\vt .options}
lines in SPICE input files.

Pressing the {\cb Help} button pops up a window containing a listing
of the variables which can be set with the panel.  Clicking on a word
in the listing will bring up the help viewer with a description of
that variable.

The panel is organized into multiple pages, with each page containing
the variables in a particular category.  These will be listed below.

Each variable has its own ``box'' in the panel.  This box contains a
{\cb Set} button, and optionally a {\cb Def} button and a text input
area.  The text input area can take several forms, depending on the
type of variable:  string, integer, or real.  Boolean variables have
only the {\cb Set} button.  Text can be entered into the area, or in
some cases the up/down arrows to the right of the text area can be
clicked to adjust the text.

When the {\cb Set} button is active, the variable is set to the value
shown in the text area (if any), and the text area is frozen, i.e.,
can't be edited.  The text area can be changed only with the {\cb Set}
button inactive, in which case the value in the text area is
arbitrary.  The value is only known to {\WRspice} when the {\cb Set}
button is active, in which case the variable should appear in the
listing brought up by the {\cb Variables} button in the {\cb Tools}
menu in the {\cb Tool Control} window.

The {\cb Def} button will enter the default value for the variable
into the text area.  This button becomes active if the text area is
modified.

\begin{description}
\item{The {\cb General} Page}\\
This page contains entries for some common simulation settings.

\item{The {\cb Timestep} Page}\\
This page privides a number of entries that control or affect the
timestep prediction in transient analysis, including the integration
method.

\item{The {\cb Tolerance} Page}\\
The entries provided on this page set the precision required for
convergence in simulation.

\item{The {\cb Convergence} Page}\\
This page provides entries which control convergence iteration limits
and similar, including setting the algorithm for initial dc operating
point computation.

\item{The {\cb Devices} Page}\\
The {\cb Devices} page provides some settings which affect particular
device types or models.

\item{The {\cb Temperature} Page}\\
The two global temperature parameters can be set from this page.

\item{The {\cb Parser} Page}\\
This page provides controls which affect parsing of circuit
descriptions.
\end{description}

% spToolbar.hlp:cmdopts 051516
%SU-------------------------------------
\subsection{Command Options Panel}
\label{cmdopts}
\index{Command Options panel}

The {\cb Command Options} panel is obtained from the {\cb Commands}
button in the {\cb Tools} menu of the {\cb Tool Control} window.  The
panel can control the values of internal variables used to define
behavior of {\WRspice} commands.  These variables can also be set with
the {\cb set} command, though the panel may provide a more convenient
interface.

Pressing the {\cb Help} button pops up a window containing a listing
of the variables which can be set with the panel.  Clicking on a word
in the listing will bring up the help viewer with a description of
that variable.

The panel is organized into multiple pages, with each page containing
the variables in a particular category.  These will be listed below.

Each variable has its own ``box'' in the panel.  This box contains a
{\cb Set} button, and optionally a {\cb Def} button and a text input
area.  The text input area can take several forms, depending on the
type of variable:  string, integer, or real.  Boolean variables have
only the {\cb Set} button.  Text can be entered into the area, or in
some cases the up/down arrows to the right of the text area can be
clicked to adjust the text.

When the {\cb Set} button is active, the variable is set to the value
shown in the text area (if any), and the text area is frozen, i.e.,
can't be edited.  The text area can be changed only with the {\cb Set}
button inactive, in which case the value in the text area is
arbitrary.  The value is only known to {\WRspice} when the {\cb Set}
button is active, in which case the variable should appear in the
listing brought up by the {\cb Variables} button in the {\cb Tools}
menu in the {\cb Tool Control} window.

The {\cb Def} button will enter the default value for the variable
into the text area.  This button becomes active if the text area is
modified.

\begin{description}
\item{The {\cb General} Page}\\
This page contains entries for variables that are general in nature,
affecting more than one command.

\item{The {\cb aspice} Page}\\
This page contains variables that apply to the {\cb aspice} command,
which initiates asynchronous {\WRspice} runs.

\item{The {\cb check} Page}\\
This page applies to the {\cb check} command, which initiates Monte
Carlo and operating range analysis.

\item{The {\cb diff} Page}\\
The entries in this page affect the {\cb diff} command, which compares
simulation output data.

\item{The {\cb edit} Page}\\
This page applies to the {\cb edit} command and related, which edit
circuit input for {\WRspice}.

\item{The {\cb fourier} Page}\\
The variables set by entries in this page affect the {\cb fourier}
command, and other commands which perform Fourier analysis.

\item{The {\cb help} Page}\\
These entries apply to the help system.

\item{The {\cb print} Page}\\
This page provides entries which apply to the {\cb print} command. 
The {\cb print} command is used to print simulation results or other
vector data.

\item{The {\cb rawfile} Page}\\
These entries apply to the {\cb rawfile} command, and plot data output
in general.

\item{The {\cb rspice} Page}\\
This page contains entries which apply to the {\cb rspice} command,
which initiates {\WRspice} runs on a remote system.

\item{The {\cb source} Page}\\
This page contains entries which apply to the {\cb source} command,
which is used (perhaps implicitly) to load circuit files for
simulation.

\item{The {\cb write} Page}\\
These entries apply to the {\cb write} command, which is used to save
simulation data to a file.
\end{description}

% spToolbar.hlp:runoppanel 022519
%SU-------------------------------------
\subsection{The Runops Tool}
\label{runoppanel}
\index{Runops tool}

This panel is available from the {\cb Runops} button in the {\cb Tools}
menu of the {\cb Tool Control} window.  It provides a listing of the
``runops'' (i.e., traces, breakpoints, interactive plots) currently in
effect.  These runops are set with the {\cb save}, {\cb trace}, {\cb
iplot}, {\cb measure}, and {\cb stop} commands.

A runop can be made inactive by clicking on the text in the list, in
which case an `I' appears in the first column.  Click on the text a
second time to restore activation.  Inactive runops are ignored during
simulation.  The following buttons are available:

\begin{description}
\item{\cb Help}\\
    Bring up help on this panel.
\item{\cb Delete Inactive}\\
    Delete the runops selected as inactive, i.e., those listed with
    ``I'' in the first column.
\item{\cb Dismiss}\\
    Remove the {\cb Runops Tool} from the screen.
\end{description}

% spToolbar.hlp:dbgopts 051114
%SU-------------------------------------
\subsection{Debug Options}
\label{dbgopts}
\index{Debug Options panel}

The {\cb Debug Options} panel is obtained from the {\cb Debug} button
in the {\cb Tools} menu of the {\cb Tool Control} window.  The panel
can control the values of internal variables used to enable extra
printing and tracing, used when trying to diagnose problems.  These
variables can also be set with the {\cb set} command, though the panel
may provide a more convenient interface.

Pressing the {\cb Help} button pops up a window containing a listing
of the variables which can be set with the panel.  Clicking on a word
in the listing will bring up the help viewer with a description of
that variable.

Each variable has its own ``box'' in the panel.  This box contains a
{\cb Set} button, and optionally a {\cb Def} button and a text input
area.  The text input area can take several forms, depending on the
type of variable:  string, integer, or real.  Boolean variables have
only the {\cb Set} button.  Text can be entered into the area, or in
some cases the up/down arrows to the right of the text area can be
clicked to adjust the text.

When the {\cb Set} button is active, the variable is set to the value
shown in the text area (if any), and the text area is frozen, i.e.,
can't be edited.  The text area can be changed only with the {\cb Set}
button inactive, in which case the value in the text area is
arbitrary.  The value is only known to {\WRspice} when the {\cb Set}
button is active, in which case the variable should appear in the
listing brought up by the {\cb Variables} button in the {\cb Tools}
menu in the {\cb Tool Control} window.

The {\cb Def} button will enter the default value for the variable
into the text area.  This button becomes active if the text area is
modified.


%S-----------------------------------------------------------------------------
\section{The Plot Panel}
\label{plotpanel}
\index{plot window}
\index{plot panel}

% PlotPanel.hlp:plotpanel 020324

This panel displays and controls aspects of plots generated from a
simulation with the {\cb plot} command.  The plot window contains a
row of buttons on the right side.  The button presence is determined
by the nature of the data plotted, as not all data support all
features.  The buttons that may be present are listed below.

\begin{description}
\item{\cb Dismiss}\\
Remove the plot from the screen.

\item{\cb Help}\\
Bring up the help viewer with pertinent information.

\item{\cb Redraw}\\
Redraw the graph.  This would be necessary to see new colors if the
colors are changed, with the {\cb Colors} pop-up from the {\cb Tools}
menu of the {\cb Tool Control} window. 

\item{\cb Print}\\
Bring up the printer control panel which controls hardcopy
generation.  The resulting hardcopy data from the plot can be sent to
a printer or saved in a file.

\item{\cb Save Plot}\\
The will save the plot data in a rawfile or Common Simulation Data
Format (CSDF) file.  Either file format can be read in with the {\cb
load} command to regenerate the plot.  See the description of the {\cb
write} command (\ref{writecmd}) for information about the formats, and
how they can be specified.  The user is prompted for a name for the
file.

\item{\cb Save Print}\\
This will save the plot data in a file, in the same format as output
from the {\cb print} command.  The user is prompted for a name for the
file.

\item{\cb Points}\\
If this button is active, the data points are marked with a glyph. 
This is mutually exclusive with the {\cb Comb} button.

\item{\cb Comb}\\
If this button, which is mutually exclusive with the {\cb Points}
button, is active, the data will be presented as a histogram.  If
neither of {\cb Points} or {\cb Comb} is selected, a (possibly
interpolated) line drawing connecting the points will be presented.

\item{\cb Log X}\\
If the data are consistent with a logarithmic scale of the x-axis,
this button will appear.  When active, a log scale will be used on the
x-axis.

\item{\cb Log Y}\\
If the data are consistent with a logarithmic scale of the y-axis,
this button will appear.  When active, a log scale will be used on the
y-axis.  Note that all traces must be consistent with a log scale, and
all traces will use a log scale if this button is active.

\item{\cb Marker}\\
When active, a marker will be attached to the cursor, and the scale
factors of the plot will be replaced with the current position of the
marker relative to the data.  This is useful for actually obtaining
numerical data from the plot.  If button 1 is clicked, a reference
mark will be left behind, and the readout will be relative to the
values at the reference.  Clicking with button 2 will remove the
reference.

When using the marker in a polar or Smith plot, the display indicates
the real, imaginary, radius, and angle in degrees of the current
marker position.  The radius and angle are shown in the lower left
corner of the plot window.  In Smith plots, a family of real and
imaginary values are shown, corresponding to a set of values usually
displayed along the x axis.  For the imaginary contours, the values
correspond to the values printed in left to right order.  If mouse
button three is used to zoom into a section of the Smith plot such
that the x axis is invisible, the values corresponding to the
displayed real contours are listed along the top of the plot window. 
These numbers correspond to the displayed real contours in left to
right order.  They also correspond to the imaginary contours, however
depending on the location in the Smith chart, not all imaginary
contours, or additional contours, may be visible.  Ambiguity can be
resolved through use of the marker.

\item{\cb Separate}\\
When active, each trace will be assigned a portion of the overall
vertical plot area, and a separate scale.  The traces will be scaled
so as to not overlap.  Otherwise, the entire vertical area is used for
each trace.  The button will appear if there is more than one trace in
the plot.

\item{\cb Single}, {\cb Group}\\
In the most general case, two buttons in a ``radio group'' control the
y-axis scales of the traces.  These buttons are labeled {\cb Single}
and {\cb Group}.  If neither button is active, each trace will have an
independent ``best fit'' y scale.  If {\cb Single} is active, all
traces will be plotted on the same ``best fit'' y scale.  If {\cb
Group} is active, the traces are scaled according to their data type. 
The types are voltage, current, and other.  Each group will have a
separate ``best fit'' scale.  If the trace is from a node voltage,
then it will have type voltage, however functions of voltages will
probably have type other.  This is similarly true for currents.

The {\cb Single} and {\cb Group} buttons are prevented from being
active at the same time.  If there is only one trace, or the traces
are all of the same type, the {\cb Group} button will not appear.  If
there is only one trace, then the {\cb Single} button will also not
appear.
\end{description}

\subsection{Zooming in}
\index{plot zoom in}

If button 3 is pressed and held while pointing at the graph, an
outline box is shown, which follows the cursor, anchored at the
location pointed to.  Releasing button 3 will create a new plot of the
area in the box.  Pressing {\kb Ctrl}-button 1 is equivalent to button
3 for this operation.

\subsection{Text String Selection}
\index{plot text selection}
\index{plot text editing}

Text that appears in plots will use a font that can be changed from
the font selection panel obtained from the {\cb Fonts} button in the
{\cb Tools} menu of the {\cb Tool Control} window.  This is the {\cb
Fixed Pitch Drawing Window Font} in the menu.  This font can also be
changed with the {\cb setfont} command.

Most of the text strings in plot windows can be edited, and persistent
text labels can be added.  The possible manipulations are described
below.

A string must be selected before it can be edited or otherwise
altered.  A string can be selected by clicking on it with the left
mouse button (button 1).  The selection is indicated by the appearance
of a thick color1 (default black) bar to the left of the string, and a
thin bar to the right of the string.  At most one string can be
selected at a time.

A string can be deselected by clicking in the plot window away from
any string.  Clicking on another string will change the current
selection to that string.

A drag can be initiated by pressing and holding button 1 over the
selected string, and moving the mouse pointer.  A ghost outline of the
string will be attached to the mouse pointer.  When the button is
released, the string will be moved to the release location.  If the
{\kb Shift} key is pressed while the mouse button is released, the
string will be copied to the new location.  Strings can be copied to
other plot windows using this drag and drop technique, but the {\kb
Shift} key is ignored in this case.

{\bf GTK release only}\\
While dragging the string, the left and right arrow keys cycle through
left, center, and right justification of the string.  The string
outline box attached to the mouse pointer will shift to indicate the
justification.

Strings have a termination property.  When selected, the color of the
right side indicator bar will be color1 (default black) if terminated,
color2 (default red) if not terminated.  When the selected string is
not terminated, it can be edited.  Pressing the {\cb Backspace} key
({\cb Delete} key in Apple) will cause a selected terminated string to
become non-terminated.  Pressing the {\cb Enter} key will terminate a
selected non-terminated string.

When the selected string is terminated, as indicated by a color1
(default black) vertical bar on the right side:

\index{colorN}
\begin{itemize}
\item{Pressing the {\cb Delete} key will erase the string.  There is
no undo/redo so be careful.}

\item{The left and right arrow keys will cycle the current selection
to other strings in the plot that can be modified.}

\item{The up and down arrow keys cycle through the various available
colors, recoloring the selected string.  These are the same colorN
colors used for plot traces.  To change the color of the title, for
example, one would click on the title string, then press the up or
down arrow keys until the title color is satisfactory.}

\item{The selected string can be dragged to a new location, or copied
to a new location or to a different plot window.}
\end{itemize}

With the selected string not terminated, an editing mode is active.  A
vertical line cursor may be visible within the word.  This is rendered
as color2 (default limegreen).  If not visible, it is logically off
the right side of the string.  Pressing {\cb Backspace} removes the
character to the left of the cursor, and moves the cursor left by one
character.  With the cursor invisible, {\cb Backspace} removes the
rightmost character in the string.  The cursor is moved with the left
and right arrow keys.  Characters typed on the keyboard are inserted
into the string to the right of the cursor, advancing the cursor.  The
{\cb Delete} key will delete the character to the right of the cursor. 
It will have no effect in editing mode if the cursor is not visible.

{\bf QT release only}\\
When the cursor is at the beginning or end of the selected string, the
left and right arrow keys in the direction of impeded cursor movement
will instead cycle the justification used when the string is moved or
copied between left, center, and right.  This will be seen in the text
image used during drag/drop.  The present justification is shown by
the marks that appear just below the selected text.

If all of the characters are deleted, then the string is deleted. 
When all characters have been entered, pressing {\cb Enter}
terminates the string and exits the editing mode.  Note that
presently there is no undo/redo capability.

With no selection, or if the selection is terminated, typing
characters into the plot window will start a new string at the mouse
cursor location, which becomes the new selection.  Terminate the new
string by pressing {\kb Enter}.

The strings, as modified or added, will appear in hard-copies
generated from the {\cb Print} button in the plot window.  If a new
plot is created by using button 3 to zoom in, the child plot will
inherit the text strings of the parent plot.  However, if the plot is
saved to disk with the {\cb Save Plot} button, the saved strings will
revert to the original strings.

\subsection{Trace Drag and Drop}

In plots, the traces can be moved by dragging with mouse button 1,
either within a plot or between plot windows.  Thus, the order of the
traces can be changed.  Traces can be ``grabbed'' by pressing button 1
near the trace legend, but not over the legend text itself.  A square
wave marker is attached to the pointer when a trace is being dragged.

Traces can be dropped within the legend area of another trace, in
which case the dragged trace occupies the drop trace location, and the
drop trace and below are shifted down.  Traces can be dropped in the
legend area but below all existing legends to move a trace to the end.

Traces can also be dropped on the file cabinet icon in the upper left
corner of the plot window.  This will remove the dragged trace from
the display, if the trace is from the same plot window as the icon. 
If the trace is from a different plot window, a copy of the trace is
added to the icon storage.  Traces that have been dragged into the
file cabinet can be dragged out again in first-in last-out order, and
can be dropped among the existing trace legends to make them visible
again.

Dragging trace data between plots is an an easy way to see differences
between simulation runs.  The trace data are copied and interpolated
to the new scale.  If the new scale is not compatible, the operation
will fail.

\subsection{Multidimensional Traces}

When a plot window is displaying multidimensional data, the dimension
map icon will appear in the upper left corner of the plot window. 
Clicking on this icon will toggle display of the dimension map.  The
dimension map allows the user to display only chosen dimensions of the
traces.

Consider the plot produced by

\begin{quote}
{\vt set value1 = temp}\\
{\vt loop -50 125 25 dc vds 0.0 1.2 0.02 vgs 0.2 1.2 0.2}
\end{quote}

The {\cb loop} command produces a three dimensional plot, with
dimensions \{ 8, 6, 61 \}.  When plotting {\vt i(vds)}, the display
would contain 48 traces, representing {\vt id} vs.\ {\vt vds} for each
{\vt vgs} and temperature value.

The visibility of these traces is set by the columns of clickable
dimension selector indices shown in the dimension map.  Initially, the
traces for all dimensions are shown.  Clicking anywhere in the
dimension list with the center mouse button, or equivalently with the
left (or only) mouse button while pressing {\kb Shift}, will hide the
traces for all dimensions.  Clicking anywhere in the dimension list
with the right mouse button, or equivalently with the left (or only)
mouse button while pressing {\kb Ctrl}, will show the traces for all
dimensions.  Clicking or dragging over the entries with the left mouse
button will toggle display of the corresponding traces.

In the present case the dimension map contains two columns:  the left
column contains eight numbers 0--7, and the right columns contains six
numbers 0--5.  Clicking on these numbers controls the visibility per
dimension, i.e., clicking in the left column would display/suppress
all traces for a given temperature, clicking in the right column will
display/suppress traces corresponding to a {\vt vgs} value.  Multiple
entries in the same column can be toggled by dragging the mouse
pointer over them.

This dimensional partitioning would apply for any number of
dimensions.  If a column contains too many dimensions to list
completely, a label ``more'' will exist at the bottom of the listing. 
Clicking on this label will cycle through all of the dimensions, in
the columns that require it.

If the plot is displaying a single multidimensional variable, then
each least dimension is displayed in a separate color.  The numbers in
the rightmost column of the dimension map will use the same colors. 
In other columns, and in the rightmost column if more than one
variable is being plotted, the indices use a uniform color to indicate
that the dimension is shown, and in all cases black indicates a
dimension that is not being shown.

The dimensions shown can also be controlled by mplot windows from the
{\cb mplot} command.  These are the windows generally used to display
results from operating range and Monte Carlo analysis.  The mplot
display consists of an array of pass/fail indication cells, one for
each trial.  These can be selected or deselected by clicking on them.

An mplot window is always associated with an internal plot structure,
as listed with the {\cb Plots} tool.  The plot structure may also
contain multidimensional vectors, for example if one uses the ``{\vt
-k}''" option to the {\cb check} command, all trial data will be
saved.

If an mplot window with selections is present, and the {\cb plot}
command is used to plot a multidimensional vector from the same
internal plot structure as the mplot, then only the dimensions
corresponding to the selected trials will be shown on the plot window.

In this plot window, a ``flat'' dimension map will be used.  This is a
single column, with length equal to the product of the ``real''
dimensions.  The visibility of each flat dimension can be toggled with
the map entries as usual.  The mplot selections have no effect on a
plot window once it is displayed, but will initialize new plot windows
to 1) enforce a flat dimension mapping, and 2) set the initial states
of the flat map.  After changing the mplot selections, one must use
the {\cb plot} command again to see the revised dimensions, or
alternatively one can note the numbers of the mplot cells, and
manipulate the same numbers in the dimensions map of the first plot,
to see the new data.

If one has a plot structure containing multidimensional vectors from
any source, such as from the {\cb loop} commnd, one can still use the
mplot capability.  Giving the command

\begin{quote}
{\vt mplot} {\it vector}
\end{quote}

for any multidimensional vector will produce an mplot window.  The
number of mplot cells will equal the number of flat dimensions in the
vector.  The pass/fail indication means nothing in this case, all
cells display ``fail''.  One can select the dimension cells in the
mplot, which will affect subsequent plots from the {\cb plot} command
of any vector in the same internal plot structure, as described above. 
The {\it vector} given to the {\cb mplot} command can be any vector
from the plot, it is used for dimension counting only.

In older {\WRspice} releases, the upper dimensions were represented as
``flat'', so that in the plot there would be a single column of
numbers (0--47 in our original example above, six {\vt vgs} values
times eight temperatures), and clicking on these numbers would
display/suppress the corresponding trace.

\subsection{Scale Icons}

The plot windows contain icons for changing the scales.  These are
triangles; the x-axis icons are in the lower left corner, and the
y-axis icons are arrayed along the right edge.  Clicking on one of
these icons has the following effects:

\begin{tabular}{|l|l|}\hline
    \multicolumn{2}{|c|}{{\bf right} or {\bf up}}\\ \hline
      button 1 & move the scale interval to the right or up\\ \hline
      button 2 or {\kb Shift}--button 1 & extend the right or top scale
         factor to the right or up\\ \hline
      button 3 or {\kb Ctrl}--button 1 & contract the right or top scale
         factor to the left or down\\ \hline
    \multicolumn{2}{|c|}{{\bf left} or {\bf down}}\\ \hline
      button 1 & move the scale interval to the left or down\\ \hline
      button 2 or {\kb Shift}--button 1 & extend the left or bottom scale
         factor to the left or down\\ \hline
      button 3 or {\kb Ctrl}--button 1 & contract the left or bottom scale
         factor to the right or up\\ \hline
\end{tabular}

\subsection{Field Width Icons}

When a plot is displaying multiple data traces with different scales,
a pair of triangular marks similar in appearance to the scale icons
appear near the top-left corner of the plot grid frame.  Clicking on
these marks will move the plot grid frame to the left or right,
shrinking or expanding the left margin area used for the trace label
text.  This can improve the appearance of the plot when trace labels
are unusually long or short.


%S-----------------------------------------------------------------------------
\section{The Mplot Panel}
\index{mplot window}

% PlotPanel.hlp:mplotpanel 012709

This panel appears when plotting results from operating range or Monte
Carlo analysis, and is brought up by the {\cb mplot} command.  The
display consists of an array of cells, each of which represent the
results of a single trial.  As the results become available, the cells
indicate a pass or fail, In operating range analysis, the cells
indicate a particular bias condition according to the axes.  In Monte
Carlo analysis, the position of the cells has no significance.  In
this case the display indicates the number of trials completed.

The panel includes a {\cb Help} button which brings up a help message,
a {\cb Redraw} button to redraw the plot if, for example, the plotting
colors are redefined, and a {\cb Print} button for generating hard
copy output of the plot.

Text entered while the pointer is in the {\cb mplot} window will
appear in the plot, and hardcopies.  This text, and other text which
appears in the plot, can be edited in the manner of text in {\cb plot}
windows.

The cells in an {\cb mplot} can be selected/deselected by clicking on
them.  Clicking with button 1 will select/deselect that cell.  Using
button 2, the row containing the cell will be selected or deselected,
and with button 3 the column will be selected or deselected.  A
selected cell will be shown with a colored background, with an index
number printed.

Only one {\cb mplot} window can have selections.  Clicking in a new
window will deselect all selections in other {\cb mplot} windows.  See
the description of the {\cb mplot} command in \ref{mplot} for
information about use of the selections.


%S-----------------------------------------------------------------------------
\section{The Print Control Panel}
\index{print panel}

% Hardcopy.hlp:hcopypanel 092817

The {\cb Print} button in the plot and mplot panels brings up a panel
which provides an interface to the hardcopy drivers.  The panel is a
highly configurable multi-purpose printer interface used in many parts
of {\Xic} and {\WRspice}.  This section describes all of the available
features, however many of these features may not be available,
depending upon the context when the panel was invoked.  For example, a
modified version of this panel is used for printing text files.  In
that case, only the {\cb Dismiss}, {\cb To File}, and {\cb Print}
buttons are included.

Under Windows, the {\cb Printer} field contains the name of a
connected printer, initially the system default printer.  The up/down
control to the right can be pressed to cycle through the list of
available printers.

Under Unix/Linux, the operating system command used to generate the
plot is entered into the {\cb Print Command} text area of the Print
Control panel.  In this string, the characters ``{\vt \%s}'' will be
replaced with the name of the (temporary) file being printed.  If
there is no ``{\vt \%s}'', the file name will be added to the end of
the string.  The string is sent to the operating system to generate
the plot.

The temporary file used to hold plot data before it is sent to the
printer is {\it not\/} deleted, so it is recommended that the print
command include the option to delete the file when plotting is
finished.  In {\WRspice}, the {\et hcopyrmdelay} variable can be set
to an integer to enable automatic delayed deletion of the temporary
file.

\index{plot to file}
If the {\cb To File} button is active, then this same field contains
the name of the file to receive the plot data, and nothing is sent to
the printer.  The user must enter a name or path to the file, which
will be created.

The size and location of the plot on the page can be specified with
the {\cb Width}, {\cb Height}, {\cb Left}, and {\cb Top}/{\cb Bottom}
text areas.  The dimensions are in inches, unless the {\cb Metric}
button is set, in which case the dimensions are in millimeters.  The
{\cb Width}, {\cb Height}, and offsets are always relative to the page
in portrait orientation (even in landscape mode).  The vertical offset
is relative to either the top of the page, or the bottom of the page,
depending on the details of the coordinate system used by the driver. 
The label is changed from {\cb Top} to {\cb Bottom} in the latter
case.  Thus, different sized pages are supported, without the driver
having to know the exact page size.

The labels for the image height and width in the {\cb Print} pop-up
are actually buttons.  When pressed, the entry area for height/width
is grayed, and the auto-height or auto-width feature is activated. 
Only one of these modes can be active.  In auto-height, the printed
height is determined by the given width, and the aspect ratio of the
area printed.  Similarly, in auto-width, the width is determined by
the given height and the aspect ratio of the area to print.  In
auto-height mode, the height will be the minimum corresponding to the
given width.  This is particularly useful for printers with roll
paper.

The full-page values for many standard paper sizes are selectable in
the drop-down {\cb Media} menu below the text areas.  Selecting a
paper size will load the appropriate values into the text areas to
produce a full page image.  Under Windows, the ``Windows Native''
driver requires that the actual paper type be selected.  Otherwise,
this merely specifies the default size of the image.

Portrait or landscape orientation is selectable by the drop-down menu. 
In portrait mode, the plot is in the same orientation as seen
on-screen, and in landscape mode, the image is rotated 90 degrees. 
However, if the {\cb Best Fit} check box is checked, the image can
have either orientation.

When the {\cb Best Fit} button is active, the driver is allowed to
rotate the image 90 degrees if this improves the fit to the aspect
ratio of the plotting area.  This supersedes the Portrait/Landscape
setting for the image.

The available output formats are listed in a drop-down menu.  Printer
resolutions are selectable in the adjacent resolution menu.  Not all
drivers support multiple resolutions.  Higher resolutions generate
larger files which take more time to process.

When a PostScript line-draw driver is selected, a {\cb Line Width}
numeric entry area appears, which can be used to set the width of the
lines used for drawing.  The value given is in points, a point being
1/72 of an inch.  Different printers may respond to the specified 
width in different ways, depending on physical characteristics.  The
default, when the line width is set to 0, is to use the narrowest line
provided by the printer.  At times, using fatter lines improves
visibility for presentation graphics and similar.

Pressing the {\cb Print} button actually generates the plot or creates
the output file.  This should be pressed once the appropriate
parameters have been set.  A pop-up message appears indicating success
or failure of the operation.

The {\cb Dismiss} button retires the Print Control panel.

%SU-------------------------------------
\subsection{Print Drivers}
\label{printdrivers}

% Hardcopy.hlp:hcopyfmt 021410

The printing system for {\Xic} and {\WRspice} provides a number of
built-in drivers for producing output in various file formats.  In
Windows, an additional ``Windows Native'' driver uses the operating
system to provide formatting, thus providing support for any graphical
printer known to Windows.  The data formats are selected from a
drop-down menu available in the {\cb Print} panel.  The name of the
currently selected format is displayed on the panel.

Except for the ``Windows Native'' driver all formatting is done in the
{\Xic}/{\WRspice} printer drivers, and the result is sent to the
printer as "raw" data.  This means that the selected printer {\it
must} understand the format.  In practice, this means that the printer
selected must be a PostScript printer, and one of the PostScript
formats used, or the printer can be an HP Laserjet, and the PCL format
used, etc.  The available formats are listed below.

\begin{description}
\item{\et PostScript bitmap}\\
The output is a two-color PostScript bitmap of the plotted area.

\item{\et PostScript bitmap, encoded}\\
This also produces a two color PostScript bitmap, but uses compression
to reduce file size.  Some elderly printers may not support the
compression feature.

\item{\et PostScript bitmap color}\\
This produces a PostScript RGB bitmap of the plotted area.  These
files can grow quite large, as three bytes per pixel must be stored.

\item{\et PostScript bitmap color, encoded}\\
This generates a compressed PostScript RGB bitmap of the plotted area. 
Due to the file size, this format should be used in preference to the
non-compressing format, unless the local printer does not support
PostScript run length decoding.

\item{\et Postscript line draw, mono}\\
This driver produces a two color PostScript graphics list representing
the plotted area.

\item{\et PostScript line draw, color}\\
This produces an RGB color PostScript graphics list representing the
plotted area.

\item{\et HP laser PCL}\\
This driver roduces monochrome output suitable for HP and compatible
printers.  This typically processes more quickly than PostScript on
these printers.

\item{\et HPGL line draw, color}\\
This driver produces output in Hewlett-Packard Graphics Language,
suitable for a variety of printers and plotters.

\item{\et Windows Native} (Microsoft Windows versions only)\\
This selection bypasses the drivers in {\Xic} or {\WRspice} and uses
the driver supplied by Windows.  Thus, any graphics printer supported
by Windows should work with this driver.

The {\et Windows Native} driver should be used when there is no other
choice.  If the printer has an oddball or proprietary interface, then
the {\et Windows Native} driver is the one to use.  However, for a
PostScript printer, better results will probably be obtained with one
of the built-in drivers.  The same is true if the printer understands
PCL, as do most laser printers.  This may vary between printers, so
one should experiment and use whatever works best.

In the Unix/Linux versions, selecting a page size from the {\cb Media}
menu will load that size into the entry areas that control printed
image size.  This is the only effect, and there is no communication of
actual page size to the printer.  This is true as well under Windows,
except in the Windows Native driver.  Microsoft's driver will clip the
image to the page size before sending it to the printer, and will send
a message to the printer giving the selected paper size.  The printer
may not print if the given paper size is not what is in the machine.
Thus, when using this driver, it is necessary to select the actual
paper size in use.

\item{\et Xfig line draw, color}\\
Xfig is a free (and very nice) drafting program available over the
Internet.  Through the {\vt transfig} program, which should be
available from the same place, output can be further converted to a
dozen or so different formats.

\item{\et Image: jpeg, tiff, png, etc}\\
This driver converts into a multitude of bitmap file formats.  This
supports file generation only.  The type of file is determined by
the extension of the file name provided (the file name should have
one!).  The driver can convert to several formats internally, and
can convert to many more by making use of ``helper'' programs that
may be on your system.

Internal formats:

\begin{tabular}{|l|l|}\hline
\bf    Extension       & \bf Format\\ \hline \hline
\vt    ppm, pnm, pgm   & Portable Bitmap (netpbm)\\ \hline
\vt    ps              & PostScript\\ \hline
\vt    jpg, jpeg       & JPEG\\ \hline
\vt    png             & PNG\\ \hline
\vt    tif, tiff       & TIFF\\ \hline
\end{tabular}

Under Microsoft Windows, an additional feature is available.  If the
word ``{\vt clipboard}'' is entered in the {\cb File Name} text box,
the image will be composed in the Windows clipboard, from where it can
be pasted into other Windows applications.  There is no file generated
in this case.

On Unix/Linux systems, if you have the open-source {\vt ImageMagick}
or {\vt netpbm} packages installed then many more formats are
available, including GIF and PDF.  These programs are standard on most
Linux distributions.  The {\et imsave} system, which is used to
implement this driver and otherwise generate image files, employs a
special search path to find helper functions ({\vt convert} from
ImageMagick, the netpbm functions, {\vt cjpeg} and {\vt djpeg}).  The
search path (a colon-delimited list of directories) can be provided in
the environment variable {\et IMSAVE\_PATH}.  If not set, the internal
path is ``{\vt /usr/bin:/usr/local/bin:/usr/X11R6/bin}''.  The helper
function capability is not available under Microsoft Windows.
\end{description}

The choice between PostScript line draw and bitmap formats is somewhat
arbitrary.  Although the data format is radically different, the plots
should look substantially the same.  A bitmap format typically takes
about the same amount of time to process, independent of the data
shown, whereas a line draw format takes longer with more objects to
render.  For very simple layouts and all schematics and {\WRspice}
plots, the line draw formats are the better choice, but for most
layouts the bitmap format will be more efficient.

The necessary preamble for Encapsulated Postscript (EPSF-3.0) is
included in all PostScript files, so that they may be included in
other documents without modification.


%S-----------------------------------------------------------------------------
\section{The {\WRspice} Help System}
\index{help system}
\label{helpsys}

% HelpSys.hlp:helpsys 031413

The {\WRspice} help system provides a cross-referenced rich-text
(HTML) database on the commands and features of the program.  The
system is entered at the top level by pressing the {\cb Help} button
in the {\cb Help} menu of the {\cb Tool Control} window, or by giving
the {\cb help} command without arguments.  If a command name or other
known keyword is given as an argument to the {\cb help} command, the
help system will start by displaying the help for that topic.

When graphics is not available, the help text will be presented in a
text-only format in the console window.  The HTML to ASCII text
converter only handles the most common HTML tags, so some
descriptions may look a little strange.  The figures (and all
images) are not shown, and clickable links will not be available,
other than the ``references'' and ``seealso'' topics.

Clicking on a colored HTML reference will bring up the text of the
selected topic.  If button 1 is used to click, the text will appear in
the same window.  If button 2 is used to click, a new help window
containing the selected topic will appear.

Text shown in the viewer that is not part of an image can be selected
by dragging with button 1, and can be pasted into other windows in the
usual way.

The viewer can be used to display any text file or URL.  In {\Xic} and
its derivatives, pressing the question mark key (``{\kb ?}'') will
prompt the user for text to display.  The {\cb !help} command has the
same effect.  In {\WRspice}, the text to display can follow the ``{\cb
help}'' command keyword on the command line.  The name given to the
command, or to to the {\cb Open} command in the viewer's {\cb File}
menu, can be
\begin{itemize}
\item{A keyword for an entry in the help database.}
\item{A path to a file on the local machine.  The file can be an image
in any standard format, or HTML or plain text.}
\item{An arbitrary URL accessible through the Internet.}
\end{itemize}

If the given name can be resolved, the resulting page will be
displayed in the viewer.  Also, the HTML viewer is sensitive as a drop
receiver.  If a file name or URL is dragged into the viewer and
dropped, that file or URL is read into the viewer, after confirmation.

The ability to access general URLs should be convenient for accessing
information from the Internet while using {\Xic} and {\WRspice}.  The
prefix ``{\tt http://}'' {\it must} be provided with the URL.  Thus,
for example,
\begin{quote}\vt
help http://wrcad.com
\end{quote}
will bring up the Whiteley Research web page.  The links can be
followed by clicking in the usual way.  Of course, the computer must
have Internet access for web pages to be accessible.

Be advised, however, that the ``{\vt mozy}'' HTML viewer used in
Unix/Linux releases is HTML-3.2 compliant with only a few HTML-4.0
features implemented, and has no JavaScript, Java or Flash
capabilities.  A few years ago, this was sufficient for viewing most
web sites, but this is no longer true.  Most sites now rely on css
styles, JavaScript, and other features not available in {\vt mozy}. 
Most sites are still readable, to varying degrees, but without correct
formatting.

The given URL is not relative to the current page, however if a `+' is
given before the URL, it will be treated as relative.  For example, if
the viewer is currently displaying {\vt http://www.foo.bar}, if one
enters ``{\vt /dir/file.html}'', the display will be updated to {\vt
/dir/file.html} on the local machine.  If instead one enters ``{\vt
+/dir/file.html}'', the display will be loaded with {\vt
http://www.foo.bar/dir/file.html}.

The HTTP capability imposes some obvious limitations on the string
tokens which can be used in the help database.  These keywords should
not use the `/' character, or begin with a protocol specifier such as
``{\vt http:}''.

HTML files on a local machine can be loaded by giving the full path
name to the file.  Relative references will be found.  HTML files will
also be found if they are located in the help path, however relative
references will be found only if the referenced file is also in the
help path.  If a directory is referenced rather than a file, a
formatted list of the files in the directory is shown.

If a filename passed to the viewer has one of the following
extensions, the text is shown verbatim.  The (case insensitive)
extensions for plain-text files are ``{\vt .txt}'', ``{\vt .log}'',
``{\vt .scr}'', ``{\vt .sh}'', ``{\vt .csh}'', ``{\vt .c}'', ``{\vt
.cc}'', ``{\vt .cpp}'', ``{\vt .h}'', ``{\vt .py}'', ``{\vt .tcl}'',
and ``{\vt .tk}''.

In the {\WRspice} help system, link references to files with a ``{\vt
.cir}'' extension will be sourced into {\WRspice} when the link is
clicked on.  Thus, if one has a circuit file named ``{\vt
mycircuit.cir}'', and the HTML text in the help window contains a
reference like
\begin{quote}
{\vt <a html="mycircuit.cir">click here</a>}
\end{quote}
then clicking on the ``click here'' tag will source {\vt
mycircuit.cir} into {\WRspice}.  Similarly, link references to files
with a ``{\vt .raw}'' extension will be loaded into {\WRspice} (as a
{\it rawfile\/}, i.e. a plot data file) when the anchor is clicked.

This feature may solve a big problem.  How many {\WRspice} users have
directories full of old simulation files, the details about which are
long forgotton or buried in some notebook somewhere?  Now the
documentation task may be somewhat simpler.  While doing simulations,
one can maintain a text file containing notes about the circuit and
results, with HTML anchor tags to the actual circuit and data files. 
Then, one can load the text file into the {\WRspice} help system (if
the notes are in a file ``{\vt notes.html}'', one just types ``{\vt
help notes.html}''), and browse the notes and have one-click access to
the original files and plot data.  The notes file need not contain any
other HTML constructs besides the anchor references.

Holding {\kb Shift} while clicking on an anchor that points to a URL
which specifies a file on a remote system will download the file. 
Downloading makes use of the {\vt httpget} utility program available
in the Accessories distribution.  Installation of the accessories is
required for downloading to be available under Unix/Linux.  References
to files with extensions ``{\vt .rpm}'', ``{\vt .gz}'', and other
common binary file suffixes will automatically cause downloading
rather than viewing.  When downloading, the file selection pop-up will
appear, pre-loaded with the file name (or ``{\vt http\_return}'' if
the name is not known) in the current directory.  One can change the
saved name and the directory of the file to be downloaded.  Pressing
the {\cb Download} button will start downloading.  A pop-up will
appear that monitors the transfer, which can be aborted with the {\cb
Cancel} button.

%SU-------------------------------------
% update 042118
\subsection{{\XicTools} Update}
\index{updating {\XicTools}}
\label{update}

The help system provides package management capability for the
{\XicTools} programs.  Giving the keyword
\begin{quote}\vt
:xt\_pkgs
\end{quote}
(note that the keyword starts with a colon) brings up a page listing
the installed and available {\XicTools} packages, for the current
architecture.  This requires internet access and http connectivity to
{\vt wrcad.com}.

One can select packages to download and optionally install by clicking
on the check boxes.  There are separate buttons to initiate
downloading only, and downloading and installation.  Package files,
and the latest {\vt wr\_install} script if downloading, are downloaded
to the current directory.  Once installed, these files can be deleted.

The {\XicTools} package management capability is available from the
the internal help system in {\Xic} and {\WRspice}, and from the
stand-alone {\it mozy} help browser.

%SU-------------------------------------
% helpview 102917
\subsection{The HTML Viewer}
`
\index{help viewer!back}
\index{help viewer!forward}
\index{help viewer!stop}
There are three colored buttons in the menu bar of the viewer.  The
left-facing arrow button (back) will return to the previous topic
shown in the window.  The right-facing arrow button (forward) will
advance to the next topic, if the back button has been used.  The {\cb
Stop} button will stop HTTP transfers in progress.

There are four drop-down menus in the menu bar:  {\cb File}, which
contains basic commands for loading and printing, {\cb Options}, which
contains commands for setting display attributes, {\cb Bookmarks},
which allows saving frequently used references, and {\cb Help} which
provides documentation.

The {\cb File} menu contains the following command buttons.
\begin{description}
\index{help viewer!Open}
\index{help viewer!Open File}
\item{\cb Open}\\
The {\cb Open} button in the {\cb File} menu pops up a dialog into
which a new keyword, URL, or file name can be entered.

\item{\cb Open File}\\
The {\cb Open File} button brings up the {\cb File Selection} panel. 
The {\cb Ok} button (green octagon) on the {\cb File Selection} panel
will load the selected file into the viewer (the file should be a
viewable file).  The file can also be dragged into the viewer from the
{\cb File Selection} panel.

\index{help viewer!Save}
\index{save help text}
\item{\cb Save}\\
The {\cb Save} button in the {\cb File} menu allows the text of the
current window to be saved in a file.  This functionality is also
provided by the {\cb Print} button.  The saved text is pure ASCII.

\index{help viewer!Print}
\index{print help text}
\item{\cb Print}\\
The {\cb Print} button brings up a pop-up which allows the user to
send the help text to a printer, or to a file.  The format of the text
is set by the drop-down menu, with the current setting indicated on
the menu button.  The choices are PostScript in four fonts (Times,
Helvetica, New Century Schoolbook, and Lucida Bright), HTML, or plain
text.  If the {\cb To File} button is active, output goes to that
file, otherwise the command string is executed to send output to a
printer.  If the characters ``{\vt \%s}'' appear in the command
string, they are replaced with the temporary print file name,
otherwise the temporary file name is appended to the string.

\index{help viewer!Reload}
\item{\cb Reload}\\
The {\cb Reload} button in the {\cb File} menu will re-read the input
file and redisplay the contents.  This can be useful when writing new
help text or HTML files, as it will show changes made to the input
file.  However, if you edit a ``{\vt .hlp}'' file, the internally
cached offsets for the topics below the editing point will be wrong,
and will not display correctly.  When developing a help text topic,
placing it in a separate file will avoid this problem.  If the
displayed object is a web page, the page will be redisplayed from the
disk cache if it is enabled, rather than being downloaded again.

\index{help viewer!Old Charset}
\item{\cb Old Charset}\\
The help viewer uses the UTF-8 character set, which is the current
standard international character set.  However, older input sources
may assume another character set, such as ISO-8859, that wll display
some characters incorrectly.  If the user observes that some
characters are missing or wrong in the display, setting this mode
might help.

\index{help viewer!Make FIFO}
\item{\cb <b>Make FIFO}\\
This controls an obscure but unique feature.  When the button is
pressed, a named pipe, or FIFO, is created in the user's home
directory.  The name is ``{\vt mozyfifo}'', or if this name is in use,
an integer suffix is added to make the name unique.  This is a special
type of file, that has the property in this case that text written to
this ``file'' will be parsed and displayed on the viewer screen.

The feature was developed for use in the stand-alone {\vt mozy}
program, for use as a HTML viewer for the {\vt mutt} mail client.  If
an HTML MIME attachment is ``saved'' to the FIFO file, it will be
displayed in the viewer.

The FIFO will be destroyed if this toggle button is pressed a second
time, or when the help window exist normally.  If the program crashes,
the FIFO may be left behind and require manual removal.

\index{help viewer!Quit}
\item{\cb Quit}\\
The {\cb Quit} button in the {\cb File} menu removes the help window.
\end{description}

The {\cb Options} menu presents a number of configuration and visual
attribute choices to the user.  These are described below.
\begin{description}

\index{help viewer!Save Config}
\index{help viewer!.mozyrc file}
\item{\cb Save Config}\\
The {\cb Save Config} button in the {\cb Options} will save a
configuration file in the user's home directory, named ``{\vt
.mozyrc}''.  This file is read whenever a new help window appears, and
sets various parameters, defaults, etc.  This provides persistence of
the options selected in the {\cb Options} menu.  Without an existing
{\vt .mozyrc} file, changes are discarded.  If the file exists, it
will be updated whenever a help window is dismissed.

\index{help viewer!Set Proxy}
\item{\cb Set Proxy}\\
This button will create or manipulate a {\vt .wrproxy} file in the
user's home directory, which will provide a transport proxy url for
internet access.  The proxy will apply in all {\XicTools} programs
when connecting to the internet.

The {\vt \$HOME/.wrproxy} file contains a single line giving the
internet url of the proxy server.  The proxy server will be used to
relay internet transactions such as checking for program updates,
obtaining data or input files via http or ftp transport, and general
internet access.

One can create a {\vt .wrproxy} file by hand with a text editor.  The
general form is
\begin{quote}
{\vt http://}{\it username\/}{\vt :}{\it password\/}{\vt @}{\it
 proxy.mydomain.com\/}{\vt :}{\it port}
\end{quote}
The format must be {\vt http}, {\vt https} is not supported at
present.  The {\it username} and {\it password} if needed are
specified as shown, using the colon `{\vt :}' and at-sign `{\vt @}' as
separators.  The address can be a numeric ip quad, or a standard
internet address.  The port number is appended following a colon.  No
white space is allowed within the text.

When the menu button is pressed, a pop-up appears that solicits the
proxy address.  Here, the address is the complete token, as described
above, but possibly without the port.  The port number can be passed
as a trailing number separated by white space, if it is not already
given (separated by a colon).  If no port number is given, the system
will assume use of port number 80.

If the entry area is empty, any existing {\vt .wrproxy} file will be
moved to ``{\vt .wrproxy.bak}'' in the user's home directory,
effectively disabling use of a proxy.  The behavior will be identical
if the address consists of a hyphen `{\vt -}'.  An existing {\vt
.wrproxy.bak} file will be overwritten.  If the hyphen is followed by
some non-space characters, the {\vt .wrproxy} file will be moved to a
new file where the given characters serve as a suffix following a
period.  For example, if {\vt -ZZ} is given, the new file would be
``{\vt .wrproxy.ZZ}'' in the user's home directory.  An existing file
of that name will be overwritten.

If the argument consists of only a plus sign `{\vt +}', if a file
named ``{\vt ,wrproxy.bak}'' exists in the user's home directory, it
will be moved to {\vt .wrproxy}.  An existing {\vt .wrproxy} will be
overwritten.  If the `{\vt +}' is followed by some non-space
characters, the command will look for a file where the characters are
used as a suffix, as above, and if found the file will be moved to
{\vt .wrproxy}.

Only the {\vt .wrproxy} file will provide a proxy url, the other files
are ignored.  The renamed files provide convenient storage, for
quickly switching between proxys, or no proxy.

Otherwise, if an address is given, the first argument must start with
``{\vt http:}'' or an error will result.

\index{help viewer!Search Database}
\index{search help database}
\item{\cb Search Database}\\
The {\cb Search Database} button in the {\cb Options} menu brings up a
dialog which solicits a regular expression to use as a search key into
the help database.  The regular expression syntax follows POSIX 1003.2
extended format (roughly that used by the Unix {\vt egrep} command). 
The search is case-insensitive.  When the search is complete, a new
display appears, with the database entries which contained a match
listed in the ``References'' field.  The library functions which
implement the regular expression evaluation differ slightly between
systems.  Further information can be found in the Unix manual pages
for ``regex''.

\index{help viewer!Find Text}
\item{\cb Find Text}\\
The {\cb Find Text} command enables searching for text in the window. 
A dialog window appears, into which a regular expression is entered. 
Text matching the regular expression, if any, is selected and scrolled
into view, on pressing one of the blue up/down arrow buttons.  The
down arrow searches from the text shown at the top of the window to
the end of the document, and will highlight the first match found, and
bring it into view if necessary.  The up button will search the text
starting with that shown at the bottom of the window to the start of
the document, in reverse order.  Similarly, it will highlight and
possibly scroll to the first match found.  The buttons can be pressed
repeatedly to visit all matches.

\index{help viewer!Default Colors}
\item{\cb Default Colors}\\
The {\cb Default Colors} button in the {\cb Options} menu brings up
the {\cb Default Colors} panel, from which the default colors used in
the display may be set.  The entries provide defaults which are used
when the document being displayed does not provide alternative values
(in a {\vt <body>} tag).  The defaults apply in general to help text.

The color entries can take a color name, as listed in the listing
brought up with the {\cb Colors} button, or a numerical RGB entry in
any common format.  The entries are the following:

\begin{description}
\item{\cb Background color}\\
Set the default background color used.

\item{\cb Background image}\\
If set to a path to an image file in any standard image format, the
image is used to tile the background.

\item{\cb Text color}\\
The default color to use for text.

\item{\cb Link color}\\
The default color to use for un-visited links.

\item{\cb Visited link color}\\
The default color to use for visited links.

\item{\cb Activated link color}\\
The default color to use for a link over which the user presses a
mouse button.  

\item{\cb Select color}\\
The color to use as the background of selected text.  This color can
not be set from the document.

\item{\cb Imagemap border color}\\
The color to use for the border drawn around imagemaps.  This color
can not be set from the document.
\end{description}

The {\cb Colors} button brings up a panel which lists available named
colors.  Clicking on a name in this panel selects it, and enters the
name into the system clipboard.  The ``paste'' operation can then be
used to enter the color name into an entry area.  This may vary
between systems, typically clicking on an entry area with the middle
mouse button will paste text from the clipboard.

Pressing the {\cb Apply} button will apply the new colors to the
viewer window.  Pressing {\cb Dismiss} or otherwise retiring the panel
without pressing {\cb Apply} will discard changes.  Changes made will
{\bf not} be persistent unless the {\cb Save Config} button has been
used to create a {\vt .mozyrc} file, as mentioned above.

\index{help viewer!Set Font}
\item{\cb Set Font}\\
The {\cb Set Font} button in the {\cb Options} menu will bring up a
font selection pop-up.  One can choose a typeface from among those
listed in the left panel.  The base size can be selected in the right
panel.  There are two separate font families used by the viewer:  the
normal, proportional-spaced font, and a fixed-pitch font for
preformatted and ``typewriter'' text.  Pressing {\cb Apply} will set
the currently selected font.  The display will be redrawn using the
new font.

\index{help viewer!disk cache}
\item{{\cb Cache} group}\\
A disk cache of downloaded pages and images is maintained.  The cache
is located in the user's home directory under a subdirectory named
``{\vt .wr\_cache}''.  The cache files are named ``{\vt wr\_cache}{\it
N}''" where {\it N} is an integer.  A file named ``{\vt directory}''
in this directory contains a human-readable listing of the cache files
and the original URLs.  The listing consists of a line with internal
data, followed by data for the cache files.  Each such line has three
columns.  The first column indicates the file number {\it N}.  The
second column is 0 if the {\vt wr\_cache}{\it N} file exists and is
complete, 1 otherwise.  The third column is the source URL for the
file.  The number of files saved is limited, defaulting to 64.  The
cache only pertains to files obtained through HTTP transfer.  This
directory may also contain a file named ``{\vt cookies}'' which
contains a list of cookies received from web sites.

A page will not be downloaded if it exists in the cache, unless the
modification time of the page is newer than the modification time of
the cache file.

\index{help viewer!Don't Cache}
The {\cb Don't Cache} button in the {\cb Options} menu will disable
caching of downloaded pages and images.

\index{help viewer!Clear Cache}
The {\cb Clear Cache} button in the {\cb Options} menu will clear the
internal references to the cache.  The files, however, are not cleared.

\index{help viewer!Reload Cache}
The {\cb Reload Cache} button in the {\cb Options} menu will clear and
reload the internal cache references from the files that presently
exist in the cache directory.

\index{help viewer!Show Cache}
The {\cb Show Cache} button in the {\cb Options} menu brings up a
listing of the URLs in the internal cache.  Clicking on one of the
URLs in the listing will load that page or image into the viewer.
This is particularly useful on a system that is not continuously
on-line.  One can access the pages while on-line, then read them
later, from cache, without being on-line.

\index{help viewer!cookies}
\item{\cb No Cookies}\\
Support is provided for Netscape-style cookies.  Cookies are small
fragments if information stored by the browser and transmitted to or
received from the web site.  The {\cb No Cookies} button in the {\cb  
Options} menu will disable sending and receiving cookies.  With
cookies, it is possible to view certain web sites that require
registration (for example).  It is also possible to view some commerce
sites that require cookies.  There is no encryption, so it is not a
good idea to send sensitive information such as credit card numbers.

\index{help viewer!image formats}
\index{help viewer!No Images}
\index{help viewer!Sync Images}
\index{help viewer!Delayed Images}
\index{help viewer!Progressive Images}
\item{\cb Images} group\\
Image support is provided for gif, jpeg, png, tiff, xbm, and xpm. 
Animated gifs are supported as well.  Images found on the local file
system are always displayed immediately (unless debugging options are
set in the startup file).  The treatment of images that must be
downloaded is set by this button group in the {\cb Options} menu.  One
and only one of these choices is active.  If {\cb No Images} is
chosen, images that aren't local will not be displayed at all.  If
{\cb Sync Images} is chosen, images are downloaded as they are
encountered.  All downloading will be complete before the page is
displayed.  If {\cb Delayed Images} is chosen, images are downloaded
after the page is displayed.  The display will be updated as the
images are received.  If {\cb Progressive Images} is chosen, images
are downloaded after the page is displayed, and images are displayed
in sections as downloading progresses.

\index{help viewer!anchor styles}
\index{help viewer!Anchor Plain}
\index{help viewer!Anchor Buttons}
\index{help viewer!Anchor Underline}
\index{help viewer!Anchor Underline}
\index{help viewer!Anchor Highlight}
\item{\cb Anchor} group\\
There are choices as to how anchors (the clickable references) are
displayed.  If the {\cb Anchor Plain} button in the {\cb Options} menu
is selected, anchors will be displayed with standard blue text.  If
{\cb Anchor Buttons} is selected, a button metaphor will be used to
display the anchors.  If {\cb Anchor Underline} is selected, the
anchor will consist of underlined blue text.  The underlining style
can be changed in the ``{\vt mozyrc}'' startup file.  One and only
one of these three choices is active.  In addition, if {\cb Anchor
Highlight} is selected, the anchors are highlighted when the pointer
passes over them.

\index{help viewer!Bad HTML Warnings}
\item{\cb Bad HTML Warnings}\\
If the {\cb Bad HTML Warnings} button in the {\cb Options} menu is
active, messages about incorrect HTML format are emitted to standard
output.

\index{help viewer!Freeze Animations}
\item{\cb Freeze Animations}\\
If the {\cb Freeze Animations} button in the {\cb Options} menu is
active, active animations are frozen at the current frame.  New
animations will stop after the first frame is shown.  This is for
users who find animations distracting.

\index{help viewer!Log Transactions}
\item{\cb Log Transactions}\\
If the {\cb Log Transactions} button in the {\cb Options} menu is
active, the header text emitted and received during HTTP transactions
is printed on the terminal screen.  This is for debugging and hacking.
\end{description}

The {\cb Bookmarks} menu contains entries to add and delete entries,
plus a list of entries.  The entries, previously added by the user,
are help keywords, file names, or URLs that can be accessed by
selecting the entry.  Thus, frequently accessed pages can be saved for
convenient access.  Pressing the {\cb Add} button will add the page
currently displayed in the viewer to the list.  The next time the {\cb
Bookmarks} menu is displayed, the topic should appear in the menu.  To
remove a topic, the {\cb Delete} button is pressed.  Then, the menu is
brought up again, and the item to delete is selected.  This will
remove the item from the menu.  Selecting any of the other items in
the menu will display the item in the viewer.  The bookmark entries
are saved in a file named ``{\vt bookmarks}'' which is located in the
same directory containing the cache files.

%SU-------------------------------------
% helpdb 031413
\subsection{The Help Database}

\index{help database}
The help system uses a fast hashed lookup table containing cached file
offsets to the entry text.  A modular database provides flexibility
and portability.  The files are located by default in the directories
named ``{\vt help}'' under the library tree, which is usually rooted
at {\vt /usr/local/xictools}.  {\Xic} and {\WRspice} allow the
user to specify the help search path through environment variables
and/or startup files.  All of the files with suffix ``{\vt .hlp}'' in
the directories along the help search path are parsed, and reference
pointers added to the internal list, the first time the help command
is issued in the application.  In addition, other types of files, such
as image files, which are referenced in the HTML help text may be
present as well.

The ``{\vt .hlp}'' files have a simple format allowing users to create
and modify them.  Each help item is indexed by a keyword which should
be unique in the database.  The help text may be in HTML or plain text
format.  The format is described in \ref{helpfiles}.

%SU-------------------------------------
% helpforms 031413
\subsection{Help System Forms Processing}

Support is provided for HTML forms.  When the form ``Submit'' button
is pressed, a temporary file is created which contains the form output
data.  The file consists of key/value pairs in the following formats:
\begin{quote}
{\it name\/}={\it single\_token}\\
{\it name\/}="{\it any text\/}''
\end{quote}
There is no white space around `=', and text containing white space is
double-quoted.  Each assignment is on a separate line.

The action string from the ``{\vt <form ...>}'' tag determines how   
this file is used.  The file is a temporary file, and is deleted
immediately after use.  If the action string is in the form ``{\vt   
action\_local\_}{\it xxxx\/}'', then the form data are processed
internally.

If the full path for the action string begins with ``{\vt http://}''
or ``{\vt ftp://}'', then the form data are encoded into a query
string and sent to the location (though it is likely an error for
ftp).  Otherwise, the file will processed locally.  This enables the
output from the form to be processed by a local shell script or
program, which can be very useful.  The command given as the action
string is given the file contents as standard input.  The command
standard output will appear in the HTML viewer window.  Thus, one can
create HTML form front-ends for favorite shell commands and programs.

%SU-------------------------------------
% helpinit 031413
\subsection{Help System Initialization File}

When a help window pops up, an initialization file is read, if it
exists.  This file is named ``{\vt .mozyrc}'' and is sought in the
user's home directory.  This file is not created automatically, but is
created or overwritten with the {\cb Save Config} button in the {\cb
Options} menu of a help window.  This need be done once only.  It
should be done if a {\vt .mozyrc} file exists, but it is from a
release breanch earlier than 3.3.  Once a {\vt .mozyrc} file exists,
it will be updated when leaving help, reflecting any setting changes.

Incidently ``mozy'' is the name of the stand-alone version of the HTML
viewer/web browser available on the Whiteley Research web site.


%S-----------------------------------------------------------------------------
\section{The {\WRspice} Shell}
\label{shell}
\index{shell}

% spShell.hlp:spshell 012309

The command line interpreter in {\WRspice} provides many of the
features of a UNIX shell.  The interpreter, in addition to parsing and
responding to command text input, is used as an interpreter for
control scripts which control {\WRspice} operation.  In addition,
circuit descriptions have all shell variables expanded during the
sourcing process.  Thus, shell variables can be used to set circuit
parameters.

Various features are available in the {\WRspice} shell which are
similar to the user interface of the C-Shell.  These include IO
redirection, history substitution, aliases, global substitution, and
command completion.

%SU-------------------------------------
\subsection{Command Line Editing}
\index{command editing}

% spShell.hlp:editing 012309

The {\WRspice} shell contains a line editor system similar to that
found in some UNIX shells.  The left and right arrow keys can be used
to move the cursor within the line of text, so that text can be
entered or modified at any point.  Pressing the {\kb Enter} key sends
the line of text to {\WRspice}, regardless of where the cursor is at
the time.  The up arrow key will load the line of text with the
previously entered line progressively.  The down arrow key cycles back
through the history text.  {\kb Ctrl-E} places the cursor at the end
of text, {\kb Ctrl-A} places the cursor at the beginning of the line. 
{\kb Bsp} (backspace) erases the character to the left of the cursor,
{\kb Delete} deletes the character at the cursor, and {\kb Ctrl-K}
will delete from the cursor to the end of the line.  {\kb Ctrl-U} will
delete the entire line.

The following keys perform editing functions:

\begin{tabular}{|l|l|}\hline
\kb Ctrl-A & Move cursor to beginning of line\\ \hline
\kb Ctrl-D & List possible completion matches\\ \hline
\kb Tab    & Insert completion match, if any\\ \hline
\kb Ctrl-E & Move cursor to end of line\\ \hline
{\kb Ctrl-H} or {\kb Bsp} & Erase character to left of cursor\\ \hline
\kb Ctrl-K & Delete to end of line\\ \hline
\kb Ctri-U & Delete line\\ \hline
\kb Ctrl-V & Insert following character verbatim\\ \hline
\kb Delete & Delete character at cursor\\ \hline
\kb Left arrow  & Move cursor left\\ \hline
\kb Right arrow & Move cursor right\\ \hline
\kb Up arrow    & Back through history list\\ \hline
\kb Down arrow  & Forward through history list\\ \hline
\end{tabular}

By default, command line editing is enabled in interactive mode, which
means that {\WRspice} takes control of the low level functions of the
terminal window.  Command line editing can be disabled by setting the
{\et noedit} variable (with the {\cb set} command).  If the terminal
window doesn't work with the editor, it may be necessary that ``{\vt
set noedit}'' appear in the {\WRspice} startup ({\vt .wrspiceinit})
file.  When {\et noedit} is set, the command completion character is
{\kb Esc}, rather than {\kb Tab}.

Some terminals may not send the expected character or sequence when
one of these keys is pressed, consequently there is a limited key
mapping facility available.  This mapping is manipulated with the {\cb
mapkey} command, which allows most of the keys and combinations listed
above to be remapped.

Unless {\WRspice} can read the system terminfo/termcap data it needs,
it will not allow command line editing, and a warning message will be
issued.  This may mean that the {\et TERM} or {\et TERMINFO}
environment variables are not set or bogus, or the system terminal
info database is incomplete or bad.  One can enter alternative
terminal names with the {\vt -t} command line option to potentially
fix this problem.  The non-editing mode is like a standard terminal
line, where backspace is available, but the arrow keys and others that
move the cursor have no special significance.  This is the mode used
when ``{\vt set noedit}'' is given.

%SU-------------------------------------
\subsection{Command Completion}
\index{command completion}

% spShell.hlp:ccom 012309

Tenex-style command, filename, and keyword completion is available.
If {\kb Ctrl-D} (EOF) is typed, a list of the commands or possible
arguments is printed.  If {\kb Tab} (or instead, {\kb Esc} if command
line editing is disabled) is typed, then {\WRspice} will try to
complete the word being typed based on the choices available, or if
there is more than one possibility, it will complete as much as it
can.  Command completion knows about commands, most keywords, variable
and vector names, file names, and several other types of arguments. 
To get a list of all commands, the user can type {\kb Ctrl-D} at the
{\WRspice} prompt.  Note that for keyboard input, the {\vt EOF}
character, {\kb Ctrl-D}, does {\it not} exit the shell.

Command completion is disabled if the {\vt -q} option is given on the
{\WRspice} command line, or if the {\et nocc} variable is set.

%SU-------------------------------------
\subsection{History Substitution}
\index{history substitution}

% spShell.hlp:historysub 012309

History substitutions, similar to C-shell history substitutions, are
also available.  History substitutions are prefixed by the character
{\vt !}, or at the beginning of a line, the character {\vt
\symbol{94}}.  Briefly, the string {\vt !!} is replaced by the
previous command, the string {\vt !}{\it prefix} is replaced by the
last command with that prefix, the string {\vt !}?{\it pattern} is
replaced by the last command containing that pattern, the string {\vt
!}{\it number} is replaced by the event with that number, and {\vt
\symbol{94}}{\it oldpattern\/}{\vt \symbol{94}}{\it newpattern\/} is
replaced by the previous command with {\it newpattern\/} substituted
for {\it oldpattern\/}.

Additionally, a {\vt !}{\it string} sequence may be followed by a
modifier prefixed with a {\vt :}.  This modifier may select one or
more words from the event --- {\vt :1} selects the first word, {\vt
:2-5} selects the second through the fifth word, {\vt :\$} selects the
last word, and {\vt :\$-0} selects all of the words but reverses their
order.

Two other {\vt :} modifiers are supported: {\vt :p} will cause the
command to be printed but not executed, and {\vt :s\symbol{94}}{\it
old\/}{\vt \symbol{94}}{\it new\/} will replace the pattern {\it
old\/} with the pattern {\it new\/}.  The sequence {\vt
\symbol{94}}{\it old\/}{\vt \symbol{94}}{\it new\/} is synonymous with
{\vt !!:s\symbol{94}}{\it old\/}{\vt \symbol{94}}{\it new\/}.

All the commands typed by the user are saved on the history list. 
This may be examined with the {\cb history} command, and its maximum
length changed by changing the value of the {\et history} variable.

%SU-------------------------------------
\subsection{Alias Substitution}
\index{alias substitution}

% spShell.hlp:aliases 012309

Aliases are defined with the {\cb alias} command, and may be removed
with the {\cb unalias} command.

After history expansion, if the first word on the command line has
been defined as an alias, the text for which it is an alias for is
substituted.  The alias may contain references to the arguments
provided on the command line, in which case the appropriate arguments
are substituted in.  If there are no such references, any arguments
given are appended to the end of the alias text.

If a command line starts with a backslash `{\vt \symbol{92}}' any
alias substitution is inhibited.
 
%SU-------------------------------------
\subsection{Global Substitution}
\index{global substitution}

% spShell.hlp:glob 012309

The characters {\vt \symbol{126}}, \{, \} have the same effects as
they do in the C-Shell, i.e., home directory and alternative
expansion.  In alternative expansion, if a token contains a form like
``\{{\vt foo,bar,baz}\}'', the token is replicated with each
replication containing one of the list items from the curly braces
replacing the curly brace construct.  For example, the string ``{\vt
stuff}\{{\vt string1,string2,...stringN}\}{\vt morestuff}'' is
replaced by the list of words ``{\vt stuffstring1morestuff} {\vt
stuffstring2morestuff} ...  {\vt stuffstringNmorestuff}''.  Curly
braces may be nested.  A particularly useful example is
\begin{quote}
{\vt plot v(}\{{\vt 4,5,7}\}{\vt )}
\end{quote}
which is equivalent to
\begin{quote}
{\vt plot v(4) v(5) V(7)}
\end{quote}

The string {\vt \symbol{126}}{\it user} (tilde at the beginning of a
word) is replaced by the given user's home directory, or if the first
component of the pathname is simply ``{\vt \symbol{126}}'', the
current user's home directory is understood.

It is possible to use the wildcard characters {\vt *}, {\vt ?}, {\vt
[}, and {\vt ]} to match file names, where {\vt *} denotes 0 or more
characters, {\vt ?} denotes one character, and {\vt [...]} denotes one
of the specified characters, but these substitutions are performed
only if the variable {\et noglob} is unset.  The pattern {\vt
[\symbol{94}abc]} will match all characters except {\vt a}, {\vt b},
and {\vt c}.  The {\et noglob} variable is normally set so that the
symbols have their usual meanings in algebraic expressions.  This can
be unset with the {\cb unset} command if command ``globbing'' is
desired.

%SU-------------------------------------
\subsection{Quoting}
\index{quoting}

% spShell.hlp:quoting 091714

\subsubsection{Single and Double Quoting}
\index{quoting!single}
\index{single quoting}
\index{quoting!double}
\index{double quoting}

Words may be quoted with the characters ({\vt "}) (double quote), and
({\vt '}) (single quote).  A word enclosed by either of these quotes
may contain white space.  A string enclosed by double quotes may have
further special-character substitutions done on it, but it will be
considered a single token by the shell.  A number so quoted is
considered a string.  A string enclosed by single quotes also has all
its special characters protected.  Thus no global expansion ({\vt *},
{\vt ?}, etc), variable expansion ({\vt \$}), or history substitution
({\vt \symbol{94}}, {\vt !}) will be done.

\subsubsection{Single-Character Quoting}
\index{quoting!backslash}
\index{backslash quoting}

The backslash character performs the usual single character quoting
function, i.e., it suppresses the special-character interpretation of
the character that follows, forcing the shell to interpret it
literally.  In addition, {\kb Ctrl-V} also provides a single character
quoting function from the keyboard.

\subsubsection{Back-Quoting, Command Evaluation}
\index{quoting!backquote}
\index{backquote substitution}

A string enclosed by backquotes ({\vt `}) is considered a command and
is executed, and the output of the command replaces the text.

In releases 4.1.7 and earlier, the command was simply sent to the
operating system, and evaluated by whatever shell is supervising the
user's login.  In release 4.1.8 and later, back-quoted text is
evaluated by the {\WRspice} shell itself, unless the text begins with
the keyword ``{\vt shell}'' in which case the rest of it is sent to
the operating system for evaluation.

The new approach makes it possible to get the output of internal
{\WRspice} commands and functions into strings, which was not easy (or
even possible?) before.  However, this may require updating legacy
scripts.  For example, lines like
\begin{quote}\vt
set datestring="`date`"
\end{quote}
must be changed to
\begin{quote}\vt
set datestring="`shell date`"
\end{quote}


%SU-------------------------------------
\subsection{I/O Redirection}
\index{io redirection}

% spShell.hlp:io 012309

The input to or output from commands may be changed from the terminal
to a file by including IO redirection on the command line.  The
possible redirections are:

\begin{description}
\item{ \vt >} {\it file}\\
Send the output of the command into the file.  The file is created if
it doesn't exist.

\item{\vt >>} {\it file}\\
Append output to the file.  The file is created if it doesn't exist.

\item{\vt >\&} {\it file}\\
Send both the output and the error messages to the file.  The file is
created if it doesn't exist.

\item{\vt >>\&} {\it file}\\
Append both the output and the error messages to the file.  The file
is created if it doesn't exist.

\item{\vt <} {\it file}\\
Read input from the file.
\end{description}

Both an input redirection and an output redirection may be present
on a command line.  No more than one of each may be present,
however.  IO redirections must be at the end of the command line.

%SU-------------------------------------
\subsection{Semicolon Termination}
\index{semicolon termination}

% spShell.hlp:semi 012309

More than one command may be put on one line, separated by semicolons
`{\vt ;}'.  The semicolons must be isolated by white space, however. 
Thus a multi-command alias might be written
\begin{quote}
{\vt alias} {\it word} '{\it command1} ; {\it command2} ; ...'
\end{quote}

%SU-------------------------------------
\subsection{Variables and Variable Substitution}
\label{variablesub}
\index{shell variables}
\index{variables, shell}
\index{Variables tool}

% spShell.hlp:variablesub 080816

Shell variables can be set with the {\cb set} command, or graphically
with some of the tools available in the {\cb Tools} menu of the {\cb
Tool Control} window.  In particular, the {\cb Shell} button in the
{\cb Tools} menu brings up a panel which allows those variables which
control shell behavior to be set.  Both methods of setting and
unsetting the shell variables are equivalent.  The {\cb Variables}
tool in the {\cb Tools} menu provides a listing of the variables
currently set, and is updated dynamically when variables are set and
unset.  A variable with any alphanumeric name can be set, though there
are quite a number of predefined variable names which have
significance to {\WRspice}.

\index{variable types}
Shell variables have boolean type if they are defined without
assigning any text to them.  Otherwise, the variables take a single
text token as their defining value, or a list of text tokens if the
assigned value consists of a list of tokens surrounded by
space-separated parentheses.  See \ref{setcmd} for details of the
syntax of the {\cb set} command.

\index{variable substitution}
The values of variables previously set can be accessed in commands,
circuit descriptions, or elsewhere by writing {\vt \$}{\it varname\/}
where the value of the variable is to appear.  However, if a backslash
({\vt $\backslash$}) precedes {\vt \$}, the variable substitution is not
performed.  The special variable references {\vt \$\$} and {\vt \$<}
are replaced by the process ID of the program and a line of input
which is read from the terminal when the variable is evaluated,
respectively.  Also, the notation {\vt \$?foo} evaluates to 1 if the
variable {\vt foo} is defined, 0 otherwise, and {\vt \$\#foo}
evaluates to the number of elements in {\vt foo} if it is a list, 1 if
it is a number or string, and 0 if it is a boolean variable.  If {\vt
foo} is a valid variable, and is of type list, then the expression
{\vt \$foo}[{\it low\/}-{\it high\/}] represents a range of elements. 
The values in the range specification {\vt [...]} can also be shell
variable references.  Either the upper index or the lower may be left
out, and the reverse of a list may be obtained with {\vt \$foo}[{\it
len\/}-0].

\index{global return value}
In releases 4.2.12 and later, the independent token {\vt \$?} is
replaced by the current value of the ``global return value''.  The
global return value is an internal constant accessible from all
scripts, and can be used to pass data between scripts and return data
from scripts.  It is a global variable so one must make sure that its
value can not be changed unexpectedly before use.  The initial value
is zero, and it retains its most recent value indefinitely.

The global return value is set by the string comparison commands {\cb
strcmp} and friends, and can be set directly with the {\cb retval}
command.  This can be called within a script to set a value that the
caller can access after the script returns.

\index{vector substitution}
If a variable reference has the form {\vt \$\&{\it word\/}}, then {\it
word\/} is assumed to be a vector, and its value is used to satisfy
the reference.  Vectors consist of one or more real or complex
numbers, and are produced, among other ways, during simulation, in
which case they represent simulation output.  The shell variable
substitution mechanism allows reference to all of the vectors in
scope.  The reference can be followed by range specifiers in square
brackets, consistent with the dimensionality and size of the vector. 
The range specifier can itself contain shell variable references.  The
complete information on vectors and vector expressions is presented in
\ref{vectors}.

The sequences {\vt \$?\&}{\it vector} and {\vt \$\#\&}{\it vector} are
accepted.  The first expands to 1 if {\it vector} is defined with the
{\cb let} command or otherwise, 0 if not.  The second expands to the
vector length or 0 if {\it vector} is undefined.  This is analogous to
{\vt \$?}{\it variable} and {\vt \$\#}{\it variable} for shell
variables.

\index{expression substitution}
The notation {\vt \$\&}({\it expression\/}) is replaced by the value
of the vector {\it expression\/}.  A range specification can be added,
for example
\begin{quote}
\vt echo \$\&(a+1)[2]
\end{quote}
prints the third entry in vector {\vt a+1}, or 0 if out of range.

When a real number is converted into text during expansion, up to 14
significant figures may be used to avoid loss of precision.  Trailing
zeroes are omitted.  However, in releases 4.2.4 and earlier, and
Spice3, only six significant digits were used.

\index{variable expansion}
When a circuit file is sourced into {\WRspice}, each line of the
circuit description has variable substitution performed by the shell. 
Thus, shell variables can be used to define circuit parameters, if
within the circuit description the parameter is specified in the form
of a variable reference.  The variable substitution in a SPICE deck
allows a concatenation character `{\vt \%}'.  This is used between a
variable and other text, which would otherwise mask the variable.  For
example
\begin{quote}\vt
set value = 10\\
v1 1 0 pulse(0 \$value\%m 5p 10p)
\end{quote}
expands to
\begin{quote}\vt
v1 1 0 pulse(0 10m 5p 10p).
\end{quote}
Without the {\vt \%}, the pattern match would fail.

%SU-------------------------------------
\subsection{Commands and Scripts}
\index{command interpretation}
\index{command scripts}
\index{scripts}

% spShell.hlp:script 092915

Command files are files containing circuit descriptions and/or shell
commands.  The first line of a command file is ignored, so must be
blank or a comment.  This is a result of the {\cb source} command
being used for both circuit input and command file execution.

A pure script file, i.e., one which does not include a circuit
description, consists of an unread ``title'' line, followed by a
control block.  The control block begins with a ``{\vt .control}''
line, continues with one or more executable statements, and terminates
with a ``{\vt .endc}'' line.  In {\WRspice}, an ``{\vt .exec}'' line
can be used rather than the {\vt .control} line, though for backward
compatibility with SPICE3, it is recommended that the traditional {\vt
.control} be used.  The executable statements are any statements
understandable to the {\WRspice} shell.  Typically, such statements
appear just as they would be entered on the command line if given as
text input.  A script may be executed by entering its file name (there
is an implicit <tt>source</tt> command) followed by any arguments. 
Scripts can call other scripts to any depth.

\index{script comments}
In script text, the `{\vt \#}' character is used to designate a
comment.  If the `{\vt \#}' is the first character in a line, or
follows white space, the `{\vt \#}', and the preceding white space,
and any trailing text, is ignored.  If the `{\vt \#}' is preceded by a
backslash, the comment interpretation is explicitly suppressed.  The
in-line comment interpretation of `{\vt \#}' applies only in scripts,
not from the command line.

Before a script is read, the variables {\et argc} and {\et argv} are
set to the number of words on the command line, and a list of those
words respectively.  Their previous values (if any) are pushed onto a
stack, and popped back in place when the script terminates.  Thus,
within a command script, these predefined variables are available for
use in the script.  Otherwise, command files may not be reentrant
since there are no local variables, however, the procedures may
explicitly manipulate a stack.

If a command file contains a circuit discription, then there is a
subtle difference between {\vt .control} and {\vt .exec} blocks,
either or both of which can be contained in the file.  By ``file'' we
actually mean the totality of text after expanding all {\vt .include},
{\vt .lib} and similar statements.  The {\vt .exec} block is executed
before the circuit lines are parsed, and thus before the lines are
shell and parameter expanded.  Thus, shell variables set in the {\vt
.exec} block will be used when expanding the circuit.  The {\vt
.control} block is executed after the circuit is parsed, and is
therefor the correct place to put analysis and post-processing
commands.

There may be various command scripts installed in the default scripts
directory, and the default {\et sourcepath} includes this directory,
so one can use these command files (almost) like built-in commands. 
In addition to scripts, there is an executable data structure called a
``codeblock''.  Codeblocks are derived from scripts, but store the
command text internally, so are somewhat more efficient.  A codeblock
has the same name (in general) as the script file from which it was
derived.  See the description of the {\cb codeblock} command (in
\ref{codeblock}) for more information.

When a line of input is given to {\WRspice}, the first word on the
line determines how the line is processed.  The following logic is
used to make this determination.

\begin{enumerate}
\item{If the word is an alias, the line is replaced with the result
after alias substitution, and the line is re-parsed.}

\item{If the word matches the name of a codeblock in memory, the
codeblock is executed.}

\item{If the word matches the name of an internal command, that
command is executed.}

\item{If the first word is a vector name and is followed by ``{\vt
=}'', the line is taken to be an implicit {\cb let} command (an
assignment), in which case the line is executed as if it were preceded
by the word ``let''.}

\item{If the word matches the name of a file found in one of the
directories of the current {\et sourcepath} (search path), an implicit
{\cb source} command is assumed.  The line is executed as if it were
preceded by the word ``source''.  Thus, typing the name of a circuit
or script file will source or run the file.}

\item{If the variable {\et unixcom} is set, and the word matches the
name of a command known to the operating system, the line will be sent
to the operating system for execution.}
\end{enumerate}

If the variable {\et unixcom} is set and the operating system is
supportive, commands which are not built-ins are considered shell
commands and executed as if the program were a shell.  However, using
this option increases the start-up time of the program.  Probably
{\WRspice} should not be used as a login shell.

\index{shell scripts}
{\WRspice} can be used as the ``shell'' in UNIX shell scripts.  In
these scripts, the {\vt wrspice} executable should be called, using
the convention applicable to the user's UNIX shell.  This generally
requires that the first line of the script begin with the characters
``{\vt \#!}'' and be followed by a space-separated program invocation
string.  The remainder of the file should consist of standard
{\WRspice} command file lines, the first line of which (second line of
the file) will be ignored.

For example, below is a script that can be saved in a file, which
should be made executable (using the UNIX command ``{\vt chmod +x {\it
filename\/}}'').  From the UNIX shell, typing the name of the file
will run {\WRspice} on the example file {\vt mosamp2.cir} and display
the plot.

\begin{quote}\vt
    \#! wrspice -J\\
    \#\\
    .control\\
    source /usr/local/xictools/wrspice/examples/mosamp2.cir\\
    set noaskquit\\
    echo Press Enter to quit\\
    pause\\
    quit\\
    .endc\\
\end{quote}

Typing the name of the file is the same as executing ``{\vt wrspice
-J} {\it file}''.  {\WRspice} ignores the {\vt \#!...} line, so that
the next line is the ``title'' line and is also ignored.  The {\vt -J}
(JSPICE3 compatibility) means to not bring up the {\cb Tool Control}
window.


%SU-------------------------------------
\subsection{The FIFO}
\label{fifo}
\index{fifo}
\index{named pipe}
\index{wrsfifo}

% spShell.hlp:fifo 022514

When {\WRspice} starts, it creates a ``named pipe''.  For other than
Windows, this looks to the user like a file named ``{\vt wrsfifo}'' in
the user's home directory, or {\vt wrsfifo1}, {\vt wrsfifo2}, etc., if
there are multiple copies of {\WRspice} running.  In Windows, the file
will instead have a name like
``${\backslash}{\backslash}.{\backslash}${\vt pipe}${\backslash}${\vt
wrsfifo}'', which will again vary if there are multiple {\WRspice}
processes running.

If a variable named {\et WRSPICE\_FIFO} is found in the environment,
the text of this variable is taken as the base name for the fifo,
instead of ``{\vt wrsfifo}''.  In Unix/Linux, this name can have a
full path.  All components of the path except for the file name must
exist.  If there is a conflict with an existing entity, an integer
suffix will be added to make the name unique.  In Windows, any path
given is stripped and ignored.

A named pipe, or ``fifo'' has the property that text written to this
``file'' will be sourced into {\WRspice}, as if the {\cb source}
command was used on a regular file containing the data written.  In
particular, if you are editing a SPICE file with your favorite text
editor, you can ``save'' the text to this file name, and it gets
sourced into {\WRspice}.  One should also save to a regular file, or
changes may be lost!

When {\WRspice} terminates normally, the fifo will be deleted. 
However, if {\WRspice} crashes, or is killed by a signal, the fifo may
be left behind, in which case it can be, and should be, deleted by the
user.  The fifo can be deleted using the same command as a regular
file.

As {\WRspice} is a single-threaded program, it will only be
``listening'' to the fifo when idle.  Exactly what happens when
{\WRspice} is busy when data are written to the fifo is operating
system dependent.  Likely, the write will hang until {\WRspice} goes
into idle mode, i.e., the simulation or other operation completes.


%S-----------------------------------------------------------------------------
\section{Plots, Vectors and Expressions}
\label{vectors}
\index{plot description}
\index{vector description}

% spExpressions.hlp:plotvec 032320

%SU-------------------------------------
\subsection{Plots and Vectors}

{\WRspice} data are in the form of vectors, which are lists of numbers
that may represent, e.g., time, voltage, or any typed or untyped set
of values.  Vectors of length one are termed ``scalars''.  During a
simulation, each of the circuit variables, plus a scale vector, are
filled with data from the simulation.  For example, in transient
analysis, the scale vector (named ``{\vt time}'') will contain the
time values where output is generated, and each node and other circuit
variables will have a corresponding vector of the same length as the
scale, containing the values for the scale points.

\index{exec plot}
For each simulation, the resulting vectors are contained in a
``plot'', which is a container data structure for vectors.  The plot
is given a name (such as ``tran2''), and appended to a list containing
other previously-generated plots.  If an input file contains an {\vt
.exec} block in which vectors are created, a special ``exec'' plot
will be created to hold these.  There is also an internally generated
plot named ``{\vt constants}'' which contains various scalars set to
constant values.  The {\vt constants} plot can not be deleted, thus
the internal plot list is never empty.

When a plot data file is read into {\WRspice} with the {\cb load}
command, a plot containing vectors is produced, as if an anaylsis had
been run.  The new plot becomes the current plot.

\index{current plot}
When a new plot is created by an analysis or with the {\cb load}
command, it becomes the ``current plot''.  The current plot represents
a context, where the existing vectors can be accessed by their name,
and new vectors created, for example with the {\cb let} command, will
(by default) be added to the current plot.

The current plot is usually the last plot produced by an analysis run,
or the {\vt constants} plot if no analyses have been run or rawfiles
loaded.  The current plot can be changed with the {\cb setplot}
command, or with the {\cb Plots} panel from the {\cb Tools} menu.  A
vector from the current plot or the {\vt constants} plot can be
referenced by name.  A vector from any plot can be referenced with the
notation
\begin{quote}
{\it plotname\/}.{\it vecname}
\end{quote}
where {\it plotname} is the name of the plot or an alias, and {\it
vecname} is the vector name.

The default separation character is a period, however this can be
changed by setting the variable {\et plot\_catchar}.  If this variable
is set to a string consisting of a single punctuation character, that
character becomes the separator.  We will continue to use a period in
the examples, but be aware that other options exist.

The {\it plotname} can also be a numerical index.  Plots are saved in
the order created, and as listed by the {\cb setplot} command without
arguments, and in the {\cb Plots} tool.  The numerical forms below are
equivalent to the Berkeley SPICE3 syntax.  These cause trouble in
{\WRspice}, however, since they are often misinterpreted as numbers,
and typically require double quoting when used as arguments to
commands.  {\WRspice} has an equivalent set of alias keywords which do
not require special treatment. 

Below is a list of the special alias keywords and constructs which can
be given as the {\it plotname}, in addition to the actual name of the
plot to reference.  Below, {\it N} is an unsigned integer.

\begin{description}
\item{\vt curplot}\\
This is an alias for the name of the current plot.  Use of this
keyword may seem redundant, but it has an important use to be
explained below.

\item{\vt -}{\it N}\\
Use the {\it N\/}'th plot back from the current plot.  {\it N} must be
1 or larger.  For example, ``{\vt -1.v(1)}'' will reference {\vt v(1)}
in the previous plot.  It is likely that this form must be
double-quoted to avoid misinterpretation as a number.

\item{\vt prev}[{\it N\/}]\\
This is very similar functionally to the form above, but does not
cause parse errors.  The square brackets above are {\bf not} literal,
but indicate that the integer is optional.  If missing, {\it N\/}=1 is
implied.  With {\it N\/}=0, the current plot is indicated (equivalent
to {\vt curplot}).

\item{\vt +}{\it N}\\
This goes in the reverse direction, indicating a plot later in the
list than the current plot.  It is likely that this form must be
double-quoted to avoid misinterpretation as a number.

\item{\vt next}[{\it N\/}]\\
This is very similar functionally to the form above, but does not
cause parse errors.  The square brackets above are {\bf not} literal,
but indicate that the integer is optional.  If missing, {\it N\/}=1 is
implied.  With {\it N\/}=0, the current plot is indicated (equivalent
to {\vt curplot}).

\item{\it N}\\
An integer without {\vt +} or {\vt -} indicates an absolute index into
the plot list, zero-based.  The value 0 will always indicate the
``constants'' plot, which is the first plot created (on program
startup).  It is likely that this form must be double-quoted to avoid
misinterpretation as a number.

\item{\vt plot}[{\it N\/}]\\
This is very similar functionally to the form above, but does not
cause parse errors.  The square brackets above are {\bf not} literal,
but indicate that the integer is optional.  If missing, {\it N\/}=0 is
implied, which will specify the {\vt constants} plot.
\end{description}

When using the {\it plotname\/}.{\it vecname} construct, internally
the vector and its scale are copied into the current plot as temporary
vectors.  If you do ``{\vt plot -1.v(1)}'' (for example) it may be
surprising to find that the plot title, etc.  are from the current
plot, and not the source plot.

When a script is run, the current plot when the script starts is taken
as the ``context plot'' which will be used to resolve references to
vectors in the script, after searching the current plot (if
different).  Suppose that we have a script that defines a loop counter
vector, then runs a loop that performs an analysis.  If we didn't save
and search the context plot, the loop counter vector would not be
accessible after the analysis is run, since the analysis will set a
new current plot.

One should keep this behavior in mind, as it can sometimes cause
surprises.  For example, consider the script fragment

\begin{quote} \vt
run\\
let foo = i(vds)\\
plot foo
\end{quote}

Now suppose that the context plot contains a vector named ``{\vt
foo}''.  Instead of creating a new vector in the current plot, the
``{\vt foo}'' vector in the context plot will be used, probably
meaning that the scale in the displayed plot is incorrect.

To enforce the desired behavior, the second line above should be
changed to
\begin{quote} \vt
let curplot.foo = i(vds)
\end{quote}

Script authors should be in the habit of using this form when creating
vectors, when there is any possibility of a name clash with the
context plot.

%SU-------------------------------------
\subsubsection{The {\vt constants} Plot}
\index{constants plot}

% spExpressions.hlp:constants 060219

The following values are defined in a plot named ``{\vt constants}''. 
This is the default plot if no rawfile has been loaded and no
simulation has been run.  These constants are visible no matter what
the current plot is, but they are overridden by a vector with the same
name in the current plot.  The {\vt constants} plot can not be
deleted, and its vectors are read-only.  The values are in MKS units.
\begin{quote}
\begin{tabular}{|l|l|}\hline
{\vt boltz} & Boltzmann's constant (1.38062e-23 joules/degree kelvin)\\ \hline
{\vt const\_c} & The speed of light (2.997925e8 meters/second)\\ \hline
{\vt const\_e} & The base of natural logarithms (2.71828182844590452353)\\
  \hline
{\vt echarge} & The charge on an electron (1.60219e-19 coulombs)\\ \hline
{\vt false} & False value (0)\\ \hline
{\vt const\_j} & The square root of -1, can be expressed as (0,1)\\ \hline
{\vt kelvin} & Absolute 0 in Centigrade (-273.15 degrees)\\ \hline
{\vt no} & False value (0)\\ \hline
{\vt phi0} & The flux quantum (Planck's constant over twice {\vt echarge})\\ \hline
{\vt phi0\_2pi} & Value of the flux quantum normalized to $2\pi$\\ \hline
{\vt pi} & $\pi$ (3.14159265358979323846)\\ \hline
{\vt planck} & Planck's constant (6.62620e-34 joule-seconds)\\ \hline
{\vt true} & Truth value (1)\\ \hline
{\vt yes} & Truth value (1)\\ \hline
\end{tabular}
\end{quote}

% spExpressions.hlp:expressions resumed
%SU-------------------------------------
\subsection{Vector Characteristics}

\index{multidimensional vectors}
\index{dimensions, vectors}
\index{vectors, dimensions}
Vectors posses a dimensionality.  A scalar is a vector of the lowest
dimensionality.  Most vectors are one-dimensional lists of numbers. 
Certain types of analysis produce multidimensional vectors, which are
analogous to arrays.  This dimensionality is indicated when the
vectors are listed with the {\cb display} command or the {\cb let}
command without arguments.  Plotting a multidimensional vector will
produce a family of traces.  Elements and sub-dimensional vectors are
specified with multiple square brackets, with the bracket on the right
having the lowest dimensionality.

For example, one might issue the following command:
\begin{quote}
{\vt .ac dec 10 1Hz 1Mhz dc v1 0 2 .1 v2 4.5 5.5 .25}
\end{quote}
which will perform an ac analysis with the dc sources {\vt v1} and
{\vt v2} stepped through the ranges 0--2 step .1 for {\vt v1},
4.5--5.5 step .25 for {\vt v2}.  The resulting output vectors will
have dimensions [5,21,61], i.e., 5 values for {\vt v2}, 21 for {\vt
v1}, and 61 for the ac analysis.  Typing ``{\vt plot v(1)}'' (for
example) would plot all 21*5 analyses on the same scale (this would
not be too useful).  However, one can plot subranges by entering, for
example, ``{\vt plot v(1)[1]}'' which would plot the results for {\vt
v2} = 4.75, or ``{\vt plot v(1)[1][2]}'' for {\vt v2} = 4.75, {\vt v1}
= .2, etc.  Range specifications also work, for example ``{\vt plot
v(1)[2][0,2]}'' plots the values for {\vt v2} = 5, {\vt v1} = 0, .1,
.2.  The memory space required to hold the multidimensional plot data
can grow quite large, so one should be reasonable.

\index{vector indexing}
Vectors have an indexing that begins with 0, and an index, or range of
indices, can be specified in square brackets following the vector
name, for each dimension.  The notation {\vt [{\it lower\/},{\it
upper\/}]}, where {\it lower} and {\it upper} are integers, denotes
the range of elements between {\it lower} and {\it upper}.  The
notation {\vt [{\it num\/}]} denotes the {\it num\/}'th element.  If
{\it upper} is less than {\it lower}, the order of the elements is
reversed.

Vectors typically have defined units.  The units are carried through a
computation, and simplified when the result is generated.  Presently,
the system can not handle fractional powers.  The units of a vector
can be set with the {\cb settype} command.

%SU-------------------------------------
\subsection{Vector Creation and Assignment}

Vectors can be created with the {\cb let} and {\cb compose} commands. 

\index{let command}
Using the {\cb let} command, a vector may be assigned the values of a
vector already defined, or a floating-point number (a real scalar), or
a comma separated pair of numbers (a complex scalar).  A number may be
written in any format acceptable to SPICE2, such as {\vt 14.6MEG} or
{\vt -1.231e-4}.  Note that one can use either scientific notation or
one of the abbreviations like MEG or G (case insensitive), but not
both.  As with SPICE2, a number may have trailing alphabetic
characters after it, which can indicate the units.  If the vector
being assigned to does not exist, it will be created.

The {\cb compose} command can also be used to create vectors, and is
useful for creating vectors with multiple points that follow some
relationship, such as linear or logarithmic.

Newly-created vectors are added to the current plot, unless a {\it
plotname} field is specified as part of the vector reference name. 
For example, entering
\begin{quote}
{\vt let constants.myvec = 2}
\end{quote}
will assign a vector {\vt myvec} in the {\vt constants} plot the value
2.0.  Entering
\begin{quote}
{\vt let myvec = constants.const\_e}
\end{quote}
will assign a vector {\vt myvec} in the current plot the values of the
vector {\vt const\_e} in the {\vt constants} plot.  The {\cb let} command
without arguments will print a listing of vectors in the current plot.

Recent {\WRspice} releases also allow vectors to be assigned a value
with the {\cb set} command.  The syntax in this case is
 
\begin{quote}
{\vt set \&}{\it vector} {\vt =} {\it value}
\end{quote}
 
which is equivalent to
 
\begin{quote}
{\vt let} {\it vector} {\vt =} {\it value}
\end{quote}
 
When entering this form from the {\WRspice} command line, the `{\vt
\&}' character must be hidden from the shell, perhaps most
conveniently be preceding it with a backslash.  The {\it value} must
be numeric, and a value must be given, unlike normal usage of the {\cb
set} command which can set a variable as a boolean by omitting the
right side of the assignment.

%SU-------------------------------------
\subsection{Analysis Vectors and Access Mapping}

The vectors actually produced depend on the type of analysis, but the
most common output is the node voltage.  Node voltages are denoted by
vectors of the form {\vt v({\it N\/})}, where {\it N} is a name
representing the node.  Although the notation looks like a function
call, the construct actually refers to a vector, and may be used in
expressions whenever a vector is syntactically expected.  Another
common form is {\it name\/}{\vt \#branch}, which represents the
``branch'' current through voltage sources and inductors.  The SPICE
algorithm adds a term to the matrix for these elements, which
represents the current flowing through the device.  As there is a
specific matrix element for the current for these devices, the value
is available as an output variable.  The {\it name} is the name of the
voltage source or inductor.

For compatibility with SPICE2, several mappings and equivalences are
provided.  When referencing node voltages, one can reference a node by
name (e.g.  {\vt v(6)} or {\vt v(input)}).  These are string names of
the produced vectors.  In addition, one can use the SPICE2 form for
the argument inside the parentheses of the node voltage construct. 
This is {\vt (}{\it node1} [{\vt ,}{\it node2\/}]{\vt )}, where if
both {\it node1} and {\it node2} are given, the vector represents the
voltage difference between nodes {\it node1} and {\it node2}.  For
example, {\vt v(1,2)} is equivalent to {\vt v(1) - v(2)}.  The {\vt
v()} construct in the case of two arguments is like a function.

Additionally, the construct {\vt i({\it name\/})} is internally mapped
to {\it name\/}{\vt \#branch}, and the two notations can be used
interchangeably.  The {\it name} is the name of a voltage source or
inductor.

Additional mappings familiar from SPICE2 are also recognized in
{\WRspice}.  In addition to {\vt v} and {\vt i}, the following are
recognized for node voltages.  These are most useful for complex
vectors as are produced in ac analysis.

\begin{description}
\item{\vt vm}\\
This computes the magnitude, by mapping to the {\vt mag} vector
function.  The following forms are equivalent:
\begin{quote}\vt
vm(a) = mag(v(a))\\
vm(a,b) = mag(v(a) - v(b))
\end{quote}

\item{\vt vp}\\
This computes the phase, by mapping to the {\vt ph} vector
function.  The following forms are equivalent:
\begin{quote}\vt
vp(a) = ph(v(a))\\
vp(a,b) = ph(v(a) - v(b))
\end{quote}

\item{\vt vr}\\
This computes the real part, by mapping to the {\vt re} vector
function.  The following forms are equivalent:
\begin{quote}\vt
vr(a) = re(v(a))\\
vr(a,b) = re(v(a) - v(b))
\end{quote}

\item{\vt vi}\\
This computes the imaginary part, by mapping to the {\vt im} vector
function.  The following forms are equivalent:
\begin{quote}\vt
vi(a) = im(v(a))\\
vi(a,b) = im(v(a) - v(b))
\end{quote}

\item{\vt vdb}\\
This computes the decibel value (20*log10), by mapping to the
{\vt db} vector function.  The following forms are equivalent:
\begin{quote}\vt
vdb(a) = db(v(a))\\
vdb(a,b) = db(v(a) - v(b))
\end{quote}
\end{description}

Similar constructs are available for the current vectors of voltage
sources and inductors.  In these constructs, the single argument is
always the name of a ``branch'' device, either a voltage source or
inductor.

\begin{description}
\item{\vt img}\\
This computes the magnitude, by mapping to the {\vt mag} vector
function.  The following forms are equivalent:
\begin{quote}\vt
img(vx) = mag(vx\#branch)
\end{quote}
Note that this name differs from the SPICE2 ``{\vt im}'' to avoid
a clash with the {\vt im()} vector function in {\WRspice}.

\item{\vt ip}\\
This computes the phase, by mapping to the {\vt ph} vector
function.  The following forms are equivalent:
\begin{quote}\vt
ip(vx) = ph(vx\#branch)
\end{quote}

\item{\vt ir}\\
This computes the real part, by mapping to the {\vt re} vector
function.  The following forms are equivalent:
\begin{quote}\vt
ir(vx) = re(vx\#branch)
\end{quote}

\item{\vt ii}\\
This computes the imaginary part, by mapping to the {\vt im} vector
function.  The following forms are equivalent:
\begin{quote}\vt
ii(vx) = im(vx\#branch)
\end{quote}

\item{\vt idb}\\
This computes the decibel value (20*log10), by mapping to the
{\vt db} vector function.  The following forms are equivalent:
\begin{quote}\vt
vdb(vx) = db(vx\#branch)
\end{quote}
\end{description}

\index{p pseudo-function}
There is one additional mapping available, {\vt p}({\it devname\/}),
which returns the instantaneous power of a device {\it devname\/}. 
This can be applied to any device that has a readable ``{\vt p}''
parameter defined, which is true for most devices.  The {\cb show}
command can be used to list available device parameters.  This is
particularly useful for sources, as it returns the power supplied to
the circuit.  For non-dissipative elements, it represents the stored
power.

This is a mapping to the special vector {\vt @}{\it devname\/}{\vt
[p]} (see below).  Thus, the special vector data must be available for
this form to be used successfully, meaning that in analysis, as with
other special vectors representing device parameters, the vector must
be explicitly saved with the {\cb save} command or in a {\vt .save}
line.  However, if this form is used in a {\vt .measure} line, the
needed vector will be saved automatically.  This is also true if the
form is used in one of the ``runops'' as listed with the {\cb status}
command.

%SU-------------------------------------
\subsection{Special Vectors}
\label{specialvec}

Most simply, vector names can be any alphanumeric word that starts
with an alpha character.  Vector names may also be of the form {\it
string\/}({\it something\/}), if the {\it string} is not the name of a
built-in or user-defined function.

\index{temper variable}
There is one vector named ``{\vt temper}'' that is always available,
though not saved in any plot.  This is the current temperature assumed
by the program, in Celsius.

In {\WRspice}, a vector name beginning with the `{\vt @}' symbol is a
``special'' vector, and is considered a reference to an internal
device or model parameter, or a circuit parameter.  If the variable
{\et spec\_catchar} is set to a string consisting of a single
punctuation character, then that character will identify a special
vector, instead of `{\vt @}'.  The descriptions below use `{\vt @}',
but in actuality this character can be respecified by the user.

If the vector name is of the form {\vt @{\it name}[{\it param}]}, this
denotes the parameter {\it param} of the device or model named {\it
name}.  Of course, there must be a device or model with that name
defined for the current circuit and {\it param} must be a valid
parameter name for that device or model type.  See the documentation
or use the {\cb show} command for a listing of the parameters
available.

Special vectors should be saved with the {\cb save} command or on a
{\vt .save} line during analysis if a value is required at each
analysis point.  Otherwise, only the current value is available, which
is the value used at the final analysis point after analysis
completes.

The special vectors that correspond to device and model parameters in
the current circuit can be assigned.  When a special vector is
assigned, the effect is similar to the {\cb alter} command.  Actual
assignment is deferred until the next analysis run of the current
circuit, and assignment applies to that run only.  The assignment must
be repeated if needed for additional runs.

Other special vectors are read-only.

If the vector name is of the form {\vt @}{\it param}, this refers to a
parameter of the circuit with the name {\it param}.

These are resolved in the following way.  First, a match to one of the
``official'' options is sought.  These are the options listed in the
table in the options description (\ref{options}).  Any of these will
match, with the exceptions in the sub-tables listing batch mode and
obsolete options.

If this fails, parameters defined in the current circuit are searched
for a matching name.  These are defined in {\vt .param} lines.

Finally, the {\cb rusage} command (see \ref{rusage}) keywords are
searched.  Any of these keywords will match.


%SU-------------------------------------
\subsection{Vector Expressions}
\label{vecexpr}

% spExpressions.hlp:expressions 092312

An expression is an algebraic combination of already defined vectors,
scalars (a scalar is a vector of length 1), constants, operators and
functions.  Some examples of expressions are:
\begin{quote}
{\vt cos(time) + db(v(3))}\\
{\vt sin(cos(log(10)))}\\
{\vt TIME*rnd(v(9)) - 15*cos(vin\#branch)\symbol{94}7.9e5}\\
{\vt not ((ac3.freq[32] \& tran1.time[10]) gt 3)}
\end{quote}

One should note that there are two math subsystems in {\WRspice}, the
vector system described here, and a second system for processing
equations found in device descriptions during simulation (see
\ref{devexpr}).  Although the expressions are syntactically similar,
there are important differences that must be taken into account, and
one should refer to the appropriate documentation for the type of
expression.

Vector expressions can also contain calls to the built-in ``tran''
functions ordinarily used in voltage/current source specifications in
transient analysis.  These are the {\vt pulse}, {\vt pwl}, etc. 
functions described in \ref{tranfuncs}.  If assigned to a vector, the
vector will have a length equal to the current scale (e.g., the time
values of the last transient analysis plot), and be filled in with
values just as if the analysis was run with the given source
specification.  For example
\begin{quote}
    (run transient analysis: tran .1n 10n)\\
    {\vt let a = pulse(0 1 1n 1n)}
\end{quote}
Vector {\vt a} will have length 101 and contain the pulse values.

There are three such functions, {\vt sin}, {\vt exp}, and {\vt
gauss}, that have the same names as math functions.  The math
functions always return data of the same length as the argument(s),
and take 1 argument for {\vt sin}, {\vt exp} and 2 for {\vt gauss}. 
When one of these names is encountered in an expression, {\WRspice}
counts the arguments.  If the number of arguments is 1 for {\vt
sin}/{\vt exp} or 1 or 2 for {\vt gauss}, the math function is called,
otherwise the tran function is called.  It may be necessary to give
the {\vt gauss} function a phony additional argument to force calling
the tran function.

\index{vector substitution}
Vectors can be evaluated by the shell parser by adding the prefix {\vt
\$\&} to the vector's name.  This is useful, for example, when the
value of a vector needs to be passed to the shell's {\cb echo}
command, or in circuit description files where vectors are to be
evaluated by the shell as the file is read.  Similar to the shell
constructs, {\vt \$?\&{\it word\/}} expands to 1 if {\it word\/} is a
defined vector, 0 otherwise.  Also {\vt \$\#\&{\it word\/}} expands to
the length of {\it word\/} if {\it word\/} is a defined vector, or 0
if not found.  Additionally, the notation {\vt \$\&({\it vector
expression\/})} is replaced by the value of the vector expression.  A
range specification can be added, for example {\vt echo \$\&(a+1)[2]}
prints the third entry in {\vt a+1}, or 0 if out of range.  If white
space exists in the {\vt \$\&(...)} construct, it probably should be
quoted.  Finally, the shell recognizes the construct {\vt \$\&v(\${\it
something\/})} as a reference to a SPICE node voltage, so that one can
index node voltages as {\vt echo \$\&v(\$\&i)}, for example.  A range
specification can be added, which can contain shell variables.  This
is true for both vectors ({\vt \$\&} prefix) and variables.

There is a special case when {\vt \$\&} is used with a special vector
(see \ref{specialvec}) that is referencing a string-type parameter. 
Since one can have
\begin{quote}\vt
.param foo="hello there"
\end{quote}
{\vt \$\&@foo} will expand to ``{\vt hello there}'' in this case. 
Other references to {\vt @foo} will return 0.0.

%SU-------------------------------------
\subsection{Operators in Expressions}
\index{operators}

% spExperssions:operators 012309

The operations available in vector expressions are listed below.  They
all take two operands, except for unary minus and logical negation. 

\begin{description}
\item{{\bf addition operator}: {\vt $+$}}\\
Add the two operands.

\item{{\bf subtraction amd negation operator}: {\vt $-$}}\\
Evaluates to the first argument minus the second, and also may be used
as unary minus.

\item{{\bf multiply operator}: {\vt $*$}}\\
Multiply the two operands.

\item{{\bf divide operator}: {\vt $/$}}\\
The first operand divided by the second.

\item{{\bf modulo operator}: {\vt $\%$}}\\
This operates in the manner of the C {\vt fmod} function, returning
the remainder.  That is, for {\vt x$\%$y}, the value of {\vt
x$-$i$*$y} is returned for some integer {\vt i} such that the result
has the same sign of {\vt x} and magnitude less than the magnitude of
{\vt y}.  An error is indicated if {\vt y} is zero.  If {\vt x} or
{\vt y} is complex, the magnitudes are used in the division.

\item{{\bf power operator}: {\vt $\symbol{94}$} or {\vt $**$}}\\
Evaluates to the first operand raised to the power of the second.

\item{{\bf and operator}: {\vt $\&$} or {\vt $\&\&$} or {\vt and}}\\
Evaluates to 1 if both operands are non-zero, 0 otherwise.

\item{{\bf or operator}: {\vt $|$} or {\vt $||$} or {\vt or}}\\
Evaluates to 1 if either of the two operands is nonzero, 0 otherwise.

\item{{\bf not operator}: {\vt $\symbol{126}$} or {\vt !} or {\vt not}}\\
Evaluates to 1 if the operand is 0, 0 otherwise.

\item{{\bf greater-than operator}: {\vt $>$} or {\vt gt}}\\
Evaluates to 1 if the first operand is greater than the second, 0
otherwise.

\item{{\bf greater-than-or-equal operator}: {\vt $>=$} or {\vt ge}}\\
Evaluates to 1 if the first operand is greater than or equal to
the second, 0 otherwise.

\item{{\bf less-than operator}: {\vt $<$} or {\vt lt}}\\
Evaluates to 1 if the first argument is less than the second, 0
otherwise.

\item{{\bf less-than-or-equal operator}: {\vt $<=$} or {\vt le}}\\
Evaluates to 1 if the first argument is less than or equal to the
second, 0 otherwise.

\item{{\bf not-equal operator}: {\vt $<>$} or {\vt $!=$} or {\vt ne}}\\
Evaluates to 1 if the two operands are not equal, 0 otherwise.

\item{{\bf equal operator}: {\vt $=$} or {\vt $==$} or {\vt eq}}\\
Evaluates to 1 if both operands are equal, 0 otherwise.

\item{{\bf ternary conditional operator}:
      {\it expr} {\vt ?} {\it expr1} {\vt :} {\it expr2}}\\
If {\it expr} evaluates nonzeor (true), the result of the evaluation
of {\it expr1} is returned.  Otherwise, the result of evaluating
{\it expr2} is returned.  For Example:
\begin{quote}
\vt let v = (a == 2) ? v(1) : v(2)
\end{quote}
This will set {\vt v} to {\vt v(1)} if vector {\vt a} is equal to 2,
{\vt v} to {\vt v(2)} otherwise.

\item{{\bf comma operator}: {\vt ,}}\\
The notation {\it a\/},{\it b} refers to the complex number with real
part {\it a} and imaginary part {\it b}.  Such a construction may not
be used in the argument list to a macro function, however, since
commas are used to separate the arguments and parentheses may be
ignored.  The expression {\it a} + {\vt j}({\it b\/}) is equivalent. 
The comma does {\it not} behave as an operation (return a value) as it
does in C.
\end{description}

The logical operations are {\vt $\&$} (and), {\vt $|$} (or), {\vt
$\symbol{126}$} (not), and their synonyms.  A nonzero operand is
considered ``true''.  The relational operations are {\vt $<$}, {\vt
$>$}, {\vt $<=$}, {\vt $>=$}, {\vt $=$}, and {\vt $<>$} (not equal),
and their synonyms.  If used in an algebraic expression they work like
they would in C, producing values of 0 or 1.  The synonyms are useful
when {\vt <} and {\vt >} might be confused with IO redirection (which
is almost always).

\begin{description}
\item{\bf expression terminator}: {\vt ;}\\
The expression parser will terminate an expression at a semicolon. 
This can be used to enforce tokenization of expression lists, however
it will also terminate command parsing if surrounded by white space.
\end{description}

Vectors may be indexed by {\it value\/}[{\it index\/}] or {\it
value\/}[{\it low,high\/}].

The first notation refers to the {\it index\/}'th element of {\it
value}.  The second notation refers to all of the elements of {\it
value} which fall between the {\it high\/}'th and the {\it low\/}'th
element, inclusive.  If {\it high} is less than {\it low}, the order
of the elements in the result is reversed.  Note that a complex index
will have the same effect as using the real part for the lower value
and the imaginary part for the upper, since this is the way the parser
reads this expression.  Multi-dimensional vectors are referenced as
Vec[{\it ind\/}N][{\it ind\/}N-1]...[{\it ind\/}0], where each of the
{\it ind\/}I can be a range, or single value.  The range must be
within the vector's spanning space.  If fewer than the vector's
dimensions are specified, the resulting object is a sub-dimensional
vector.

Finally, there is the ran operator:  {\it value1\/}[[{\it value2\/}]]
or {\it value\/}[[{\it low,high\/}]].

The first notation refers to all the elements of {\it value1} for
which the element of the corresponding scale equals {\it value2}.  The
second notation refers to all of the elements of {\it value} for which
the corresponding elements of the scale fall between {\it high} and
{\it low}, inclusive.  If {\it high} is less than {\it low}, the order
of the elements in the result is reversed.

%SU-------------------------------------
\subsection{Math Functions}
\index{math functions}

% spExpressions.hlp:mathfuncs 032220

There are a number of built-in math functions which take and return
vectors.  Generally, these functions operate on the supplied vector
term-by-term, returning a vector of the same length as that given.

The pre-defined functions available are listed below.  In general, all
operations and functions will work on either real or complex values,
providing complex data output when necessary.

In addition, there are statistical random number sources, as well as
measurement functions exported by the {\cb measure} command, and a
number of compatibility functions to support HSPICE extensions
available.  These are described in sections that follow.

It should be noted that the mathematics subsystem used to evaluate
expressions in voltage/current sources is completely different.  In
that subsystem, functions take real valued scalars as input.  Although
many of the same functions are available in both systems, the
correspondence is not absolute.

\newcommand{\zzfmt}[1]{{\vt #1({\it vector\/})}}
\newcommand{\zzfmtt}[1]{{\vt #1({\it vector\_x\/}, {\it vector\_y\/})}}

\begin{description}
\index{abs function}
\item{\zzfmt{abs}}\\
Each point of the returned vector is the absolute value of the
corresponding point of {\it vector\/}.  This is the same as the {\vt
mag} function.

\index{acos function}
\item{\zzfmt{acos}}\\
Each point of the returned vector is the arc-cosine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{acosh function}
\item{\zzfmt{acosh}}\\
Each point of the returned vector is the arc-hyperbolic cosine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{asin function}
\item{\zzfmt{asin}}\\
Each point of the returned vector is the arc-sine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{asinh function}
\item{\zzfmt{asinh}}\\
Each point of the returned vector is the arc-hyperbolic sine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{atan function}
\item{\zzfmt{atan}}\\
Each point of the returned vector is the arc-tangent of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{atanh function}
\item{\zzfmt{atanh}}\\
Each point of the returned vector is the arc-hyperbolic tangent of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{cbrt function}
\item{\zzfmt{cbrt}}\\
Each point of the returned vector is a cube root of the corresponding
point of {\it vector\/}.

\index{ceil function}
\item{\zzfmt{ceil}}\\
This function returns the smallest integer greater than or equal to the
argument, in the manner of the C function of the same name.  If the
argument is complex, the operation is performed on both components,
with the result being complex.  This operation is performed at each
point in the given {\it vector}.

\index{cos function}
\item{\zzfmt{cos}}\\
Each point of the returned vector is the cosine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{cosh function}
\item{\zzfmt{cosh}}\\
Each point of the returned vector is the hyperbolic cosine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{db function}
\item{\zzfmt{db}}\\
Each point of the returned vector is the decibel value ({\vt 20 *
log10(mag)}) of the corresponding point of {\it vector}.

\index{deriv function}
\index{dpolydegree variable}
\item{\zzfmt{deriv}}\\
This calculates the derivative of the given {\it vector}, using
numeric differentiation by interpolating a polynomial.  However, it
may be prone to numerical errors, particularly with iterated
differentiation.  The implementation only calculates the derivative
with respect to the real component of that vector's scale.  The
polynomial degree used for differentiation can be specified with the
{\et dpolydegree} variable.  If {\et dpolydegree} is unset, the value
taken is 2 (quadratic).  The valid range is 0--7.

\index{erf function}
\item{\zzfmt{erf}}\\
Each point of the real returned vector is the error function of the
corresponding real point of {\it vector}.  Unlike most of the
functions, this function operates only on the real part of a complex
argument, and always returns a real valued result.

\index{erfc function}
\item{\zzfmt{erfc}}\\
Each point of the real returned vector is the complementary error
function of the corresponding real point of {\it vector}.  Unlike most
of the functions, this function operates only on the real part of a
complex argument, and always returns a real valued result.

\index{exp function}
\item{\zzfmt{exp}}\\
Each point of the returned vector is the exponentiation ($e^x$)
of the corresponding point of {\it vector\/}.

\index{fft function}
\item{\zzfmt{fft}}\\
The {\vt fft} function returns the Fourier transform of {\it
vector\/}, using the present scale of {\it vector}.  The scale should
be linear and monotonic.  The length is zero-padded to the next binary
power.  Only the real values are considered in the transform, so that
the negative frequency terms are the complex conjugates of the
positive frequency terms.  The negative frequency terms are not
included in the (complex) vector returned.  A scale for the returned
vector is also generated and linked to the returned vector.

\index{floor function}
\item{\zzfmt{floor}}\\
This function returns the largest integer less than or equal to the
argument, in the manner of the C function of the same name.  If the
argument is complex, the operation is performed on both components,
with the result being complex.  The operation is performed at each
point of the argument.

\index{gamma function}
\item{\zzfmt{gamma}}\\
This function returns the gamma value of the real argument (or the
real part of a complex argument), returning real data.

\index{ifft function}
\item{\zzfmt{ifft}}\\
The {\vt ifft} function returns the inverse Fourier transform of {\it
vector\/}, using the present scale of {\it vector\/}.  The scale
should be linear and monotonically increasing, starting at 0. 
Negative frequency terms are assumed to be complex conjugates of the
positive frequency terms.  The length is zero-padded to the next
binary power.  A scale for the returned vector is also generated and
linked to the returned vector.  The returned vector is always real.

\index{im function}
\item{\zzfmt{im}}\\
Each point of the real returned vector is the imaginary part of the
corresponding point of the given {\it vector\/}.  This function can
also be calld as ``{\vt imag}''.

\index{int function}
\item{\zzfmt{int}}\\
The returned value is the nearest integer to the argument, in the
manner of the C {\vt rint} function.  If the argument is complex, the
operation is performed on each component with the result being
complex.  The operation is performed at each point in the argument.

\index{integ function}
\item{\zzfmt{integ}}\\
The returned vector is the (trapezoidal) integral of {\it vector}
with respect to the {\it vector\/}'s scale (which must exist).

\index{interpolate function}
\item{\zzfmt{interpolate}}\\
This function takes its data and interpolates it onto a grid which is
determined by the default scale of the currently active plot.  The
degree is determined by the {\et polydegree} variable.  This is useful
if the argument belongs to a plot which is not the current one.  Some
restrictions are that the current scale, the {\it vector\/}'s scale,
and the argument must be real, and that either both scales must be
strictly increasing or strictly decreasing if they differ.

This function is used when operating on vectors from different plots,
where the scale may differ.  For example, the x-increment may be
different, or the points may correspond to internal time points from
transient analysis rather than the user time points.  Without
interpolation, operations are generally term-by-term, padding when
necessary.  This result is probably not useful if the scales are
different.

For example, the correct way to print the difference between a vector
in the current plot and a vector from another plot with a different
scale would be
\begin{quote}
{\vt print v(2) - interpolate(tran2.v(2))}
\end{quote}

\index{j function}
\item{\zzfmt{j}}\\
Each point of the returned vector is the corresponding point of
{\it vector} multiplied by the square root of -1.

\index{j0 function}
\item{\zzfmt{j0}}\\
Each point of the real returned vector is the Bessel order 0 function
of the corresponding real point of {\it vector}.  Unlike most of the
functions, this function operates only on the real part of a complex
argument, and always returns a real valued result.

\index{j1 function}
\item{\zzfmt{j1}}\\
Each point of the real returned vector is the Bessel order 1 function
of the corresponding real point of {\it vector}.  Unlike most of the
functions, this function operates only on the real part of a complex
argument, and always returns a real valued result.

\index{jn function}
\item{\vt jn}({\it n\/}, {\it vector\/})\\
Each point of the real returned vector is the Bessel order {\it n}
function of the corresponding real point of {\it vector}, with {\it n}
the truncated integer value of the imaginary part of {\it vector}.

Recall that for most math function, comma argument separators
are interpreted as the comma operator
\begin{quote}
\vt a,b = (a + j*b)
\end{quote}
which resolves to a single complex value.  Thus, since scalars are
extended to vectors by replicating the value, on calling this function
as, for example, ``{\vt jn(v,3)}'' where {\vt v} is a real vector, the
return will be {\vt j3(v)} for each element of {\vt v}.

If {\it vector} is real, the effective value of {\it n} is 0.

\index{length function}
\item{\zzfmt{length}}\\
This function returns the scalar length of {\it vector\/}.

\index{ln function}
\item{\zzfmt{ln}}\\
Each point of the returned vector is the natural logarithm of the
corresponding point of {\it vector}.

\index{log function}
\item{\zzfmt{log}}\\
Each point of the returned vector is the base-10 logarithm of the
corresponding point of {\it vector}.

\index{log10 function}
\item{\zzfmt{log10}}\\
Each point of the returned vector is the natural logarithm of the
corresponding point of {\it vector} (same as {\vt ln}).

{\bf Warning:} in releases prior to 3.2.15, the {\vt log} function
returned the base-10 logarithm (as in Berkeley SPICE3).  This was
changed in 3.2.15 for compatibility with device simulation models
intended for HSPICE.

\index{mag function}
\item{\zzfmt{mag}}\\
Each point of the real returned vector is the magnitude of the
corresponding point of {\it vector}.

\index{mean function}
\item{\zzfmt{mean}}\\
This function returns the (scalar) mean value of the elements in
the argument.

\index{norm function}
\item{\zzfmt{norm}}\\
Each point of the returned vector is the corresponding point of the
given vector multiplied by the magnitude of the inverse of the largest
value in the given vector.  The returned vector is therefor normalized
to 1 (i.~e, the largest magnitude of any component will be 1).

\index{ph function}
\item{\zzfmt{ph}}\\
Each point of the real returned vector is the phase of the
corresponding point of {\it vector}, expressed in radians.

\index{pos function}
\item{\zzfmt{pos}}\\
This function returns a real vector which is 1 if the corresponding
element of the argument has a non-zero real part, and 0 otherwise.

\index{re function}
\item{\zzfmt{re}}\\
Each point of the real returned vector is the real part of the
corresponding point of {\it vector}.  The function can also be called
as ``{\vt real}''.

\index{rms function}
\item{\zzfmt{rms}}\\
This function integrates the magnitude-squared of {\it vector} over
the {\it vector\/}'s scale (using trapezoidal integration), divides by
the scale range, and returns the square root of this result.  If the
{\it vector} has no scale, the square root of the sum of the squares
of the elements is returned.

\index{sgn function}
\item{\zzfmt{sgn}}\\
Each value of the output vector is 1, 0, or -1 according to whether
the corresponding value of the input vector is larger than 0, equal to
zero, or less than 0.  The vector can be complex or real.

\index{sin function}
\item{\zzfmt{sin}}\\
Each point of the returned vector is the sine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{sinh function}
\item{\zzfmt{sinh}}\\
Each point of the returned vector is the hyperbolic sine of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{sqrt function}
\item{\zzfmt{sqrt}}\\
Each point of the returned vector is the square root of the
corresponding point of {\it vector}.

\index{sum function}
\item{\zzfmt{sum}}\\
This function returns the (scalar) sum of the elements of {\it
vector}.

\index{tan function}
\item{\zzfmt{tan}}\\
Each point of the returned vector is the tangent of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{tanh function}
\item{\zzfmt{tanh}}\\
Each point of the returned vector is the hyperbolic tangent of the
corresponding point of {\it vector\/}.  This and all trig functions
operate with radians unless the {\et units} variable is set to {\vt
degrees}.

\index{unitvec function}
\item{\zzfmt{unitvec}}\\
This function returns a real vector consisting of all 1's, with length
equal to the magnitude of the first element of the argument.

\index{vector function}
\item{\zzfmt{vector}}\\
This function returns a vector consisting of the integers from 0 up to the
magnitude of the first element of its argument.

\index{y0 function}
\item{\zzfmt{y0}}\\
Each point of the real returned vector is the Neumann order 0 function
of the corresponding real point of {\it vector}.  Unlike most of the
functions, this function operates only on the real part of a complex
argument, and always returns a real valued result.

\index{y1 function}
\item{\zzfmt{y1}}\\
Each point of the real returned vector is the Neumann order 1 function
of the corresponding real point of {\it vector}.  Unlike most of the
functions, this function operates only on the real part of a complex
argument, and always returns a real valued result.

\index{yn function}
\item{\vt yn}({\it n\/}, {\it vector\/})\\
Each point of the real returned vector is the Neumann order {\it n}
function of the corresponding real point of {\it vector}, with {\it n}
the truncated integer value of the imaginary part.

Recall that for most math function, comma argument separators
are interpreted as the comma operator
\begin{quote}
\vt a,b = (a + j*b)
\end{quote}
which resolves to a single complex value.  Thus, since scalars are
extended to vectors by replicating the value, on calling this function
as, for example, ``{\vt yn(v,3)}'' where {\vt v} is a real vector, the
return will be {\vt y3(v)} for each element of {\vt v}.

If {\it vector} is real, the effective value of {\it n} is 0.
\end{description}


%SU-------------------------------------
\subsection{Statistical Functions}
\index{statistical functions}
\label{statfuncs}

% spExpressions.hlp:statfuncs 032715

These functions generate random values, in accord with different
statistical distribution properties.  Each relies on the {\cb seed}
command to seed the internal random number generator which is common
to all random sources.  Each distribution is defined by one or two
parameters.  For distributions that take a single parameter, if passed
a complex vector, the result will be a complex vector, using
separately the distribution parameters in the real and imaginary
parts.  For distributions that require two parameters, the return
vector is always real, and the complex vector given will supply the
two parameters as the real and imaginary parts.  If a real vector is
given, a default value will be used for the second parameter.

Note that it is not likely that one would use different values for
different indices of the given vector.  If all indices have the same
value, then the return would contain a number of samples from the same
distribution, which is what is almost always needed.

Perhaps most of the time the functions will be called with scalar
values.  With these and other functions, bear in mind that the
syntactic element expected as an argument is a ``single'' number,
which can be real or complex.  When complex, it has the form ``{\it
a\/}, {\it b\/}'' which looks like two numbers.  The take-away is that
any of these functions can be called as {\it func\/}({\it a\/}), or
{\it func\/}({\it a\/}, {\it b\/}) where {\it a} and {\it b} are
scalars.  The return depends on the function.

The user is expected to know the properties of these distributions and
when to apply them.  There is much information about these
distributions available on-line, and in Knuth.

\begin{description}
\index{beta function}
\item{\zzfmt{beta}}\\
The beta distribution is defined by two positive real values {\vt a}
and {\vt b}.  These are taken term by term as the real and imaginary
parts of {\it vector} when complex.  When real, the {\vt b} will use
the default value 1.0.

\index{binomial function}
\item{\zzfmt{binomial}}\\
The binomial distribution is defined by a positive real value {\vt p}
and positive integer {\vt n}.  These are taken term by term as the
real and imaginary parts of {\it vector} when complex.  The imaginary
value is truncated to form the integer.  When {\it vector} is real,
the {\vt n} will use the default value 1.

\index{chisq function}
\item{\zzfmt{chisq}}\\
The chi-square distribution is defined by a positive real
degrees-of-freedom value.  This is taken from {\it vector}
term-by-term.  If {\it vector} is real, the return is also real.  If
{\it vector} is complex, the return is also complex, with separate
results for the real and imaginary parts, obtained using the real and
imaginary parts of {\it vector}.

\index{erlang function}
\item{\zzfmt{erlang}}\\
The Erlang distribution is defined by two positive real values {\vt k}
and {\vt mean}.  These are taken term by term as the real and
imaginary parts of {\it vector} when complex.  When real, the {\vt
mean} will use the default value 10.0.  The return is a real vector of
the same length as {\it vector}.

\index{exponential function}
\item{\zzfmt{exponential}}\\
The exponential distribution is defined by a positive real mean value. 
This is taken from {\it vector} term-by-term.  If {\it vector} is
real, the return is also real.  If {\it vector} is complex, the return
is also complex, with separate results for the real and imaginary
parts, obtained using the real and imaginary parts of {\it vector}.

\index{ogauss function}
\item{\zzfmt{ogauss}}\\
This function returns a real vector which contains normally
distributed random values.  The standard deviation and mean are set by
the corresponding real and imaginary coefficients of {\it vector}
term-by-term, and the mean is zero if {\it vector} is real.

\index{poisson function}
\item{\zzfmt{poisson}}\\
The Poisson distribution is defined by a positive real mean value. 
This is taken from {\it vector} term-by-term.  If {\it vector} is
real, the return is also real.  If {\it vector} is complex, the return
is also complex, with separate results for the real and imaginary
parts, obtained using the real and imaginary parts of {\it vector}.

\index{rnd function}
\item{\zzfmt{rnd}}\\
This function returns a vector which contains uniformly distributed
random values between 0 and the corresponding element of {\it
vector\/}.  If {\it vector} is complex then the return is also
complex, with the real and imaginary values within the range set by
the corresponding entries in {\it vector}.

\index{tdist function}
\item{\zzfmt{tdist}}\\
The student's T distribution is defined by a positive real
degrees-of-freedom value.  This is taken from {\it vector}
term-by-term.  If {\it vector} is real, the return is also real.  If
{\it vector} is complex, the return is also complex, with separate
results for the real and imaginary parts, obtained using the real and
imaginary parts of {\it vector}.
\end{description}


%SU-------------------------------------
\subsection{Measurement Functions}
\index{measurement functions}
\label{measfuncs}

% spExpressions.hlp:measfuncs 020324

These functions are exported from the {\cb measure} command and provide
the same measurement capability in post-processing.

Each function takes three arguments.  The first argument is a
simulation result vector.  The second two arguments are scalar values
of the vector's scale that define the measurement range (effectively
the trigger and target points).  These are clipped to the actual
vector scale if out of range.  The return value is a real scalar.

\begin{description}
\index{mavg function}
\item{\vt mavg}({\it vec\/}, {\it start\/}, {\it end\/})\\
Compute the average value of {\it vec} over the range {\it start} to
{\it end\/}.

\index{mmax function}
\item{\vt mmax}({\it vec\/}, {\it start\/}, {\it end\/})\\
Find the maximum value of {\it vec} over the range {\it start} to {\it
end\/}.

\index{mmin function}
\item{\vt mmin}({\it vec\/}, {\it start\/}, {\it end\/})\\
Find the minimum value of {\it vec} over the range {\it start} to {\it
end\/}.

\index{mpp function}
\item{\vt mpp}({\it vec\/}, {\it start\/}, {\it end\/})\\
Find the peak to peak (maximum minus minimum) value of {\it vec} over
the range {\it start} to {\it end\/}.

\index{mpw function}
\item{\vt mpw}({\it vec\/}, {\it start\/}, {\it end\/})\\
Find the full-width half-maximum pulse width of {\it vec} over the
range {\it start} to {\it end\/}.  The {\it start} and {\it end} are
assumed to frame a single pulse.  The maximum and minimum values are
found, and the first two crossings of the average of these values
provide the result.

\index{mrft function}
\item{\vt mrft}({\it vec\/}, {\it start\/}, {\it end\/})\\
Find the 10\% to 90\% rise or fall duration for an edge assumed to be
framed by {\it start} and {\it end\/}.

\index{mrft2 function}
\item{\vt mrft2}({\it vec\/}, {\it start\/}, {\it end\/},
 {\it firstval\/}, {\it secondval\/})\\
This is identical to {\cb mrft}, except that two additional real
valued variables provide the measurement thresholds rather than being
fixed an 0.1 and 0.9.  This will find the rise or fall duration (time
between threshold crossings) for an edge assumed to be framed by {\it
start} and {\it end\/}.

\index{mrms function}
\item{\vt mrms}({\it vec\/}, {\it start\/}, {\it end\/})\\
Compute the root mean square (RMS) value of {\it vec} over the range
{\it start} to {\it end\/}.
\end{description}


%SU-------------------------------------
\subsection{HSPICE Compatibility Functions}
\index{HSPICE functions}

% spExpressions.hlp:hs_functions 012609

The following functions are available, for compatibility with HSPICE.

These functions differ from other math functions in that they take
multiple comma-separated arguments, Other math functions
internally accept a single argument, but if there are multiple
comma-separated terms, they will be collapsed into a single
argument through evaluation of the comma operator
\begin{quote}
\vt a,b = (a + j*b)
\end{quote}
which yields a complex value.  This will not be true in the functions
listed below -- the comma really means separate arguments in this
case.

The first group of functions are equivalent to the HSPICE Monte Carlo
functions that are called in {\vt .param} lines in HSPICE.  In
{\WRspice}, these are regular math functions.

These functions will return mean values unless enabled.  They are
enabled while in Monte Carlo analysis, or if the {\et random} variable
is set, either from the command line or from a {\vt .options} line in
a circuit file.

\begin{description}
\index{unif function}
\item{\vt unif}({\it nom\/}, {\it rvar\/})\\
Uniform relative random value function.

This returns a vector the same length as {\it nom}, complex or real as
{\it nom}.  If the length of {\it rvar} is less than the length of
{\it nom}, {\it rvar} is extended by replicating the highest index
value of {\it rvar}.

If we are not running Monte Carlo analysis, and the {\et random}
variable is not set, the return vector is the same as {\it nom} (no
random values are generated).  Otherwise the return vector contains
uniformly distributed random values, each in the range [{\it nom} -
{\it nom\/}*{\it rvar\/}, {\it nom} + {\it nom\/}*{\it rvar\/}]
term-by-term.

Below, {\vt random} is a pseudo-function that returns a random number
between -1 and 1.

\begin{description}
\item{If {\it nom} is complex and {\it var} is complex:}\\
  {\vt out[i].real = nom[i].real*(1 + random()*rvar[i].real)}\\
  {\vt out[i].imag = nom[i].imag*(1 + random()*rvar[i].imag)}

\item{If {\it nom} is complex and {\it var} is real:}\\
  {\vt out[i].real = nom[i].real*(1 + random()*rvar[i])}\\
  {\vt out[i].imag = nom[i].imag*(1 + random()*rvar[i])}

\item{If {\it nom} is real and {\it var} is complex:}\\
  {\vt out[i] = nom[i].real*(1 + random()*rvar[i].real)}

\item{If {\it nom} is real and {\it var} is real:}\\
  {\vt out[i] = nom[i]*(1 + random()*rvar[i])}
\end{description}

\index{aunif function}
\item{\vt aunif}({\it nom\/}, {\it var\/})\\
Uniform absolute random value function.

This returns a vector the same length as {\it nom\/}, complex or real
as {\it nom\/}.  If the length of {\it var} is less than the length of
{\it nom\/}, {\it var} is extended by replicating the highest index
value of {\it var\/}.

If we are not running Monte Carlo analysis, and the {\et random}
variable is not set, the return vector is the same as {\it nom} (no
random values are generated).  Otherwise The return vector contains
uniformly distributed random values, each in the range [{\it nom} -
{\it var\/}, {\it nom} + {\it var\/}] term-by-term.

Below, {\vt random} is a pseudo-function that returns a random number
between -1 and 1.

\begin{description}
\item{If {\it nom} is complex and {\it var} is complex:}\\
  {\vt out[i].real = nom[i].real + random()*var[i].real}\\
  {\vt out[i].imag = nom[i].imag + random()*var[i].imag}

\item{If {\it nom} is complex and {\it var} is real:}\\
  {\vt out[i].real = nom[i].real + random()*var[i]}\\
  {\vt out[i].imag = nom[i].imag + random()*var[i]}

\item{If {\it nom} is real and {\it var} is complex:}\\
  {\vt out[i] = nom[i].real + random()*var[i].real}

\item{If {\it nom} is real and {\it var} is real:}\\
  {\vt out[i] = nom[i] + random()*var[i]}
\end{description}

\index{gauss function}
\item{\vt gauss}({\it nom\/}, {\it rvar\/},
  {\it sigma\/})\\
Gaussian relative random number generator.

This returns a vector the same length as {\it nom\/}, complex or real
as {\it nom\/}.  If the length of {\it rvar} is less than the length
of {\it nom\/}, {\it rvar} is extended by replicating the highest
index value of {\it rvar\/}.  Only the zero'th (real) component of
{\it sigma} is used.

If fewer than three arguments are given, this reverts to the original
{\WRspice} {\vt gauss} function (now called {\vt ogauss}).

If we are not running Monte Carlo analysis, and the {\et random}
variable is not set, the return vector is the same as {\it nom} (no
random values are generated).  Otherwise the return vector contains
gaussian-distributed random values.  The (scalar) {\it sigma} value
gives the specified sigma of the {\it rvar} data, generally 1 or 3.

Below, the pseudo-function {\vt gauss} returns a gaussian random
number with zero mean and unit standard deviation.

\begin{description}
\item{If {\it nom} is complex and {\it var} is complex:}\\
  {\vt out[i].real = nom[i].real*(1 + gauss()*rvar[i].real/sigma)}\\
  {\vt out[i].imag = nom[i].imag*(1 + gauss()*rvar[i].imag/sigma)}

\item{If {\it nom} is complex and {\it var} is real:}\\
  {\vt out[i].real = nom[i].real*(1 + gauss()*rvar[i]/sigma)}\\
  {\vt out[i].imag = nom[i].imag*(1 + gauss()*rvar[i]/sigma)}

\item{If {\it nom} is real and {\it var} is complex:}\\
  {\vt out[i] = nom[i].real*(1 + gauss()*rvar[i].real/sigma)}

\item{If {\it nom} is real and {\it var} is real:}\\
  {\vt out[i] = nom[i]*(1 + gauss()*rvar[i]/sigma)}
\end{description}

\index{agauss function}
\item{\vt agauss}({\it nom\/}, {\it var\/},
  {\it sigma\/})\\
Gaussian absolute random number generator.

This returns a vector the same length as {\it nom\/}, complex or real
as {\it nom\/}.  If the length of {\it var} is less than the length of
{\it nom\/}, {\it var} is extended by replicating the highest index
value of {\it var\/}.  Only the zero'th (real) component of {\it
sigma} is used.

If we are not running Monte Carlo analysis, and the {\et random}
variable is not set, the return vector is the same as {\it nom} (no
random values are generated).  Otherwise the return vector contains
gaussian-distributed random values.  The (scalar) {\it sigma} value
gives the specified sigma of the var data, generally 1 or 3.

Below, the pseudo-function {\vt gauss} returns a gaussian random
number with zero mean and unit standard deviation.

\begin{description}
\item{If {\it nom} is complex and {\it var} is complex:}\\
  {\vt out[i].real = nom[i].real + gauss()*var[i].real/sigma}\\
  {\vt out[i].imag = nom[i].imag + gauss()*var[i].imag/sigma}

\item{If {\it nom} is complex and {\it var} is real:}\\
  {\vt out[i].real = nom[i].real + gauss()*var[i]/sigma}\\
  {\vt out[i].imag = nom[i].imag + gauss()*var[i]/sigma}

\item{If {\it nom} is real and {\it var} is complex:}\\
  {\vt out[i] = nom[i].real + gauss()*var[i].real/sigma}

\item{If {\it nom} is real and {\it var} is real:}\\
  {\vt out[i] = nom[i] + gauss()*var[i]/sigma}
\end{description}

\index{limit function}
\item{\vt limit}({\it nom\/}, {\it var\/})\\
Random limit function.

This returns a vector the same length as {\it nom\/}, complex or real
as {\it nom\/}.  If the length of {\it var} is less than the length of
{\it nom\/}, {\it var} is extended by replicating the highest index
value of {\it var\/}.

If we are not running Monte Carlo analysis, and the {\et random}
variable is not set, the return vector is the same as {\it nom} (no
random values are generated).  Otherwise the return vector contains
either {\it nom} + {\it var} or {\it nom} - {\it var} determined
randomly, term-by-term.

\begin{description}
\item{If {\it nom} is complex and {\it var} is complex:}\\
  {\vt out[i].real = nom[i].real +/- var[i].real} randomly\\
  {\vt out[i].imag = nom[i].imag +/- var[i].imag} randomly

\item{If {\it nom} is complex and {\it var} is real:}\\
  {\vt out[i].real = nom[i].real +/- var[i]} randomly\\
  {\vt out[i].imag = nom[i].imag +/- var[i]} randomly

\item{If {\it nom} is real and {\it var} is complex:}\\
  {\vt out[i] = nom[i].real +/- var[i].real} randomly

\item{If {\it nom} is real and {\it var} is real:}\\
  {\vt out[i] = nom[i] +/- var[i]} randomly
\end{description}
\end{description}

The remaining functions are for HSPICE compatibility, but are not
exclusive to the HSPICE Monte Carlo analysis.  These also have
multiple arguments.

\begin{description}
\index{pow function}
\item{\vt pow}({\it x\/}, {\it y\/})\\
This returns a real or complex vector the same length as {\it x\/}. 
If the length of {\it y} is less than the length of {\it x\/}, {\it y}
is extended by replicating the highest index value of {\it y\/}.

This returns a vector containing $x^y$ computed using complex values,
term-by-term, however if {\it y} is real, is is truncated to an
integer value.

\begin{description}
\item{If {\it x} is complex and {\it y} is complex:}\\
  {\vt out =} $x^y$ (same as $\symbol{94}$ operator)

\item{If {\it x} is complex and {\it y} is real:}\\
  {\vt out =} $x^(int)y$ (same as $\symbol{94}$ operator, but {\it y}
    is truncated to integer)

\item{If {\it x} is real and {\it y} is complex:}\\
  {\vt out =} $x^y$ (same as $\symbol{94}$ operator)

\item{If {\it x} is real and {\it y} is real:}\\
  {\vt out =} $x^(int)y$ (same as $\symbol{94}$ operator, but {\it y}
    is truncated to integer)
\end{description}

\index{pwr function}
\item{\vt pwr}({\it x\/}, {\it y\/})\\
This returns a real vector the same length as {\it x\/}.  If the
length of {\it y} is less than the length of {\it x\/}, {\it y} is
extended by replicating the highest index value of {\it y\/}.

\begin{description}
\item{If {\it x} is complex and {\it y} is complex:}\\
  {\vt out[i] =} (sign of {\vt x[i].real})({\vt mag(x[i])} $\symbol{94}$
  {\vt y[i].real})

\item{If {\it x} is complex and {\it y} is real:}\\
  {\vt out[i] =} (sign of {\vt x[i].real})({\vt mag(x[i])} $\symbol{94}$
  {\vt y[i]})

\item{If {\it x} is real and {\it y} is complex:}\\
  {\vt out[i] =} (sign of {\vt x[i].real})({\vt abs(x[i])} $\symbol{94}$
  {\vt y[i].real})

\item{If {\it x} is real and {\it y} is real:}\\
  {\vt out[i] =} (sign of {\vt x[i]})({\vt abs(x[i])} $\symbol{94}$ {\vt y[i]})
\end{description}

\index{sign function}
\item{\vt sign}({\it x\/}, {\it y\/})\\
This returns a vector the same length as {\it x\/}, complex or real as
{\it x\/}.  If the length of {\it y} is less than the length of {\it
x\/}, {\it y} is extended by replicating the highest index value of
{\it y\/}.

\begin{description}
\item{If {\it x} is complex and {\it y} is complex:}\\
  {\vt out[i].real =} (sign of {\vt y[i].real}){\vt abs(x[i].real)}\\
  {\vt out[i].imag =} (sign of {\vt y[i].imag}){\vt abs(x[i].imag)}

\item{If {\it x} is complex and {\it y} is real:}\\
  {\vt out[i].real =} (sign of {\vt y[i]}){\vt abs(x[i].real)}\\
  {\vt out[i].imag =} (sign of {\vt y[i]}){\vt abs(x[i].imag)}

\item{If {\it x} is real and {\it y} is complex:}\\
  {\vt out[i] =} (sign of {\vt y[i].real}){\vt abs(x[i])}

\item{If {\it x} is real and {\it y} is real:}\\
  {\vt out[i] =} (sign of {\vt y[i]}){\vt abs(x[i])}
\end{description}
\end{description}

%SU-------------------------------------
\subsection{Expression Lists}
\index{expression list}

% spExpressions.hlp:explists 012609

Some commands, such as {\cb print} and {\cb plot}, take expression
lists as arguments.  In the simplest form, an expression list is a
space-separated list of vectors.  In the general form, an expression
list is a sequence of expressions involving vectors.  The parsing is
context dependent, i.e., white space does not necessarily terminate an
expression.  This leads to ambiguities.  For example, the command
\begin{quote}
{\vt plot v(2) -v(3)}
\end{quote}
can be interpreted as two vectors, or as a single vector representing
the difference.  {\WRspice} will assume the latter.

There are several ways to ensure that the former interpretation prevails.
Double quotes may be used to separate the tokens, but white space must
precede the leading quote mark:
\begin{quote}
\vt plot v(2) "-v(3)"
\end{quote}
Parentheses can also be used to enforce precedence, with white space
ahead of the opening paren, as:
\begin{quote}
\vt plot v(2) (-v(3))
\end{quote}
In addition, the expression termination character, a semicolon,
can be used.  This must be hidden from the shell, for example
with a backslash:
\begin{quote}
\vt plot v(2)$\backslash$; -v(3)
\end{quote}

There are situations where the name of a vector is so strange that it
can't be accessed in the usual way.  For example, if a list-type
special variable is saved with the {\cb save} command, the plot may
contain a vector with a name like ``{\vt @b1[ic,0]}''.  To access
this vector, one can't simply type the name, since the name is an
expression which will actually lead to an evaluation error.  One has
to fool the expression parser into taking the name as a string.  This
will happen if the name is not the lead in a token and the name is
double quoted.  If the name is the leading part of a token, it should
be backslash-double-double quoted.

To use the double quotes to enforce string interpretation, one should
have, for example,
\begin{quote}
{\vt plot v(2) $\backslash$""@b1[ic,0]"$\backslash$"}
\end{quote}
The extra set of quotes is needed only if the string is at the start
of a token, thus
\begin{quote}
{\vt plot 2*"@b1[ic,0]"}
\end{quote}
is ok.  This may be a bit confusing, but this feature is seldom
used, and a bit of experimentation will illustrate the behavior.

These commands can accept the {\it plotname\/}.{\it vecname}
notation, where either field may be the wildcard ``{\vt all}''.  If
the plotname is {\vt all}, matching vectors from all plots are
specified, and if the vector name is {\vt all}, all vectors in the
specified plots are referenced.  The {\vt constants} plot is never
matched by a plot wildcard.  Note that you may not use binary
operations on expressions involving wildcards - it is not obvious what
``{\vt all + all}'' should denote, for instance.

%SU-------------------------------------
\subsection{Set and Let}
\index{set and let}

% spExpressions.hlp:setandlet 041611

Novice {\WRspice} users may be confused by the different
interpretations of shell variables and vectors.  Any variable can be
defined with the {\cb set} command, and undefined with {\cb unset}. 
If defined, the value of the variable is the string, if given.  For
example, if
\begin{quote}\vt
set a = 10*2
\end{quote}
is entered, the value of {\vt a} (obtained as {\vt \$a}) is the string
``{\vt 10*2}'' and {\it not} the integer 20.

Some internally used variables have boolean values, such as 
\begin{quote}\vt
set unixcom
\end{quote}
which if set causes certain modes or functions to be active.

Vectors, however, always have numeric values, and can be created with
{\cb let} and {\cb compose}, and deleted with {\cb unlet}.  If one
enters
\begin{quote}\vt
let a = 10*2, {\rm or more simply}\\
a = 10*2
\end{quote}
the value of the vector {\vt a} is {\vt 20}.  Note that the ``{\vt let}''
is generally optional when assigning vectors.

At the risk of adding confusion, it should be noted that in recent
{\WRspice} releases, the {\cb set} command can also be used to assign
values to vectors.  The syntax

\begin{quote}
{\vt set \&}{\it vector} {\vt =} {\it value}
\end{quote}
 
is equivalent to
 
\begin{quote}
{\vt let} {\it vector} {\vt =} {\it value}
\end{quote}

Vectors can be set to shell variables, in which case they take on
the interpreted numerical values.  For example,
\begin{quote}\vt
set a=10*2\\
b = \$a
\end{quote}
would assign the string {\vt 10*2} to the shell variable {\vt a}, but the
vector {\vt b} would contain the value {\vt 20}.

The inputs to most commands are vectors, however some commands,
such as {\cb echo}, substitute for shell variables.  For example,
\begin{quote}\vt
set a = "foo"\\
set b = "bar"\\
echo \$a\$b
\end{quote}
would print ``{\vt foobar}''.

Shell variables are expanded by {\cb echo}, and in {\WRspice} input when
sourced.  If the value of a vector is needed in shell expansion,
then the special prefix {\vt \$\&} should be added.  This tells the
shell interpreter that the following symbol is a vector, to be
replaced by its value.  For example,
\begin{quote}\vt\rr
let a = 2.0e-2\\
echo \$\&a\\
\end{quote}
will print {\vt 2.00000e-2}.  However
\begin{quote}\vt\rr
let a = 2.0e-2\\
echo \$a\\
\end{quote}
would give an error message (unless {\vt a} is also a shell variable),
and
\begin{quote}\vt
let a = 2.0e-2\\
echo a
\end{quote}
would print ``{\vt a}''.

Double quotes will cause multiple tokens to be taken as one, for
example
\begin{quote}\vt
set a = "a string"
\end{quote}
will set {\vt a} accordingly, whereas
\begin{quote}\vt
set a = a string
\end{quote}
will set shell variable {\vt a} to ``{\vt a}'' and shell variable {\vt
string} to boolean true.

Single quotes do about the same thing, but suppress shell variable
expansion.  For example:
\begin{quote}\vt
set a = foo\\
set b = bar\\
echo \$a \$b
\end{quote}
and
\begin{quote}\vt
set a = foo\\
set b = bar\\
echo "\$a \$b"
\end{quote}
would print ``{\vt foo bar}'', whereas
\begin{quote}\vt
set a = foo\\
set b = bar\\
echo '\$a \$b'
\end{quote}
would print ``{\vt \$a \$b}''.

In the present version, {\vt \$} can not be nested.  For example,
\begin{quote}\vt
set a = foo\\
set b = bar\\
set c = '\$a\$b'\\
echo \$c
\end{quote}
prints ``{\vt \$a\$b}'', not ``{\vt foobar}''.  However,
\begin{quote}\vt
set a = foo\\
set b = bar\\
set c = \$a\$b\\
echo \$c
\end{quote}
does print ``{\vt foobar}'' (the value of {\vt c}).

Shell variables that are lists are referenced with zero-based index,
for example
\begin{quote}\vt
set a = ( aa bb cc )\\
echo \$a[1]
\end{quote}
prints ``{\vt bb}''.

Actually, what can be in the brackets is {\vt [{\it lo\/}-{\it hi\/}]},
where {\it lo\/} defaults to 0 and {\it hi\/} defaults to the length - 1. 
If {\it lo\/} $>$ {\it hi\/}, the list is reversed.

If the reference is to a vector, as in
\begin{quote}\vt
compose a values .1 .2 .3\\
echo \$\&a[1]
\end{quote}
the index is also zero-based, so ``{\vt 2.0000e-1}'' is printed.

The {\vt []} subscripting is interpreted a little differently by the
shell and by the vector parser.  If a variable starts with {\vt \$},
as in {\vt \$\&value[]}, the {\vt []} is interpreted by the shell
parser.  In this case, the terms inside {\vt []} must be interpreted
as shell variables, with the (optional) {\it low\/}-{\it high}
notation.  In a vector expression, i.~e.~, one using {\vt value[]},
the terms inside {\vt []} will be interpreted as vector expressions,
with the optional {\it low\/},{\it high} notation.  Thus,
\begin{quote}\vt
if (value[index] = 0)
\end{quote}
is perfectly legal for vectors {\vt value} and {\vt index}.  Also,
equivalently,
\begin{quote}\vt
if (\$\&value[\$\&index] = 0)
\end{quote}
is also ok, though not as efficient.  However
\begin{quote}\vt
if (\$\&value1[index] = 0)
\end{quote}
is an error, as the shell parser does not know that {\vt index} is a
vector.

Shell variables can be used freely in vector expressions, however
one must keep in mind how the variables are interpreted.  During
parsing, the shell variables are evaluated, and their values put
back into the expression as constants.  Then the expression is
evaluated as a vector expression. 


%S-----------------------------------------------------------------------------
\section{Batch Mode}
\index{batch mode}
\index{scripts}

% spMain.hlp:batchmode 120424

Although {\WRspice} is intended to be an interactive program, batch
mode, similar to SPICE2, is supported.  If {\WRspice} is invoked with
the {\vt -b} command line option, it will process the input circuit
files in batch mode.  The files are input on the command line, and if
no files are listed, the standard input is read.  Most of the control
lines recognized by SPICE2 will be handled, including {\vt .plot},
{\vt .print}, and {\vt .four}.  These lines are more or less ignored
in interactive mode, but provide the traditional SPICE2 behavior in
batch mode.

For normal analysis, output is sent to the standard output, in the
form of ASCII plots and print output as directed by {\vt .plot}/{\vt
.print} lines, plus additional information about the run, somewhat
similar to SPICE2 but less verbose by default.  The batch mode output
format and content can be controlled with the option keywords
described in \ref{batchvars}.  If the input file is a margin or
operating range analysis file, a result file will be produced (as in
interactive mode), however there will be little or no standard output
other than printing from {\cb echo} commands within the analysis
scripts.

If the {\vt -r} command line option is used ({\vt -r} {\it
filename\/}), a plot data file will be produced.  This will also be
true if specified with the {\vt post} option in the circuit
description.

Batch node is non-graphical, and plots produced from {\vt .plot} lines
use the line printer format of ancient times.  Saving output in a
rawfile or CSDF file for later viewing with graphical {\WRspice} or
another viewing program is recommended.

The input files provided may have {\vt .newjob} lines, which logically
divide the input into two or more separate circuit decks.  Each
circuit deck is processed in order.  This is one way to run multiple
simulations in a single batch job.

\index{server mode}
There is also a ``server'' mode which is similar to batch mode, which
is invoked with the {\vt -s} command line option.  This is intended
for use in remote SPICE runs.  Input is taken only from the standard
input, and output is exclusively to the standard output.  The output
is either in rawfile or margin analysis format, and inappropriate
command line options such as {\vt -r}, {\vt -b} are ignored.  There is
probably no reason for a user to invoke this mode directly.

%SU-------------------------------------
\subsection{Scripts and Batch Mode}

Scripts can be written to automate a large number of runs on a
circuit, saving the output in a sequence of rawfiles.  Typically this
may be done in the background, using {\WRspice} in batch mode.  This
section addresses some of the subtleties of using scripts in batch
mode.

\index{control blocks}
Any script, or circuit file containing a script, can be sourced by
{\WRspice} when started in batch mode ({\vt -b} option given). 
However, the batch mode behavior will not be evident unless 1) the
sourced file (and any inclusions) contains a circuit description, and
2) no analysis command is run on the circuit from a {\vt .control}
block in the same file (plus inclusions).  That is, after executing
the {\vt .control} lines, if {\WRspice} finds that an analysis has
already been run, such as from a {\cb tran} command in the {\vt
.control} block, {\WRspice} will simply exit rather than run the
circuit again in batch mode.  Here, by ``batch mode'', we mean the
usual plots, prints, and other data output that would occur for a pure
circuit file.  When the circuit was run from the {\vt .control} block,
all of this output is absent, and {\vt .plot}, {\vt .print} and
similar lines are ignored as in interactive mode.

If the input file contains a circuit description, recall that an {\vt
.exec} block in the same (logical) file will be executed before the
circuit is parsed, and therefor can be used to set shell variables
which can affect the circuit.  For example:

\begin{quote}\vt
* RC Test\\
\\
R1 1 0 1k\\
c1 1 0 \$cval\\
i1 0 1 pulse 0 1m 10p 10p\\
.plot tran v(1)\\
.tran 10n 1u\\
\\
.exec\\
set cval="1n"\\
.endc
\end{quote}

The circuit will run in batch mode, with the capacitance value
provided from the {\vt .exec} script.  This example is trivial, but
conceptually the {\vt .exec} script can be far more elaborate,
configuring the circuit according to an external data file, for
example.

Often, it is more convenient to provide our own analysis control
in the input file.  For example, add a trivial {\vt .control}
block to the example above.

\begin{quote}\vt
* RC Test\\
\\
R1 1 0 1k\\
c1 1 0 \$cval\\
i1 0 1 pulse 0 1m 10p 10p\\
.plot tran v(1)\\
.tran 10n 1u\\
\\
.exec\\
set cval="1n"\\
.endc\\
.control\\
run\\
.endc
\end{quote}

When run with the {\vt -b} option, there is no ``batch mode'' output. 
Further, if the {\vt -r} option was used to generate a plot data file,
the file would not be created.  The presence of an analysis command
(``{\vt run}'') in the {\vt .control} block inhibits the ``batch
mode'' behavior.  The analysis was run, but we forgot to save any
data.  One must add an explicit {\cb write} command to save vectors to
a file for later review.  One could also add {\cb print} and {\cb
plot} commands.  Since there is no graphics, the {\cb plot} command
reverts to the {\cb asciiplot} as used in batch mode output, so is not
of much value.  Note that the {\cb plot} command and {\vt .plot}
control line have similar but different syntax, one should avoid
confusing the two.

Again, our example is trivial, but the {\vt .control} block can
implement complex procedures and run sequences, provide
post-simulation data manipulation, and perform other tasks.

At the start of every analysis command execution, the circuit is
reset, meaning that the input is re-parsed.  This will not happen with
the first analysis command found in a {\vt .control} block, as the
circuit is already effectively in the reset state.  However, on
subsequent analysis commands, the {\vt .exec} block will be
re-executed, and the circuit will be re-parsed.  Chances are, if we
are running more than one simulation, we would like to change the
parameter value.  Consider the example:

\begin{quote}\vt
* RC Test\\
\\
R1 1 0 1k\\
c1 1 0 \$cval\\
i1 0 1 pulse 0 1m 10p 10p\\
.tran 10n 1u\\
\\
.exec\\
if \$?cval = 0\\
\hspace*{6mm}set cval="1n"\\
endif\\
.endc\\
.control\\
run\\
write out1n.raw\\
set cval="2n"\\
run\\
write out2n.raw\\
.endc
\end{quote}

We are now running two transient analyses, with different capacitance
values.  The first change is within the {\vt .exec} block.  The {\cb
set} command will be applied only if the {\vt cval} variable is unset,
i.e., it will be set once only, when the file is first read.  Instead,
ahead of the second {\cb run} command in the {\vt .control} block, we
use the {\cb set} command to provide a new value for {\vt cval}.  This
will update the circuit as the circuit is re-parsed in the second {\cb
run} command.  Without the change to the {\vt .exec} block, the
evaluation of the {\vt .exec} block in the second {\cb run} command
would override our new {\vt cval} value.

 
%S-----------------------------------------------------------------------------
\section{Loadable Device Modules}
\label{loadable}
\index{loadable device modules}

% spMain.hlp:loadable 091822

It is possible to load device models into {\WRspice} at run time,
through use of ``loadable device modules''.  These are dynamically
loaded libraries containing the device model description in a form
which can be read into a running {\WRspice} process.  This capability
opens up some interesting possibilities for future versions of
{\WRspice} in how new device models are distributed.  It also gives
the user, at least in principle, the ability to generate and use
custom device models in {\WRspice}.
Support for this important new feature is available in all
releases.

Loadable device modules are most often created by translating and
compiling Verilog-A compact model descriptions, though it is also
possible to write C/C++ code directly.

Loadable device modules are specific to a particular release number of
{\WRspice}, and to the operating system.  Since the interface may
change, user-created loadable modules need to be rebuilt for new
releases of {\WRspice}.  This may be relaxed in future releases, when
the interface stabilizes.

Loadable device modules can be loaded into {\WRspice} in two ways.

\begin{enumerate}
\item{On startup, {\WRspice} will look for loadable modules in the
directories listed in the {\vt modpath} variable, or, if that variable
is not set, in the {\vt devices} directory under the {\vt startup}
directory (i.e., {\vt /usr/local/xictools/wrspice/startup/devices} if
installed in the default location).  Modules found will be loaded
automatically by default.

If either of the {\vt -m} or {\vt -mnone} command line options is
given, or if the {\vt nomodload} variable is set in the {\vt
.wrspiceinit} file, the automatic device loading will not be done.}

\item{The {\cb devload} command can be used to load a module from the
command prompt or from a script.  The syntax is
\begin{quote}
{\vt devload} [{\it path\_to\_loadable\_module\/}]
\end{quote}

The argument can also be a directory containing loadable modules, all
of which would be loaded by the command.

The ``{\vt devload all}'' command will load all known modules, as when
{\WRspice} starts.

If no argument is given, a list of the presently loaded modules
is printed. }
\end{enumerate}

Once a module is loaded, it can't presently be unloaded.  The file can
be re-loaded, however, so if a module is modified and rebuilt, it can
be loaded again to update the running {\WRspice}.

There are two ways to reference a loaded device model.
\begin{enumerate}
\item{By traditional SPICE model level and name.\\
There are traditional model names in SPICE, which often provide
differentiation of device polarity.  These are names like ``{\vt
npn}'' and ``{\vt pnp}'' for a BJT device, and ``{\vt nmos}'' and
``{\vt pmos}'' for MOSFETs.  Other devices will use the key character
as the model name.  The SPICE input file will include lines like
\begin{quote}
{\vt .model mynpn npn level=100 ...}\\
{\vt .model nch nmos level=101 ...}\\
{\vt .model sxx s level=2 ...}
\end{quote}
Every device model must have a unique {\vt level} value (an integer)
for its type.  If a module is loaded that has a conflicting level, a
warning is issued.  If the conflict is with a built-in model, the
built-in model will always have precedence, and the loaded model will
not be accessible.}

\item{By model name.\\
Every loadable module has a given model name.  Further, device models
of dual-polarity devices have a parameter that sets the device
polarity.  This is defined in the model code, but most models have
standardized on a parameter named ``{\vt type}'' which is set to 1 for
n-type and -1 for p-type.

The model can be referenced by name, for example
\begin{quote}
{\vt .model mynpn hicum2 type=1 level=8 ...}\\
{\vt .model nch bsim6 type=1 level=80 ...}
\end{quote}
If the device has a level value different from 1, a matching level
parameter must be defined in the {\vt .model} line.  {\WRspice} does
not check for a unique name, as the level parameter should enforce
uniqueness.}
\end{enumerate}

The {\vt devkit} directory in the {\WRspice} installation location
({\vt /usr/local/xictools/wrspice} is the default) will provide
the tools needed to build loadable device modules.

%SU-------------------------------------
\subsection{Creating Loadable Modules from Veriolog-A}
\index{Verilog-A}

% spMain.hlp:loadable 040618

{\WRspice} provides support for building loadable modules
from Verilog-A model source.  Many new compact device models have been
released in this format, as it is (theoretically) portable to all
simulators.  Most commercial simulators now have this capability.

To build modules from Verilog-A source, the Whiteley Research version
of the open-source {\vt adms-2.3.x} package must be installed on the
system.  This is included in the {\XicTools} packages and source.  The
{\XicTools} version of {\vt adms} contains the latest enhancements and
bug fixes for use with {\WRspice}, and should be used in preference to
other versions of this software.

The {\vt devkit/README} file provides instructions on how to build a
module, and there are several examples.  Pre-built modules are
provided.  These can be loaded into {\WRspice} and used.

\subsubsection{Requirements}

In order to build loadable device modules from Verilog-A, the
following requirements must be met.

\begin{enumerate}
\item {The user's computer must contain the Gnu C/C++ compiler and the
regular set of program development tools.  Apple users are advised to
install Apple's XCode program development environment, which is a free
(but huge) download from Apple.  It is recommended that you set up a
build environment as described in the {\vt README} file at the top
level of the <i>XicTools</i> source tree.}

\item {The compiler version used to build modules must be compatible with
the version used to build {\WRspice}.  Incompatibility may be
manifested in various ways:
\begin{itemize}
\item {The module fails to load, with an error message.}
\item {The module loads, but with warnings.}
\item {The module loads, but causes program instability when used.}
\end{itemize}

That being said, I haven't noticed any problems, even in the case of
using different major versions to compile the module and to compile
the program, but this can not be counted on.  The safest approach is
to build {\WRspice} from source, which should not be hard since the
build environment is already set up.}

\item {The {\XicTools} version of the ADMS translator must be
installed.  This is available as a package and as part of the
source code for {\XicTools}.}

\item {The procedure to build the example modules is simple.  However,
to successfully build an arbitrary module will probably require
expertise in C++ coding/program building, Verilog-A syntax, and
possibly the ADMS language, if the module does not build or work
properly initially.}
\end{enumerate}

\subsubsection{How It Works}

The ADMS program reads the Verilog-A file, and builds a representation
of the file logic in memory.  A set of XML scripts access this tree
and generate the C++ code to describe the device functionality.  The
C++ files are then compiled into a loadable module (shared library)
which can be loaded into {\WRspice}.

{\WRspice} can load device modules in two ways.  On program startup,
any device modules found in the {\vt devices} sub-directory in the
startup directory (e.g. {\vt
/usr/local/xictools/wrspice/startup/devices}) will be loaded.  While
running, the {\WRspice} {\cb devload} command can be used to load a
module, with the command argument being the path to the module.  If no
argument is given, a list of the modules currently loaded is printed.

\subsubsection{The ADMS Scripts}

The scripts which control the interpretation of the Verilog-A source
during translation into C++ reside in the {\vt admst} directory. 
There is a fairly steep learning curve in gaining proficiency with the
language and logic of these scripts, but they can in theory be
modified by the user.  In fact, the {\vt wrspiceVersion.xml} file
provides some user-customization switches.

Some of the features provided by the {\WRspice} script set, that are
not available in the script sets available for many/most/all other
simulators, are the following:

\begin{enumerate}
\item {Rigorous automatic partitioning of static and dynamic
    contribution terms, as well as noise terms.}
\item {Support for potential nature contributions ({\vt V() <+} ...),
    and automatic node collapsing when possible.}
\item {Support for optional ports and the {\vt \$port\_connected}
    call.}
\item {Support for the {\vt idt} (time integration) operator, and
    most other system functions.}
\item {Does not require adms-specific format extensions, but will use
    them if found.}
\item {Full computation of second-derivative terms.}
\item {Full support for noise analysis in {\WRspice}.}
\item {A new and more efficient math package.}
\item {No ``built in'' fixes for common public Verilog-A models, scripts
    are intended to be completely generic.}
\item {Produces C++ code that is indented and humanly-readable.}
\end{enumerate}

\subsubsection{How to Build a Module}

If all goes according to plan, this is easy.

\begin{enumerate}
\item {Create a fresh directory somewhere.}

\item {Copy the {\vt Makefile} from the {\vt devkit} directory
(typically {\vt /usr/local/xictools/wrspice/devkit}) into the
new directory.}

\item {This is optional, but you may want to copy the Verilog-A
source file (or files) into this directory as well, for
convenience.}

\item {Edit the top of the {\vt Makefile} with a text editor.  The
{\vt Makfile} contains comments explaining what needs setting. 
Basically, you need to set the device key letter and model level (as
will be used in {\WRspice}), a short name for the module, and the path
to the XML scripts provided under the {\vt devkit}.}

\item {Type ``{\vt make}'' at the shell prompt.  The processing may
take a few minutes.  Some compiler warnings may appear.

There may be a lot of messages like:
\begin{quote}
  {\vt warning: declaration of T10 shadows a previous local}
\end{quote}
These appear when the module code defines a variable in a block, and
also in a lower-level block.  These should be harmless, but some
models ({\vt bsimsoi}) generate a lot of these messages.

Messages like
\begin{quote}
  {\vt warning: unused variable vd}
\end{quote}
appear if a variable is declared in a block but never used.  Once
again, these are harmless, but may represent declarations in the
Verilog-A source that could be omitted.}

\item {If all goes well, a loadable module will be created.  This is a
file with a ``{\vt .so}'' extension (``{\vt .dylib}'' under OS X, or
``{\vt .dll}'' in Windows) with the base name the same as the module
name that was supplied in the {\vt Makefile}.  One should be able to
load this module into {\WRspice}, and access the device description in
simulation files.}
\end{enumerate}

\subsubsection{Building the Examples}

The {\vt examples} subdirectory contains several publicly-available
Verilog-A models for testing and illustrating the procedure.  The {\vt
README} files provide more information.  You should copy the
directories and their contents to your local directory to build the
modules.  In each model directory, follow the procedure above.

Test the new loadable module.  First, verify that the loadable module
file exists, i.e., the compile succeeded.  Then, change to the ``{\vt
tests}'' subdirectory, and start {\WRspice}.  At the {\WRspice}
prompt, give the command
\begin{quote}
{\vt devload ../}{\it module.so}
\end{quote}
where {\it module.so} is the actual name of the module file. 
{\WRspice} will print a ``{\vt Loading device} ...'' message, and no
error messages should appear.

Next, bring up the {\cb File Selection} panel with the {\cb File
Select} button in the {\cb File} menu.  There will be at least one
file listed with a ``{\vt .sp}'' or ``{\vt .cir}'' extension, these
are the SPICE input source files.  Click on one of these to select,
and click on the green octagon button.  The simulation will run and a
plot will appear.

Have fun!

\subsubsection{What if it Doesn't Work?}

There are many things that can go wrong, and it is likely that
something will.  Most likely, the Verilog-A file contains a construct
that either ADMS or the scripts can't handle.  The author of ADMS
describes the translator as ``alpha'', but that being said, it seems
fairly complete and stable.  The problem most likely resides with the
XML scripts.  These were adapted to {\WRspice} using scripts for other
simulators as a starting point.  They will evolve to provide more
complete and error-free translation.  As a quick look at the script
text will show, they can be hideously complex.  The language itself is
not well documented, though ``experts'' can figure it out from the
configuration files in the ADMS installation.


%SU-------------------------------------
\subsection{Support for AMDS/Verilog-A}

% spMain.hlp:veriloga 040718

The ADMS package translates the Verilog-A model description into a set
of C++ files, which are then compiled into a loadable module (a shared
library loaded on demand).

There may be some documentation of ADMS on the internet.  Last I
looked, there was very little, but is included with the {\XicTools}
version of ADMS.  One should also google-up a copy of the Verilog-A
manual, as this describes the official syntax.

This section is a catch-all for information about the {\WRspice} ADMS
implementation, with regard to syntax and features.

\subsubsection{The ``{\vt insideADMS}'' define}
\index{insideADMS}

The symbol {\vt insideADMS} is defined (as if with {\vt `define
insideADMS}), and can be used to test for ADMS in the Verilog-A code.

\subsubsection{The ADMS ``attributes''}

This is a syntax extension to Verilog-A supported by ADMS.  It allows
additional information in parameter and variable declarations to be
passed to the simulator.

{\bf Examples}:\\
{\vt parameter real c10 = 2e-30 from [0:1] (* info="GICCR constant"
 unit="A\symbol{94}2s" *);}\\
{\vt real outTheta   (* info="Theta" *);}

The attributes are delimited by {\vt (* ...  *)} just ahead of the
line-terminating semicolon.  The content consists of {\it
keyword\/}={\it value} terms, separated by white space.  The {\it
value} is taken as a literal string, and should be double-quoted if it
contains white space.  The {\it keyword} can be any token, but only
certain keywords are recognized by ADMS.

\begin{description}
\item{\vt info=}"{\it string describing the parameter or variable}"\\
The string will be used in the {\WRspice} {\cb show} command and
perhaps elsewhere.

\item{\vt units=}{\it units\_token}\\
This gives the units of the parameter or variable.  (I'm not sure that
this is actually used.)

\item{\vt type=model}\\
This construct indicates that the parameter should be taken as a model
parameter, i.e., a parameter given in a {\vt .model} line in SPICE.

\item{\vt type=instance}\\
This construct indicates that the parameter should be taken as an
instance parameter, i.e., a parameter given in a device instance line.
\end{description}

Models may use the following code to hide this construct from non-ADMS
parsers.
\begin{quote}\vt
`ifdef insideADMS\\
\hspace*{2em}`define ATTR(txt) (*txt*)\\
`else\\
\hspace*{2em}`define ATTR(txt)\\
`endif\\
...\\
parameter real c10 = 2e-30 from [0:1] `ATTR(info="GICCR constant" unit="A\symbol{94}2s");\\
real outTheta   `ATTR( info="Theta" );
\end{quote}

\subsubsection{Read-Only Parameters}

The presence of any attribute on a normal variable magically
transforms that variable into a parameter which is read-only.  This
means that it can be used to pass data out of the model during
simulation.

Such variables are initialized to the starting value at the beginning
of the simulation only.  Regular variables are initialized on every
pass through the equation set, which occurrs on every Newton
iteration.  The read-only parameters can therefor retain history from
the last iteration.

In {\WRspice}, data from these (and all) parameters can be obtained
from the {\vt @}{\it device}{\vt [}{\it parmname\/}{\vt ]} special
vector construct.

\subsubsection{Initialization Blocks and Global Events}

ADMS will handle the two standard global events, but only in the forms
containing no arguments.

\begin{description}
\item{\vt @(initial\_step) begin ... end}\\
The block is executed while computing the initial analysis point, in
accord with the Verilog-AMS standard.  The block will be called for
the operating point analysis (if any), all iterations.  Thus, it will
be called multiple times, which makes it unattractive for use as an
initializer.

\item{\vt @(final\_step) begin ... end}\\
The block is executed while computing the final analysis point, in
accord with the Verilog-AMS standard.  The block will be called for
all iterations.  It will be called after {\vt initial\_step} if both
are called.

\item{\vt @(initial\_model) begin ... end}\\
This block is run once-only before any analysis.  It can be used to
initialize per-model parameters, such as temperature dependence.  This
is not in the Verilog-AMS standard and may be particular to ADMS.

\item{\vt @(initial\_instance) begin ...  end}\\ This block is run
once-only before any analysis.  It can be used to initialize
per-instance parameters, such as geometrical dependence.  This is not
in the Verilog-AMS standard and may be particular to ADMS.
\end{description}

In ADMS, the "global events" are equivalent to named blocks, for
example:

\begin{tabular}{lll}\\
\vt begin : initial\_model & \hspace*{0.5in} & \vt @(initial\_model) begin\\
... & & ...\\
\vt end & & \vt end\\
\end{tabular}

Either form can be used for {\vt initial\_step}, {\vt final\_step},
{\vt initial\_model}, and {\vt initial\_instance}.

\subsubsection{System Tasks}

\paragraph{Input/Output Tasks}

\begin{description}
\item{\parbox{4in}{
{\vt \$display}({\it format\/}, {\it variable list\/})\\
{\vt \$strobe}({\it format\/}, {\it variable list\/})\\
{\vt \$monitor}({\it format\/}, {\it variable list\/})\\
{\vt \$write}({\it format\/}, {\it variable list\/})}}\\
These commands have the same syntax, and display text on the screen
during simulation.  {\vt \$display} and {\vt \$strobe} display once
every time they are executed, whereas {\vt \$monitor} displays every
time one of its parameters changes.  The difference between {\vt
\$display} and {\vt \$strobe} is that {\vt \$strobe} displays the
parameters at the very end of the current simulation time unit rather
than exactly when it is executed.  The format string is like that in
C/C++, and may contain format characters.  Format characters include
{\vt \%d} (decimal), {\vt \%h} (hexadecimal), {\vt \%b} (binary), {\vt
\%c} (character), {\vt \%s} (string) and {\vt \%t} (time), {\vt \%m}
(hierarchy level).  Forms like {\vt \%5d}, {\vt \%5b} etc.  would
assign a field width of 5 when printing the item.

{\vt \$display} and {\vt \$write} are the same except {\vt \$display}
appends a newline if the string does not have a trailing newline
character, {\vt \$write} does not do this.

\item{\parbox{4in}{
{\vt \$error}({\it format\/}, ...)\\
{\vt \$warning}({\it format\/}, ...)}}\\
Print a message starting with ``{\vt Fatal:}'' or ``{\vt Warning:}''.

\item{\parbox{4in}{
{\vt \$fopen}({\it filename\/})\\
{\vt \$fclose}({\it handle\/})\\
{\vt \$fdisplay}({\it handle\/}, {\it format\/}, {\it variable list\/})\\
{\vt \$fstrobe}({\it handle\/}, {\it format\/}, {\it variable list\/})\\
{\vt \$fmonitor}({\it handle\/}, {\it format\/}, {\it variable list\/})\\
{\vt \$fwrite}({\it handle\/}, {\it format\/}, {\it variable list\/})}}\\
These commands write more selectively to files.

{\vt \$fopen} opens an output file and gives the open file an integer
handle for use by the other commands.

{\vt \$fclose} closes the file and lets other programs access it.

In {\WRspice}, there are two special handles that are automatically
open and can't be closed.

\begin{quote}
\begin{tabular}{|l|l|} \hline
0 & Print to the pop-up error window.\\ \hline
1 or $<$ 0 & Print to the standard output (terminal window).\\ \hline
\end{tabular}
\end{quote}

{\vt \$fdisplay} and {\vt \$fwrite} write formatted data to a file
whenever they are executed.  They are the same except {\vt \$fdisplay}
appends a newline if the string does not have a trailing newline
character, {\vt \$fwrite} does not do this.

{\vt \$fstrobe} also writes to a file when executed, but it waits
until all other operations in the time step are complete before
writing.  Thus
\begin{quote}\vt
initial \#1 a=1; b=0; \$fstrobe(hand1, a,b); b=1;
\end{quote}
will write write 1 1 for a and b.

{\vt \$monitor} writes to a file whenever any of its arguments
changes.
\end{description}

\paragraph{Simulation Control}

\begin{description}
\item{\vt \$bound\_step}({\it max\_delta\/})\\
Limit the next time point to be {\it max\_delta} or less from the
present time point in transient analysis.

\item{\vt \$finish}[({\it n\/}[, {\it type\_string\/}])]\\
Halt the analysis.  If integer {\it n} is given, it can be one of
these values, which determine what if anything is printed.

\begin{quote}
From the spec, this is not currently supported.

\begin{tabular}{|l|p{4in}|} \hline
0 & Prints nothing (the default if no argument)\\ \hline
1 & Prints simulation time and location\\ \hline
2 & Prints simulation time, location, and statistics
  about the memory and CPU time used in simulation\\ \hline
\end{tabular}
\end{quote}

Verilog-AMS allows an additional option string argument to be
specified to {\vt \$finish} to indicate the type of the finish.  {\it
type\_string} can take one of three values:  ``{\vt accepted}'',
``{\vt immediate}'' or ``{\vt current\_analysis}''.  ``{\vt accepted}
is the default setting.

If the {\it type\_string} is set to ``{\vt accepted}'' and {\vt
\$finish} is called during an accepted iteration, then the simulator
will exit after the current solution is complete.

If the {\it type\_string} is set to ``{\vt current\_analysis}'' and
{\vt \$finish} is called during an accepted iteration, then the
simulator terminates the current analysis and will start the next
analysis if one requested. 

If the {\it type\_string} is set to ``{\vt immediate}'' and {\vt
\$finish} is called during an iteration, then the simulation will exit
immediately without the current solution being completed.  This is not
recommended as it may leave the output files generated by the
simulator in an undefined state.

\item{\vt \$stop}[({\it n\/})]\\
A call to {\vt \$stop} during an accepted iteration causes simulation
to be suspended at a converged timepoint.  This task takes an optional
integer expression argument (0, 1, or 2), which determines what type
of diagnostic message is printed.  The amount of diagnostic message
output increases with the value of {\it n\/}, as shown for {\vt
\$finish}.
\end{description}

\paragraph{Random Numbers}

\begin{description}
\item{\vt \$random}[({\it seed\/})]\\
{\vt \$random} generates a random integer every time it is called.  If
the sequence is to be repeatable, the first time one invokes {\vt
\$random} it is given a numerical argument (a seed).  Otherwise the
seed is derived from the computer clock.

\item{\parbox{4in}{
{\vt \$rdist\_uniform}({\it seed\/}, {\it start\/}, {\it end\/}[, {\it dt\/}])\\
{\vt \$rdist\_normal}({\it seed\/}, {\it mean\/}, {\it stddev\/}[, {\it dt\/}])\\
{\vt \$rdist\_exponential}({\it seed\/}, {\it mean\/}[, {\it dt\/}])\\
{\vt \$rdist\_poisson}({\it seed\/}, {\it mean\/}[, {\it dt\/}])\\
{\vt \$rdist\_chi\_square}({\it seed\/}, {\it dof\/}[, {\it dt\/}])\\
{\vt \$rdist\_t}({\it seed\/}, {\it dof\/}[, {\it dt\/}])\\
{\vt \$rdist\_erlang}({\it seed\/}, {\it k\/}, {\it mean\/}[, {\it dt\/}])}}\\
In {\WRspice}, the following functions are implemented in such a way
that they are compatible with Newton iterations and convergence
testing.  Logically, a separate random value is obtained at each point
of a grid in time that covers the simulation interval.  The actual
random number used is interpolated from this grid at the present
simulation time.  Thus, the ``random'' function becomes deterministic,
and simulations that include output from the random generator will
converge and iterate normally.  This can be used to model Johnson
noise in the time domain, for example.

Each has an additional optional ``{\it dt\/}'' argument which if given
is taken as the time period of the random number grid.  If not given,
the {\it TStep} from the running transient analysis is assumed.  This
value has significance only in transient analysis.  During other types
of analysis, calls to these functions will return a single random
value, generated on the first call.

Note that during transient analysis, the seed value should not change,
or non-convergence can result.

The following rules apply to these functions.
\begin{enumerate}
\item{All arguments to the system functions are real values, except
for {\it seed} (which is defined by {\vt \$random}).  For the {\vt
\$rdist\_exponential}, {\vt \$rdist\_poisson}, {\vt
\$rdist\_chi\_square}, {\vt \$rdist\_t}, and {\vt \$rdist\_erlang}
functions, the arguments {\it mean}, {\it dof}, and {\it k} shall be
greater than zero (0).}

\item{Each of these functions returns a pseudo-random number whose
characteristics are described by the function name, e.g., {\vt
\$rdist\_uniform} returns random numbers uniformly distributed in the
interval specified by its arguments.}

\item{For each system function, the {\it seed} argument shall be an
integer.  If it is an integer variable, then it is an inout argument;
that is, a value is passed to the function and a different value is
returned.  The variable is initialized by the user and only updated by
the system function.  This ensures the desired distribution is
achieved upon successive calls to the system function.  If the {\it
seed} argument is a parameter or constant, then the system function
does not update the value.  This makes the system function useable for
parameter initialization.  {\WRspice} doesn't handle this.}

\item{The system functions shall always return the same value given
the same seed.  This facilitates debugging by making the operation of
the system repeatable.  In order to get different random values when
the seed argument is a parameter, the user can override the
parameter.

The two paragraphs above are difficult to follow.  In {\WRspice}, if
the same seed value is used for all calls, the sequence of values is
repeatable.  A call with a different seed will reset the internal
random number generator and a different sequence would be returned. 
The system functions never reset the seed.  There is only one seed in
{\WRspice}, so if any function call changes the seed, all subsequent
random number calls are affected.}

\item{All functions return a real value.}

\item{In {\vt \$rdist\_uniform}, the {\it start} and {\it end}
arguments are real inputs which bound the values returned.  The {\it
start} value shall be smaller than the {\it end} value.}

\item{The {\it mean} argument used by {\vt \$rdist\_normal}, {\vt
\$rdist\_exponential}, {\vt \$rdist\_poisson}, and {\vt
\$rdist\_erlang} is a real input which causes the average value
returned by the function to approach the value specified.}

\item{The {\it standard\_deviation} argument used by {\vt
\$rdist\_normal} is a real input, which helps determine the shape of
the density function.  Using larger numbers for {\it
standard\_deviation} spreads the returned values over a wider range. 
Using a mean of zero (0) and a standard deviation of one (1), {\vt
\$rdist\_normal} generates Gaussian distribution.}

\item{The {\it dof} (degree of freedom) argument used by {\vt
\$rdist\_chi\_square} and {\vt \$rdist\_t} is a real input, which
helps determine the shape of the density function.  Using larger
numbers for {\it dof} spreads the returned values over a wider range.}
\end{enumerate}
\end{description}

\paragraph{Other System Functions Recognized in ADMS/{\WRspice}}

\begin{description}
\item{\parbox{4in}{
{\vt absdelay}({\it arg1\/}, {\it arg2\/})\\
{\vt delay}({\it arg1\/}, {\it arg2\/})}}\\
Recognized but not implemented.

\item{\parbox{4in}{
{\vt \$abstime}\\
{\vt \$realtime}}}\\
Returns the simulation time, the names are equivalent.

\item{\vt analysis}({\it keyword\/})\\
Return nonzero if the analysis type represented by the {\it keyword}
is being performed.  The {\it keyword} is one of:
\begin{description}

\item{\vt ac}\\
True when running AC analysis.

\item{\vt dc}\\
True when running DC sweep or operating point analysis.

\item{\vt noise}\\
True when running noise analysis.

\item{\vt tran}\\
True when running transient analysis.

\item{\vt ic}\\
True in the initial-condition analysis that preceeds a transient
analysis.

\item{\vt static}\\
Any equilibrium point calculation, including a DC analysis as well as
those that precede another analysis, such as the DC analysis that
precedes an AC or noise analysis, or the IC analysis that precedes a
transient analysis.

\item{\vt nodeset}\\
The phase during an equilibrium point calculation where node voltages
are forced.
\end{description}

\item{\vt ceil}({\it x\/})\\
Return the integer value greater than or equal to the argument.

\item{\vt ddt}({\it expression\/}[, {\it ignored\/}])\\
Return the time derivative, any second argument is ignored.

\item{\vt ddx}({\it variable\/}, {\it probe\/})\\
Return the partial derivative of the variable with respect to the
probe.

\item{\vt flicker\_noise}({\it a\/}, {\it b\/}[, {\it c\/}])\\
Probably not implemented.

\item{\vt floor}({\it x\/})\\
Return the integer value less than or equal to the argument.

\item{\vt \$given}({\it model\_or\_instance\_parameter\/})\\
Return nonzero if the parameter was given, same as {\vt
\$param\_given}.

\item{\vt idt}({\it expression\/}, {\it icval\/}, {\it reset\/}[,
 {\it ignored\/})\\
Return the time integral of {\it expression} using the initial value
{\it icval\/}.  If {\it reset} is nonzero, instead zero the internal
integration history.

\item{\vt \$mfactor}\\
Return the device {\vt M} scale factor if the model was built for this
support, otherwise 1.0.

\item{\vt \$model}\\
Expands to the name of the current device model.

\item{\vt \$nominal\_temperature}\\
Return the nominal temperature in Kelvin.

\item{\vt \$instance}\\
Expands to the name of the currenly scoped instance, or ``???''.

\item{\vt \$param\_given}({\it model\_or\_instance\_parameter\/})\\
Return nonzero if the parameter was given, same as {\vt \$given}.

\item{\vt \$port\_connected}({\it port\_name\/})\\
Return nonzero if the named port is connected externally.

\item{\parbox{4in}{
{\vt \$realtime}\\
{\vt \$abstime}}}\\
Return the simulation time, the names are equivalent.

\item{\vt \$scale}\\
Return 1.0, no scaling in {\WRspice}.

\item{\vt \$simparam}({\it string\/}[, {\it expression\/}])\\ This
queries the simulator for a simulation parameter named in {\it
string\/}.  If {\it string} is known, its value is returned.  If
string is not known, and the optional {\it expression} is not
supplied, then an error is generated.  If the optional {\it
expression} is supplied, its value is returned if {\it string} is not
known and no error is generated. 

{\vt \$simparam}() shall always return a real value; simulation
parameters that have integer values shall be coerced to real.  There
is no fixed list of simulation parameters.  However, simulators shall
accept the strings below to access commonly-known simulation
parameters, if they support the parameter.  Simulators can also accept
other strings to access the same parameters.

The first group below comes from the Verilog-AMS specification.

\begin{description}
\item{\vt gdev}\\
Additional conductance to be added to nonlinear branches for
conductance homotopy convergence algorithm.  Returns the {\WRspice}
{\vt gmin} parameter.

\item{\vt gmin}\\
Minimum conductance placed in parallel with nonlinear branches,
returns the {\WRspice} {\vt gmin} parameter.

\item{\vt imax}\\
Branch current threshold above which the constitutive relation
of a nonlinear branch should be linearized.  Returns 1.0.

\item{\vt imelt}\\
Branch current threshold indicating device failure.  Returns 1.0.

\item{\vt iteration}\\
Iteration number of the analog solver, returns an internal iteration
count.

\item{\vt scale}\\
Scale factor for device instance geometry parameters.  Returns 1.0.

\item{\vt shrink}\\
Optical linear shrink factor.  Returns 1.0.

\item{\vt simulatorSubversion}\\
The simulator sub-version.  Returns, e.g., 5 for {\it WRspice\/}-4.3.5.

\item{\vt simulatorVersion}\\
The simulator version.  Retursn, e.g., 4.3 for {\it WRspice\/}-4.3.5.

\item{\vt sourceScaleFactor}
Multiplicative factor for independent sources for source stepping
homotopy convergence algorithm.  {\WRspice} returns the scaling value
from source stepping.

\item{\vt tnom}\\
Default value of temperature in Celsius at which model parameters were
extracted (same as {\vt \$nominal\_temperature\/}>).
\end{description}

The following group has unknown origin.

\begin{description}
\item{\vt checkjcap}\\
Returns 1.0.

\item{\vt maxmosl}\\
Returns 1.0.

\item{\vt maxmosw}\\
Returns 1.0.

\item{\vt minmosl}\\
Returns 1.0e-12.

\item{\vt minmosw}\\
Returns 1.0e-12.
\end{description}

The final group is implemented in {\WRspice}, perhaps uniquely.

\begin{description}
\item{\vt tstep}\\
The current transient analysis output time increment.

\item{\vt tstart}\\
The current start time for transient analysis output.

\item{\vt tstop}\\
The current final time point in transient analysis.

\item{\vt delta}\\
The current internal time step in transient analysis.

\item{\vt delmin}\\
The minimum allowable transient analysis time step.

\item{\vt delmax}\\
The maximum allowable transient analysis time step.

\item{\vt abstol}\\
The absolute tolerance parameter.

\item{\vt reltol}\\
The relative tolerance parameter.

\item{\vt chgtol}\\
The charge tolerance parameter.

\item{\vt vntol}\\
The voltage tolerance parameter.

\item{\vt predictor}\\
Nonzero when in the first iteration of a time point.

\item{\vt smallsig}\\
Nonzero when loading small-signal values in AC analysis.

\item{\vt dcphasemode}\\
Nonzero if using phase-mode DC analysis, may be true when Josephson
junctions are present.

\item{\vt dphimax}\\
Returns the maximum phase change for internal time point for
sinusoidal sources and Josephson junctions.
\end{description}

\item{\vt \$temperature}\\
Returns the circuit ambient temperature in Kelvin.

\item{\vt \$vt}[({\it temperature\_expression\/})]\\
Returns the thermal voltage KT/q using the argument for temerature, or
the ambient temperature if no argument is given.
\end{description}

\paragraph{{\WRspice} C/C++ Bridge Function}

\begin{description}
\item{\vt cfunc}({\it funcname\/}, {\it arg1\/}, ..., {\it argN\/})\\
The {\vt cfunc} pseudo-function allows arbitrary C/C++ function calls
to be made from the model code.

The return value can be used in an assignment.  In the C++ files, the
construct maps to {\it funcname\/}({\it arg1\/}, ..., {\it argN\/}).

This can be used to, for example, make available special math
functions callable from Verilog-A.  Be advised that this can be unsafe
to use in model code, as the derivative is not included in the
Jacobian, which can lead to convergence problems.  However, if such
functions are used only for initialization, use is safe.

To use this facility, the {\vt HEADER} variable in the {\vt Makefile}
should be redefined to yes, and the user should create an include file
that contains (perhaps through another include) prototypes of the
functions called using {\vt cfunc}.  This file must be named {\it
MODULE\/}{\vt extra.h}, where {\it MODULE} is the short name also
provided from the {\vt Makefile}.

The header file must also be modified to link the library containing
the function implementations to the loadable module.  The user is
expected to know how to do this.
\end{description}


%S-----------------------------------------------------------------------------
\section{The {\WRspice} Daemon and Remote SPICE Runs}
\index{daemon, wrspiced}
\index{wrspiced daemon}

% not in help

{\WRspice} can be accessed and run from a remote system for
asynchronous simulation runs, for assistance in computationally
intensive tasks such as Monte Carlo analysis, and as a simulator for
the {\Xic} graphical editor.  This is made possible through a daemon
(background) process which controls {\WRspice} on the remote
machine.  The daemon has the executable name ``wrspiced'', and
should be run as a root process on the remote machine.  Typically,
this can be initiated in the system startup script, or manually.  Of
course, the remote machine must have a valid {\WRspice} executable
present.

The {\vt wrspiced} program is described in \ref{wrspiced}.

